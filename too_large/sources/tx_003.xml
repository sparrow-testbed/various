<?xml version="1.0" encoding="EUC-KR" ?>
<service>
	
	<method name="in_setApprovalTXHD">
		INSERT INTO ICOYTXHD (HOUSE_CODE,               
                      TAX_NO,                   /* 세금계산서번호 */
                      COMPANY_CODE,             /* 회사코드 */
                      ADD_DATE,                 /* 등록일자 */
                      ADD_TIME,                 /* 등록시간 */
                      ADD_USER_ID,              /* 등록자ID */
                      STATUS,                   /* 상태     */
                      SUPBUY_TYPE,              /* 매입/매출구분 매입: 1, 매출 :2 */ 
                      DIRECT_TYPE,              /* 정/역구분 정: 1, 역: 2 */
                      TAX_DATE,                 /* 세금계산서일자 */
                      
                      ATTACH_NO,                /* 첨부파일 */
                      BLANK_CNT,                /* 공란수 */
                      TAX_TYPE,                 /* 세금계산서종류 */
                      RECEIPT_TYPE,             /* 영수증구분 */
                      SUP_IRS_NO,               /* 공급자 사업자등록번호 */
                      SUP_COM_CODE,             /* 공급자 코드 */
                      SUP_CEO_USER_NAME,        /* 공급자 대표자 성명 */
                      SUP_COM_NAME,				/* 공급자 상호 */
                      SUP_BUSINESS_TYPE,        /* 공급자 업태 */
                      SUP_INDUSTRY_TYPE,        /* 공급자 업종 */
                      SUP_ADDRESS,              /* 공급자 주소 */
                      
                      BUYER_IRS_NO,             /* 공급받는자 사업자등록번호 */
                      BUYER_CEO_USER_NAME,      /* 공급받는자 대표자성명 */
                      BUYER_COM_NAME,           /* 공급받는자 상호 */
                      BUYER_BUSINESS_TYPE,      /* 공급받는자 업태 */
                      BUYER_INDUSTRY_TYPE,      /* 공급받는자 업종 */
                      BUYER_ADDRESS,            /* 공급받는자 주소 */
                      SUP_AMT,                  /* 공급가액 */
                      VAT_AMT,                  /* 세액 */
                      TOTAL_AMT,                /* 총금액 */
                      DEAL_FLAG,                /* 거래명세서 여부 */
                      
                      SUP_REJECT_REMARK,        /* 공급자 거부/취소 사유 */
                      BUYER_REJECT_REMARK,      /* 공급받는자 거부/취소 사유 */
                      PROGRESS_CODE,            /* 진행상태 */
                      SIGN_DATE,                /* 결재/승인 일자 */
                      SIGN_PERSON_ID,           /* 결재자ID */
                      SIGN_STATUS,              /* 결재상태 */
                      PAY_DEMAND_FLAG,          /* 지불요청여부 */
                      PAY_DEMAND_DATE,          /* 지불요청일 */
                      KTGRM,          			/* 대금지급구분 */
                      REMARK                     /* 비고 */
                      ) 
        SELECT DISTINCT
            TRHD.HOUSE_CODE,
            ${tax_no} AS TAX_NO,
            TRHD.VENDOR_CODE AS COMPANY_CODE,
            TO_CHAR(SYSDATE,'YYYYMMDD') AS ADD_DATE,
            TO_CHAR(SYSDATE,'HH24MISS') AS ADD_TIME,     
            ${session.ID} AS ADD_USER_ID,
            TRHD.STATUS,
            '1' AS SUPBUY_TYPE,
            '2' AS DIRECT_TYPE,
            '' AS TAX_DATE,
            
            '' AS ATTACH_NO,
            11 - LENGTH(TO_CHAR(TRHD.PAY_AMT)) AS BLANK_CNT,
            TRHD.TAX_TYPE,
            '' AS RECEIPT_TYPE,
            TRHD.S_REG_NO AS SUP_IRS_NO,
            TRHD.S_REG_NO AS SUP_COM_CODE,
            TRHD.S_CEO_NAME AS SUP_CEO_USER_NAME,
            TRHD.S_CO_NAME  AS SUP_CO_NAME,
            TRHD.S_BIZ_TYPE AS SUP_BUSINESS_TYPE,
            TRHD.S_BIZ_CATEGORY AS SUP_INDUSTRY_TYPE,
            TRHD.S_BIZ_ADDR AS SUP_ADDRESS,
           
            TRHD.B_REG_NO AS BUYER_IRS_NO, 
            TRHD.B_CEO_NAME AS BUYER_CEO_USER_NAME,
            TRHD.B_CO_NAME AS BUYER_COM_NAME,
            TRHD.B_BIZ_TYPE AS BUYER_BUSINESS_TYPE,
            TRHD.B_BIZ_CATEGORY AS BUYER_INDUSTRY_TYPE,
            TRHD.B_BIZ_ADDR AS BUYER_ADDRESS,
            TRHD.PRICE_TOTAL AS SUP_AMT,
            TRHD.VAT_AMT AS VAT_AMT,
            TRHD.PAY_AMT AS TOTAL_AMT,
            'Y' AS DEAL_FLAG,
            
            '' AS SUP_REJECT_REMARK,           
            '' AS BUYER_REJECT_REMARK,
            'V' AS PROGRESS_CODE,
            '' AS SIGN_DATE,
            '' AS SIGN_PERSON_ID,
            'T' AS SIGN_STATUS,
            '' AS PAY_DEMAND_FLAG,
            '' AS PAY_DEMAND_DATE,         
            ${ktgrm} AS KTGRM,            
            ${remark} AS REMARK
        FROM ICOYTRHD TRHD, ICOYTRDT TRDT
        WHERE TRHD.HOUSE_CODE = ${session.HOUSE_CODE}
        AND TRHD.PAY_NO = TRDT.PAY_NO
        #pay_data#
	</method>
	
	<!--  거래명세서 발송시 세금계산서 생성 DT -->
	<method name="in_setApprovalTXDT">
		INSERT INTO ICOYTXDT(HOUSE_CODE,
                     TAX_NO,
                     TAX_SEQ,
                     COMPANY_CODE,
                     ADD_DATE,
                     ADD_TIME,
                     ADD_USER_ID,
                     STATUS,
                     ITEM_CODE,
                     ITEM_DESC,
                     ITEM_SPEC,
                     BUY_DATE,
                     UNIT_PRICE,
                     ITEM_QTY,
                     SUP_AMT,       /* 공급가액 */
                     VAT_AMT,       /* 세액 */
                     FOR_SUP_AMT,   /* 외화금액 */
                     CUR,           /* 통화 */
                     REMARK)
        SELECT 
            TRDT.HOUSE_CODE,
            ${tax_no} AS TAX_NO,
            TRIM (TO_CHAR (ROWNUM, '000000')) AS TAX_SEQ,
            --TRDT.PAY_SEQ AS TAX_SEQ,
            TRHD.VENDOR_CODE AS COMPANY_CODE,
            TO_CHAR(SYSDATE,'YYYYMMDD') AS ADD_DATE,
            TO_CHAR(SYSDATE,'HH24MISS') AS ADD_TIME,
            ${session.ID} AS ADD_USER_ID,
            TRDT.STATUS,
            TRDT.ITEM_NO AS ITEM_CODE,
            TRDT.DESCRIPTION_LOC AS ITEM_DESC,
            TRDT.SPECIFICATION AS ITEM_SPEC,
            TRDT.SPLY_DATE AS BUY_DATE,
            TRDT.UNIT_PRICE AS UNIT_PRICE,
            TRDT.ITEM_QTY AS ITEM_QTY,
            TRDT.ITEM_AMT AS SUP_AMT,
            TRDT.TAX_AMT AS VAT_AMT,
            '' AS FOR_SUP_AMT,
            TRDT.CUR AS CUR,
            SUBSTR((SELECT CASE WHEN PRDT.DEMAND_DEPT IS NULL THEN SUBSTR(NVL(POHD.CONFIRM_DATE,POHD.PO_CREATE_DATE),5) || '신청부서없음' || POHD.SUBJECT || (SELECT VENDOR_NAME_LOC FROM ICOMVNGL WHERE HOUSE_CODE = POHD.HOUSE_CODE AND VENDOR_CODE = POHD.VENDOR_CODE)
                                         		              ELSE SUBSTR(NVL(POHD.CONFIRM_DATE,POHD.PO_CREATE_DATE),5) || OGDP.DEPT_NAME_LOC|| OGDP.DEPT || POHD.SUBJECT || (SELECT VENDOR_NAME_LOC FROM ICOMVNGL WHERE HOUSE_CODE = POHD.HOUSE_CODE AND VENDOR_CODE = POHD.VENDOR_CODE) END AS BR_NAME
              FROM ICOYPODT PODT, ICOYPOHD POHD, ICOYPRDT PRDT, ICOMOGDP OGDP
             WHERE PODT.HOUSE_CODE  = TRDT.HOUSE_CODE
               AND PODT.PO_NO       = TRDT.PO_NO
               AND PODT.PO_SEQ      = TRDT.PO_SEQ
               AND PODT.HOUSE_CODE  = POHD.HOUSE_CODE
               AND PODT.PO_NO       = POHD.PO_NO
               AND PODT.HOUSE_CODE  = PRDT.HOUSE_CODE
               AND PODT.PR_NO       = PRDT.PR_NO
               AND PODT.PR_SEQ      = PRDT.PR_SEQ
               AND PRDT.HOUSE_CODE  = OGDP.HOUSE_CODE
               AND PRDT.DEMAND_DEPT = OGDP.DEPT
               AND ROWNUM = 1),1,33) AS REMARK
        FROM ICOYTRDT TRDT, ICOYTRHD TRHD
        WHERE TRDT.HOUSE_CODE = TRHD.HOUSE_CODE 
          AND TRDT.PAY_NO = TRHD.PAY_NO
          AND TRDT.HOUSE_CODE = ${session.HOUSE_CODE}
          #pay_data#
	</method>
	
		<!-- 생성된 세금계산서 tax_no 정보를 계산서에 수정 -->
	<method name="update_setTRDT">
		UPDATE ICOYTRDT SET TAX_NO = '#tax_no#', 
--                 			TAX_SEQ = PAY_SEQ
							TAX_SEQ = TRIM (TO_CHAR (ROWNUM, '000000'))
		WHERE HOUSE_CODE = ${session.HOUSE_CODE}
		  #pay_data#
	</method>
	
	<!-- (공급사 세금계산서 발행 대상 목록 조회) -->
	<method name="bl_getTrList">
		<![CDATA[
			SELECT
			    TXHD.PROGRESS_CODE AS JOB_STATUS,
			    GETICOMCODE3(TRHD.HOUSE_CODE, 'M401', TXHD.PROGRESS_CODE) AS JOB_STATUS_TXT, 
			    TRHD.PAY_NO,
			    TO_CHAR(TO_DATE(TRHD.ADD_DATE, 'YYYYMMDD'), 'YYYY/MM/DD') AS PAY_DATE,
			    GETUSERNAMELOC (TRHD.HOUSE_CODE, TRHD.ADD_USER_ID) AS ADD_USER_NAME,
			    TRHD.VENDOR_CODE,
			    GETCOMPANYNAMELOC(TRHD.HOUSE_CODE,TRHD.VENDOR_CODE,'S') AS VENDOR_NAME,
			    COUNT(TRDT.PAY_NO) AS ITEM_COUNT,
			    SUM(TRDT.ITEM_QTY) AS ITEM_QTY,
			    TRHD.PAY_AMT,
			    IVHD.PURCHASE_ID,
			    GETUSERNAMELOC(IVHD.HOUSE_CODE,IVHD.PURCHASE_ID) AS PURCHASE_NAME,
			    DECODE(TXHD.BUYER_REJECT_REMARK,'','N','Y') AS REJECT_REASON_FLAG,
			    TXHD.BUYER_REJECT_REMARK AS REJECT_REASON,
			    TXHD.TAX_NO,
			    WBSINF.WBS,
			    WBSINF.WBS_NAME
			FROM ICOYTRHD TRHD, ICOYTRDT TRDT, ICOYIVHD IVHD ,ICOYTXHD TXHD,
				 (SELECT DISTINCT PO.HOUSE_CODE,
			                  PO.PO_NO,
			                  PJTH.PJT_SEQ AS WBS,
			                  PJTH.PJT_CODE AS WBS_CODE, 
			                  PJTH.PJT_NAME AS WBS_NAME
			           FROM ICOYPODT PO, ICOYPRHD PR, ICOYPJTH PJTH
			           WHERE PO.HOUSE_CODE = PR.HOUSE_CODE
			             AND PO.PR_NO = PR.PR_NO 
			          	 AND PR.HOUSE_CODE = PJTH.HOUSE_CODE (+)
			          	 AND PR.WBS = PJTH.PJT_SEQ (+)  
			      )WBSINF			
			
			WHERE TRHD.HOUSE_CODE = TRDT.HOUSE_CODE
			  AND TRHD.PAY_NO = TRDT.PAY_NO
			  AND TRDT.HOUSE_CODE = IVHD.HOUSE_CODE
			  AND TRDT.INV_NO = IVHD.INV_NO
			  AND TRDT.HOUSE_CODE = TXHD.HOUSE_CODE
     		  AND TRDT.TAX_NO = TXHD.TAX_NO
     		  AND TRDT.HOUSE_CODE = WBSINF.HOUSE_CODE
     		  AND TRDT.PO_NO = WBSINF.PO_NO
     		  
			  <OPT=F,S>  AND TRHD.HOUSE_CODE  = ? 			                                      		  </OPT>
			  <OPT=S,S>  AND TRHD.ADD_DATE 	BETWEEN ? </OPT><OPT=S,S>AND ?                                </OPT>
			  <OPT=S,S>  AND TRHD.VENDOR_CODE = ?														  </OPT>
			  <OPT=S,S>  AND TRHD.PAY_NO = ?														  	  </OPT>
			  /* AND TRHD.JOB_STATUS = 'V'	 */
			  AND TXHD.PROGRESS_CODE = 'V'			 
			GROUP BY TRHD.HOUSE_CODE,
			         TRHD.PAY_NO,
			         TRHD.ADD_DATE,
			         TRHD.ADD_USER_ID,
			         TRHD.VENDOR_CODE,
			         TRHD.COM_PERSON_FLAG,
			         TRHD.PAY_AMT,
			         TXHD.PROGRESS_CODE,
			         TXHD.BUYER_REJECT_REMARK,
			         IVHD.HOUSE_CODE,
			         IVHD.PURCHASE_ID,
			         TXHD.HOUSE_CODE,
            		 TXHD.TAX_NO,
            		 WBSINF.WBS,
            		 WBSINF.WBS_NAME
		]]>			
	</method>
	
	<!-- 거래명세서 반려 사유 조회 -->
	<method name="bl_getTxViewReject_reason">
		SELECT
			TXHD.TAX_NO, 
			TXHD.BUYER_REJECT_REMARK
		FROM ICOYTXHD TXHD
		WHERE TXHD.HOUSE_CODE = '#house_code#'
		  AND TXHD.TAX_NO = '#tax_no#'
	</method>
	
	<!-- 세금계산서 진행상태 변경 -->
	<method name="et_setProgressCode">
		UPDATE ICOYTXHD SET CHANGE_DATE = TO_CHAR(SYSDATE,'YYYYMMDD'),
							CHANGE_TIME = TO_CHAR(SYSDATE,'HH24MISS'),
							CHANGE_USER_ID = ${session.ID},
							PROGRESS_CODE = ${progress_code}
						<if test="${progress_code}" operator="eq" value="P">
							,PAY_DEMAND_DATE = TO_CHAR(SYSDATE,'YYYYMMDD')
							,PAY_DEMAND_FLAG = 'Y'
						</if>
						<if test="${progress_code}" operator="eq" value="O">
							,SIGN_STATUS = 'T'
							,PAY_DEMAND_DATE = ''
							,PAY_END_DATE = ''
						</if>
		WHERE HOUSE_CODE = ${session.HOUSE_CODE}
		  AND TAX_NO = ${tax_no}
			
	</method>
	
	<method name="et_setProgressCodes">	
		UPDATE ICOYTXHD SET CHANGE_DATE = TO_CHAR(SYSDATE,'YYYYMMDD'),
							CHANGE_TIME = TO_CHAR(SYSDATE,'HH24MISS'),
							CHANGE_USER_ID = ?,  
							PROGRESS_CODE =  ?	
						<if test="${progress_code}" operator="eq" value="P">
							,PAY_DEMAND_DATE = TO_CHAR(SYSDATE,'YYYYMMDD')
							,PAY_DEMAND_FLAG = 'Y'
						</if>	  
				WHERE HOUSE_CODE = ?   
		  			  AND TAX_NO = ?	  		
	</method>
	
	<!-- 세금계산서 운영사 반려사유 등록  -->
	<method name="et_setBuyerRejectRemark">

		UPDATE ICOYTXHD SET CHANGE_DATE = TO_CHAR(SYSDATE,'YYYYMMDD'),
							CHANGE_TIME = TO_CHAR(SYSDATE,'HH24MISS'),
							CHANGE_USER_ID = '#user_id#',
				<if test="${buyerRejectRemark}" operator="ne" value="">		
							BUYER_REJECT_REMARK = '#buyerRejectRemark#'
				</if>
		WHERE HOUSE_CODE = '#house_code#'
		  AND TAX_NO = '#tax_no#'

	</method>
	
	<!-- 세금계산서 결재요청 -->
	<method name="et_setApproval">
		UPDATE ICOYTXHD SET CHANGE_DATE = TO_CHAR(SYSDATE,'YYYYMMDD'),
							CHANGE_TIME = TO_CHAR(SYSDATE,'HH24MISS'),
							CHANGE_USER_ID = '#user_id#',
							PAY_END_DATE = '#pay_end_date_list#',	
							SIGN_STATUS = '#sign_status#'
		WHERE HOUSE_CODE = '#house_code#'
		  AND TAX_NO = '#tax_no#'		
	</method>
	
	<!-- 세금계산서 결재결과 -->
	<method name="setSignStatusUpdate_1">
		<![CDATA[
			UPDATE ICOYTXHD          
			   SET SIGN_STATUS    = ?  
			      ,SIGN_DATE      = ?
			WHERE HOUSE_CODE 	  = ?         
			  AND TAX_NO		  = ?         
		]]>
	</method>
	
	<method name="setSignStatusUpdate_2">
		<![CDATA[
			UPDATE ICOYTXHD          
			   SET PROGRESS_CODE  = ?
			WHERE HOUSE_CODE 	  = ?         
			  AND TAX_NO		  = ?         
		]]>
	</method>
	<!-- 세금계산서 결재결과 -->
	
	<!--  세금계산서 발행 헤더 조회 -->
	<method name="bl_getTxHD">
	<![CDATA[
			SELECT	S_REG_NO AS SUP_COM_CODE, 
					S_CO_NAME AS SUP_COM_NAME,
					S_CEO_NAME AS SUP_CEO_USER_NAME,
					S_BIZ_CATEGORY AS SUP_BUSINESS_TYPE,		
					S_BIZ_TYPE AS SUP_INDUSTRY_TYPE,
					S_BIZ_ADDR AS SUP_ADDRESS,
					'' AS SUP_USER_ID,
					S_PHONE_NO,
					S_EMAIL,
					B_REG_NO AS BUYER_IRS_NO,
					B_CO_NAME AS BUYER_COM_NAME,
					B_CEO_NAME AS BUYER_CEO_USER_NAME,
					B_BIZ_CATEGORY AS BUYER_BUSINESS_TYPE,
					B_BIZ_TYPE AS BUYER_INDUSTRY_TYPE,
					B_BIZ_ADDR AS BUYER_ADDRESS,
					B_PHONE_NO,
					B_EMAIL,
					TO_CHAR(TO_DATE(ADD_DATE, 'YYYYMMDD'), 'YYYY/MM/DD') ADD_DATE,
					TAX_DIV,
					'' AS BUYER_USER_ID,
					GETICOMCODE1(HOUSE_CODE,'M400',TAX_DIV) AS TAX_DIV_TXT,
					'' AS REMARK,
					MAX(PRICE_TOTAL) AS SUP_AMT,
					MAX(VAT_AMT) AS TAX_AMT,
					MAX(TAX_TOTAL) AS TOT_AMT,
					VENDOR_CODE,
					TAX_NO,
					TAX_APP_NO,
					KTGRM,
					REMARK
					
			FROM 
			(
				SELECT	'C' AS STATUS , 
						IVHD.HOUSE_CODE,
					    IVHD.CONFIRM_DATE1 AS ADD_DATE , 
					    TO_CHAR (SYSDATE,'HH24MISS') AS ADD_TIME , 
					    ${session.ID} AS ADD_USER_ID , 
					    TO_CHAR (SYSDATE,'YYYYMMDD') AS CHANGE_DATE , 
					    TO_CHAR (SYSDATE,'HH24MISS') AS CHANGE_TIME , 
					    ${session.ID} AS CHANGE_USER_ID , 
					    'C' AS COM_PERSON_FLAG , 
					    IVHD.VENDOR_CODE , 
					    '' AS JOB_STATUS , 
					    '1' AS TAX_TYPE , 
					    'P' AS ISSUE_TYPE , 
					    'S' AS ORIGIN_TYPE , 
					    '' AS REJECT_REASON , 
					    '' AS SERIAL_NO , 
				        (
			        	SELECT 
			            	CASE 
			            		WHEN VNGL.TAX_DIV IS NULL OR VNGL.TAX_DIV <> '1' THEN TRUNC(SUM (TRUNC (INV_AMT)))
								ELSE TRUNC(SUM (TRUNC (INV_AMT)) / 1.1)
							END 
						FROM 	ICOYIVDT DT 
						WHERE 	DT.HOUSE_CODE = IVHD.HOUSE_CODE 
						--AND 	DT.INV_NO = IVHD.INV_NO 
						AND 	DT.INV_NO||DT.INV_SEQ IN ('#inv_data#')
			            AND 	DT.STATUS <> 'D' 
						)  AS PRICE_TOTAL , 		              
						(
						SELECT 
							CASE 
								WHEN VNGL.TAX_DIV IS NULL OR VNGL.TAX_DIV <> '1' THEN 0
								ELSE TRUNC(SUM (TRUNC (INV_AMT))) - TRUNC(SUM (TRUNC (INV_AMT)) / 1.1)
							END 
						FROM 	ICOYIVDT DT 
						WHERE 	DT.HOUSE_CODE = IVHD.HOUSE_CODE 
						--AND 	DT.INV_NO = IVHD.INV_NO 
						AND 	DT.INV_NO||DT.INV_SEQ IN ('#inv_data#')
						AND 	DT.STATUS <> 'D' 
						) AS VAT_AMT ,		               
						(
						SELECT 
							CASE 
								WHEN VNGL.TAX_DIV IS NULL OR VNGL.TAX_DIV <> '1' THEN TRUNC(SUM (TRUNC (INV_AMT)))
								ELSE TRUNC(SUM (TRUNC (INV_AMT)) /1.1)
							END 
						FROM 	ICOYIVDT DT 
						WHERE 	DT.HOUSE_CODE = IVHD.HOUSE_CODE 
						--AND 	DT.INV_NO = IVHD.INV_NO 
						AND 	DT.INV_NO||DT.INV_SEQ IN ('#inv_data#')
						AND	 	DT.STATUS <> 'D' 
						) +
				        (
				        SELECT 
				        	CASE 
				        		WHEN VNGL.TAX_DIV IS NULL OR VNGL.TAX_DIV <> '1' THEN 0
								ELSE TRUNC(SUM (TRUNC (INV_AMT))) - TRUNC(SUM (TRUNC (INV_AMT)) / 1.1)
				            END 
						FROM 	ICOYIVDT DT 
						WHERE 	DT.HOUSE_CODE = IVHD.HOUSE_CODE 
						--AND 	DT.INV_NO = IVHD.INV_NO 
						AND 	DT.INV_NO||DT.INV_SEQ IN ('#inv_data#')
						AND 	DT.STATUS <> 'D' 
						) AS TAX_TOTAL ,		               
						(
						SELECT 	SUM (TRUNC (INV_AMT)) 
						FROM 	ICOYIVDT DT 
						WHERE 	DT.HOUSE_CODE = IVHD.HOUSE_CODE 
			            AND 	DT.INV_NO = IVHD.INV_NO 
			            AND 	DT.STATUS <> 'D' 
						) AS PAY_AMT , 
					    '' AS NEXT_PAY_AMT , 
					    '' AS NOTE , 
					    VNGL.IRS_NO AS S_REG_NO , 
					    ADDR.ZIP_CODE||' '||ADDR.ADDRESS_LOC AS S_BIZ_ADDR , 
					    ADDR.CEO_NAME_LOC AS S_CEO_NAME , 
					    VNGL.VENDOR_NAME_LOC AS S_CO_NAME , 
					    VNGL.INDUSTRY_TYPE AS S_BIZ_TYPE , 
					    VNGL.BUSINESS_TYPE AS S_BIZ_CATEGORY , 
					    VNCP.USER_NAME AS S_USER_NAME , 
					    VNCP.EMAIL AS S_EMAIL , 
					    VNCP.PHONE_NO AS S_PHONE_NO , 
					    VNCP.DIVISION AS S_DEPT , 
					    CMGL.IRS_NO AS B_REG_NO , 
					    ADDR1.ZIP_CODE||' '||ADDR1.ADDRESS_LOC AS B_BIZ_ADDR , 
					    ADDR1.CEO_NAME_LOC AS B_CEO_NAME , 
					    CMGL.COMPANY_NAME_LOC AS B_CO_NAME , 
					    CMGL.INDUSTRY_TYPE AS B_BIZ_TYPE , 
					    CMGL.BUSINESS_TYPE AS B_BIZ_CATEGORY , 
					    '' AS B_USER_NAME , 
					    ADDR1.EMAIL AS B_EMAIL , 
					    ADDR1.PHONE_NO1 AS B_PHONE_NO , 
					    '' AS B_DEPT , 
					    'D' AS R_D_FLAG , 
					    '' AS CASH , 
					    '' AS PAYCHECK , 
					    '' AS DRAFT , 
					    '' AS CREDIT , 
					    '' AS CHIT_NO , 
					    '' AS PSTNG_DATE , 
					    '' AS SIGN_STATUS , 
					    to_char(sysdate,'YYYYMMDD') AS SIGN_DATE , 
					    '' AS REMARKS ,
						'' AS CTRL_CODE,
						VNGL.tax_div AS TAX_DIV, 
					    CASE WHEN IVDT.TAX_YN = 'Y' THEN TRDT.TAX_NO 
				      	ELSE ''
				      	END AS TAX_NO,
						TXHD.TAX_APP_NO,
						TXHD.KTGRM,
						TXHD.REMARK
						FROM 	ICOYIVHD IVHD, ICOMVNGL VNGL, ICOMVNCP VNCP, ICOMLUSR LUSR, ICOMADDR ADDR, ICOMCMGL CMGL, ICOMADDR ADDR1 , ICOYTXHD TXHD ,ICOYTRDT TRDT	, ICOYIVDT IVDT
						WHERE 	IVHD.HOUSE_CODE = ${session.HOUSE_CODE}
					    AND 	IVHD.INV_NO IN ('#inv_no_str#')
					    AND  	IVDT.INV_NO||IVDT.INV_SEQ IN ('#inv_data#') 
						AND     IVHD.STATUS <> 'D' 
						--AND 	IVHD.HOUSE_CODE = TRDT.HOUSE_CODE(+)
						--AND 	IVHD.INV_NO = TRDT.INV_NO(+)
      					AND  	IVDT.INV_NO = TRDT.INV_NO(+)
      					AND  	IVDT.INV_SEQ = TRDT.INV_SEQ(+)						
					    AND     IVHD.HOUSE_CODE = VNGL.HOUSE_CODE 
					    AND     IVHD.VENDOR_CODE = VNGL.VENDOR_CODE 
					    AND     VNGL.STATUS <> 'D' 
					    AND     VNGL.HOUSE_CODE = VNCP.HOUSE_CODE 
					    AND     VNGL.VENDOR_CODE = VNCP.VENDOR_CODE 
					    AND     VNGL.HOUSE_CODE = LUSR.HOUSE_CODE 
					    AND     VNGL.VENDOR_CODE = LUSR.COMPANY_CODE 
					    AND     LUSR.USER_TYPE = 'S' 
					    AND     LUSR.STATUS <> 'D' 
					    AND     LUSR.HOUSE_CODE = ADDR.HOUSE_CODE 
					    AND     LUSR.COMPANY_CODE = ADDR.CODE_NO 
					    AND     ADDR.CODE_TYPE = '2' 
					    AND     IVHD.HOUSE_CODE = CMGL.HOUSE_CODE 
					    AND     IVHD.COMPANY_CODE = CMGL.COMPANY_CODE 
					    AND     CMGL.STATUS <> 'D' 
					    AND     CMGL.HOUSE_CODE = ADDR1.HOUSE_CODE 
					    AND     CMGL.COMPANY_CODE = ADDR1.CODE_NO 
					    AND     ADDR1.CODE_TYPE = '1'
					    AND 	   TRDT.TAX_NO = TXHD.TAX_NO(+)					         
			) 
			GROUP BY 	HOUSE_CODE ,   		STATUS ,       	ADD_DATE ,	    ADD_TIME , 
						ADD_USER_ID ,      	CHANGE_DATE ,  	CHANGE_TIME ,  	CHANGE_USER_ID , 	COM_PERSON_FLAG , 
					    VENDOR_CODE ,      	JOB_STATUS ,   	TAX_TYPE ,     	ISSUE_TYPE ,      	ORIGIN_TYPE , 
					    REJECT_REASON ,    	SERIAL_NO ,    	NOTE ,  	    S_REG_NO , 	   		S_BIZ_ADDR , 
					    S_CEO_NAME ,       	S_CO_NAME ,    	S_BIZ_TYPE ,   	S_BIZ_CATEGORY ,  	S_USER_NAME , 
					    S_EMAIL ,  		   	S_PHONE_NO ,   	S_DEPT , 	    B_REG_NO ,        	B_BIZ_ADDR , 
					    B_CEO_NAME ,       	B_CO_NAME ,    	B_BIZ_TYPE ,   	B_BIZ_CATEGORY ,  	B_USER_NAME , 
					    B_EMAIL , 	       	B_PHONE_NO ,   	B_DEPT ,       	R_D_FLAG ,			CHIT_NO , 
					    PSTNG_DATE , 		SIGN_STATUS ,	SIGN_DATE ,		REMARKS ,			CTRL_CODE,
						TAX_DIV,			TAX_NO	,		TAX_APP_NO,		KTGRM	    ,           REMARK	
			]]>
	</method>
	<!--  세금계산서 발행 헤더 조회 -->
	<method name="bl_getTxHD_bak">
		/* 세금계산서 헤더 */
		SELECT DISTINCT 
		    TXHD.TAX_NO,                                                                /* 세금계산서 번호       */
		    TO_CHAR(TO_DATE(TXHD.TAX_DATE),'YYYY/MM/DD') AS TAX_DATE ,                  /* 발행일자              */
		    TXHD.TAX_APP_NO AS TAX_APP_NO,															/* 승인번호			  */
		    TRHD.S_REG_NO AS SUP_COM_CODE,                                                            /* 공급자 사업자등록번호 */
		    --TXHD.SUP_COM_CODE,                                                          /* 공급자 회사코드       */
		    TRHD.S_CO_NAME AS SUP_COM_NAME,															/* 공급자 회사명         */
		    /* GETVENDORNAME(TXHD.HOUSE_CODE,TXHD.SUP_COM_CODE) AS  SUP_COM_NAME,          공급자 회사명         */
		    TRHD.S_CEO_NAME AS SUP_CEO_USER_NAME,                                                     /* 공급자 대표자         */
		    TRHD.S_BIZ_CATEGORY AS SUP_BUSINESS_TYPE,                                                     /* 공급자 업태           */
		    TRHD.S_BIZ_TYPE AS SUP_INDUSTRY_TYPE,                                                     /* 공급자 업종           */
		    TRHD.S_BIZ_ADDR AS SUP_ADDRESS,                                                           /* 공급자 주소           */
		    '' AS SUP_USER_ID,                                                          /* 공급자 담당자         */                     
		    TRHD.S_PHONE_NO AS S_PHONE_NO,                                                            /* 공급자 연락처         */
		    TRHD.S_EMAIL AS S_EMAIL,                                                               /* 공급자 E-MAIL        */
		    TRHD.B_REG_NO AS BUYER_IRS_NO,                                                          /* 공급받는자 사업자등록번호 */
		    TRHD.B_CO_NAME AS BUYER_COM_NAME,                                                        /* 공급받는자 회사명     */
		    TRHD.B_CEO_NAME AS BUYER_CEO_USER_NAME,                                                   /* 공급받는자 대표자     */
		    TRHD.B_BIZ_CATEGORY AS BUYER_BUSINESS_TYPE,                                                   /* 공급받는자 업태       */
		    TRHD.B_BIZ_TYPE AS BUYER_INDUSTRY_TYPE,                                                   /* 공급받는자 업종       */
		    TRHD.B_BIZ_ADDR AS BUYER_ADDRESS,                                                         /* 공급받는자 주소       */
		    '' AS BUYER_USER_ID,                                                        /* 공급받는자 담당자     */
		    TRHD.B_PHONE_NO AS B_PHONE_NO,                                                            /* 공급받는자 연락처     */
		    TRHD.B_EMAIL AS B_EMAIL,                                                               /* 공급받는자 E-MAIL    */
		    TO_CHAR(TO_DATE(TXHD.ADD_DATE),'YYYY/MM/DD') AS ADD_DATE,                   /* 작성일자              */
		    TRHD.TAX_DIV,                                                               /* 과세구분              */
		    GETICOMCODE1(TRHD.HOUSE_CODE,'M400',TRHD.TAX_DIV) AS TAX_DIV_TXT,           /* 과세구분              */ 
		    '' AS REMARK,														        /* 비고                  */                             
		      SUM(TRDT.ITEM_AMT) AS SUP_AMT,                                                               /* 공급가액              */
		    DECODE(TRHD.TAX_DIV,'1',TRUNC(SUM(TRDT.TAX_AMT)),0) AS TAX_AMT,					/* 세액                  */
		    DECODE(TRHD.TAX_DIV,'1',(SUM(TRDT.ITEM_AMT) + TRUNC(SUM(TRDT.TAX_AMT))),SUM(TRDT.ITEM_AMT)) AS TOT_AMT,	/* 합계금액              */
		    TXHD.ATTACH_NO															/* 첨부파일              */
		    --(SELECT USER_NAME_LOC FROM ICOMLUSR WHERE HOUSE_CODE = TXHD.HOUSE_CODE AND USER_ID = TXHD.ADD_USER_ID) AS ADD_USER_NAME    
		    
		FROM ICOYTXHD TXHD, ICOYTRHD TRHD, ICOYTRDT TRDT
		WHERE TRHD.HOUSE_CODE = TRDT.HOUSE_CODE
		  AND TRHD.PAY_NO = TRDT.PAY_NO
		  AND TRDT.TAX_NO = TXHD.TAX_NO(+)
		  AND TRDT.TAX_NO = TXHD.TAX_NO(+)
		  AND TRHD.HOUSE_CODE = ${session.HOUSE_CODE}
		  #pay_data#	
		GROUP BY            TXHD.TAX_NO,                                                                /* 세금계산서 번호       */
		            TXHD.TAX_DATE,                                                              /* 발행일자              */
		            TRHD.S_REG_NO,                                                            /* 공급자 사업자등록번호 */
		            TXHD.TAX_APP_NO,															/* 승인번호			  */
		            --TXHD.SUP_COM_CODE,                                                          /* 공급자 회사코드       */
		           	TRHD.S_CO_NAME,															/* 공급자 회사명         */
		            TRHD.S_CEO_NAME,                                                     /* 공급자 대표자         */
		            TRHD.S_BIZ_CATEGORY,                                                     /* 공급자 업태           */
		            TRHD.S_BIZ_TYPE,                                                     /* 공급자 업종           */
		            TRHD.S_BIZ_ADDR,                                                           /* 공급자 주소           */
		            TRHD.S_PHONE_NO,                                                            /* 공급자 연락처         */
		            TRHD.S_EMAIL,                                                               /* 공급자 E-MAIL        */
		            TRHD.B_REG_NO,                                                          /* 공급받는자 사업자등록번호 */
		            TRHD.B_CO_NAME,                                                        /* 공급받는자 회사명     */
		            TRHD.B_CEO_NAME,                                                   /* 공급받는자 대표자     */
		            TRHD.B_BIZ_CATEGORY,                                                   /* 공급받는자 업태       */
		            TRHD.B_BIZ_TYPE,                                                   /* 공급받는자 업종       */
		            TRHD.B_BIZ_ADDR,                                                         /* 공급받는자 주소       */
		            TRHD.B_PHONE_NO,                                                            /* 공급받는자 연락처     */
		            TRHD.B_EMAIL,                                                               /* 공급받는자 E-MAIL     */
		            TXHD.ADD_DATE,                                                              /* 작성일자              */
		            TRHD.HOUSE_CODE,
		            TRHD.TAX_DIV,                                                               /* 과세구분              */
		            --TXHD.SUP_AMT,                                                               /* 공급가액              */
		            TXHD.ATTACH_NO																/* 첨부파일              */
		            --TXHD.ADD_USER_ID
	</method>
	<!--  세금계산서 발행 상세 조회 -->
	<method name="bl_getTxDT">
	<![CDATA[ 
		SELECT 	IVDT.DESCRIPTION_LOC
		,		IVDT.ITEM_NO AS ITEM_CODE
		,		IVDT.DESCRIPTION_LOC AS ITEM_DESC
		,		DECODE 	(
						IVDT.SPECIFICATION,
						NULL,
						(
						SELECT 	PRDT.SPECIFICATION 
						FROM 	ICOYPODT PODT, ICOYPRDT PRDT 
			            WHERE PODT.HOUSE_CODE = PRDT.HOUSE_CODE 
			            AND PODT.PR_NO  = PRDT.PR_NO 
			            AND PODT.PR_SEQ = PRDT.PR_SEQ 
			            AND PODT.HOUSE_CODE = IVDT.HOUSE_CODE 
			            AND PODT.PO_NO = IVDT.PO_NO
			            AND PODT.PO_SEQ = IVDT.PO_SEQ
			            ),
						IVDT.SPECIFICATION
				) AS ITEM_SPEC
		,		IVDT.GR_QTY AS ITEM_QTY
		,		IVDT.UNIT_PRICE 
		,		VNGL.TAX_DIV
		,		CASE 
					WHEN VNGL.TAX_DIV IS NULL OR VNGL.TAX_DIV <> '1' THEN TRUNC ((IVDT.UNIT_PRICE * IVDT.GR_QTY))
					ELSE TRUNC ((IVDT.UNIT_PRICE * IVDT.GR_QTY)/1.1)
				END AS SUP_AMT
		,		CASE 
					WHEN VNGL.TAX_DIV IS NULL OR VNGL.TAX_DIV <> '1' THEN 0
					ELSE TRUNC ((IVDT.UNIT_PRICE * IVDT.GR_QTY)) - TRUNC((IVDT.UNIT_PRICE * IVDT.GR_QTY)/1.1)
				END AS VAT_AMT
				
		,		CASE 
					WHEN VNGL.TAX_DIV IS NULL OR VNGL.TAX_DIV <> '1' THEN TRUNC ((IVDT.UNIT_PRICE * IVDT.GR_QTY))
					ELSE TRUNC ((IVDT.UNIT_PRICE * IVDT.GR_QTY)/1.1)
				END 
		+		CASE 
					WHEN VNGL.TAX_DIV IS NULL OR VNGL.TAX_DIV <> '1' THEN 0
					ELSE TRUNC ((IVDT.UNIT_PRICE * IVDT.GR_QTY)) - TRUNC((IVDT.UNIT_PRICE * IVDT.GR_QTY)/1.1)
				END AS TOT_PRICE
   		,  		MTGL.KTGRM
   		,  		(SELECT TEXT2 FROM SCODE WHERE TYPE = 'M346' AND CODE = MTGL.KTGRM AND DEL_FLAG = 'N' AND USE_FLAG = 'Y') AS ACCOUNT_TYPE
   		,		MTGL.MATERIAL_TYPE
        ,       SUBSTR((SELECT CASE WHEN PRDT.PURCHASE_DEPT IS NULL THEN SUBSTR(NVL(POHD.CONFIRM_DATE,POHD.PO_CREATE_DATE),5) || '신청부서없음' || POHD.SUBJECT || (SELECT VENDOR_NAME_LOC FROM ICOMVNGL WHERE HOUSE_CODE = POHD.HOUSE_CODE AND VENDOR_CODE = POHD.VENDOR_CODE)    
                       			                                    ELSE SUBSTR(NVL(POHD.CONFIRM_DATE,POHD.PO_CREATE_DATE),5) || OGDP.DEPT_NAME_LOC || OGDP.DEPT || POHD.SUBJECT END || (SELECT VENDOR_NAME_LOC FROM ICOMVNGL WHERE HOUSE_CODE = POHD.HOUSE_CODE AND VENDOR_CODE = POHD.VENDOR_CODE)
                   		  FROM ICOYPODT PODT, ICOYPOHD POHD, ICOYPRDT PRDT, ICOMOGDP OGDP
                  		 WHERE PODT.HOUSE_CODE    = IVDT.HOUSE_CODE
                    	   AND PODT.PO_NO         = IVDT.PO_NO
                    	   AND PODT.PO_SEQ        = IVDT.PO_SEQ
                    	   AND PODT.HOUSE_CODE    = POHD.HOUSE_CODE
                    	   AND PODT.PO_NO         = POHD.PO_NO
                    	   AND PODT.PR_NO         = PRDT.PR_NO
                    	   AND PODT.PR_SEQ        = PRDT.PR_SEQ
                    	   AND PRDT.HOUSE_CODE    = OGDP.HOUSE_CODE
                    	   AND PRDT.DEMAND_DEPT   = OGDP.DEPT
                    	   AND ROWNUM = 1),1,33)  AS REMARK
        FROM	ICOYIVHD IVHD, ICOYIVDT IVDT, ICOYPOHD POHD, ICOMMTGL MTGL, ICOMVNGL VNGL 
		WHERE 	IVHD.HOUSE_CODE = ${session.HOUSE_CODE}
		AND 	IVHD.INV_NO||IVDT.INV_SEQ IN ('#inv_data#')
		AND 	IVHD.HOUSE_CODE = IVDT.HOUSE_CODE
		AND		IVHD.INV_NO = IVDT.INV_NO
		AND   	IVDT.HOUSE_CODE = POHD.HOUSE_CODE
		AND   	IVDT.PO_NO = POHD.PO_NO
		AND   	POHD.STATUS != 'D'
		AND   	IVDT.HOUSE_CODE = MTGl.HOUSE_CODE
		AND   	IVDT.ITEM_NO = MTGl.ITEM_NO
		AND 	VNGL.VENDOR_CODE = IVHD.VENDOR_CODE 
		AND 	VNGL.HOUSE_CODE = IVDT.HOUSE_CODE
		AND 	IVHD.STATUS = 'R'
		ORDER BY IVHD.INV_NO
	]]>
	</method>
	<method name="bl_getTxDT_bak">
			SELECT 
			      TRDT.ADD_DATE AS BUY_DATE,
			      TRDT.ITEM_NO AS ITEM_CODE,                                                         
			      TRDT.DESCRIPTION_LOC AS ITEM_DESC,                                                          
			      TRDT.SPECIFICATION AS ITEM_SPEC,                                                           
			      TRDT.ITEM_QTY AS ITEM_QTY,
			      TRDT.UNIT_PRICE AS UNIT_PRICE,
			      TRDT.ITEM_AMT AS SUP_AMT,
			      DECODE(TRHD.TAX_DIV,'1',TRDT.TAX_AMT,0) AS VAT_AMT,
			      PRDT.ACCOUNT_TYPE,
			      TXDT.REMARK	
			  FROM ICOYTXDT TXDT, ICOYTRDT TRDT, ICOYTRHD TRHD, 
			       ICOYPODT PODT, ICOYPRDT PRDT
			  WHERE TXDT.HOUSE_CODE(+) = TRDT.HOUSE_CODE
			    AND TXDT.TAX_NO(+) = TRDT.TAX_NO
			    AND TXDT.TAX_SEQ(+) = TRDT.TAX_SEQ
			    AND TRDT.HOUSE_CODE = PODT.HOUSE_CODE
			    AND TRDT.PO_NO = PODT.PO_NO
			    AND TRDT.PO_SEQ = PODT.PO_SEQ
			    AND PODT.HOUSE_CODE = PRDT.HOUSE_CODE
			    AND PODT.PR_NO = PRDT.PR_NO
			    AND PODT.PR_SEQ = PRDT.PR_SEQ
			    AND TRDT.HOUSE_CODE = TRHD.HOUSE_CODE
       			AND TRDT.PAY_NO = TRHD.PAY_NO
				AND TRDT.HOUSE_CODE = ${session.HOUSE_CODE}
				#pay_data# 
			 ORDER BY TXDT.TAX_SEQ
	</method>
	
	<!-- 세금계산서 발행 정보 저장  -->
	<method name="et_setTxTaxAppNo">
		UPDATE ICOYTXHD SET CHANGE_DATE = TO_CHAR(SYSDATE,'YYYYMMDD'),
							CHANGE_TIME = TO_CHAR(SYSDATE,'HH24MISS'),
							CHANGE_USER_ID = $${session.ID},
							TAX_APP_NO 	= ${tax_app_no},
		                    TAX_DATE 	= ${tax_date},
		                    PROC_DEPT 	= ${proc_dept}
		WHERE HOUSE_CODE = ${session.HOUSE_CODE}
		  AND TAX_NO = ${tax_no}        
	
	</method>
	
	<!-- 세금계산서 현황 -->
	<method name="bl_getTxList2">
		<![CDATA[
			SELECT DISTINCT 
			    TXHD.TAX_NO,                                                                /* 세금계산서 번호       */
			    TXHD.TAX_APP_NO,                                                            /* 승인번호              */
			    TO_CHAR(TO_DATE(TXHD.TAX_DATE, 'YYYYMMDD'), 'YYYY/MM/DD') TAX_DATE,                                                              /* 발행일자              */
			    TO_CHAR(TO_DATE(TXHD.ADD_DATE, 'YYYYMMDD'), 'YYYY/MM/DD') ADD_DATE,                                                              /* 작성일자              */
			    TRHD.TAX_DIV,                                                               /* 과세구분              */
			    GETICOMCODE1(TRHD.HOUSE_CODE,'M400',TRHD.TAX_DIV) AS TAX_DIV_TXT,           /* 과세구분              */                                      
			    TXHD.SUP_AMT,                                                               /* 공급가액              */
		        DECODE(TRHD.TAX_DIV,1,SUM(TRDT.TAX_AMT),0) AS TAX_AMT,
		        TXHD.SUP_AMT + DECODE(TRHD.TAX_DIV,1,SUM(TRDT.TAX_AMT),0) AS TOT_AMT,
			    TRHD.PAY_NO,
			    TXHD.PROGRESS_CODE,
			    GETICOMCODE3(TXHD.HOUSE_CODE,'M401',TXHD.PROGRESS_CODE) AS PROGRESS_CODE_TXT,
			    DECODE(TXHD.BUYER_REJECT_REMARK,'','N','Y') AS REJECT_REASON_FLAG,
       			TXHD.BUYER_REJECT_REMARK AS REJECT_REASON,
			    WBSINF.WBS,
			    WBSINF.WBS_NAME  
			FROM ICOYTXHD TXHD, ICOYTRHD TRHD, ICOYTRDT TRDT,
				 (SELECT DISTINCT PO.HOUSE_CODE,
			                  PO.PO_NO,
			                  PJTH.PJT_SEQ AS WBS,
			                  PJTH.PJT_CODE AS WBS_CODE, 
			                  PJTH.PJT_NAME AS WBS_NAME
			           FROM ICOYPODT PO, ICOYPRHD PR, ICOYPJTH PJTH
			           WHERE PO.HOUSE_CODE = PR.HOUSE_CODE
			             AND PO.PR_NO = PR.PR_NO 
			          	 AND PR.HOUSE_CODE = PJTH.HOUSE_CODE (+)
			          	 AND PR.WBS = PJTH.PJT_SEQ (+)  
			      )WBSINF
			
			WHERE TXHD.HOUSE_CODE = TRHD.HOUSE_CODE
			  AND TRHD.HOUSE_CODE = TRDT.HOUSE_CODE
			  AND TRHD.PAY_NO = TRDT.PAY_NO
			  AND TXHD.TAX_NO = TRDT.TAX_NO
			  AND TRDT.HOUSE_CODE = WBSINF.HOUSE_CODE
			  AND TRDT.PO_NO = WBSINF.PO_NO
			  AND TXHD.HOUSE_CODE = '#house_code#'
			  AND TXHD.COMPANY_CODE = '#company_code#'
			  AND TXHD.PROGRESS_CODE IN ('D','I','C','R','B','O','E','P')
			  <OPT=S,S>  AND TXHD.TAX_DATE 	BETWEEN ? </OPT><OPT=S,S>AND ?              </OPT>
			  <OPT=S,S>  AND TXHD.TAX_APP_NO = ?										</OPT>
			  <OPT=S,S>  AND TXHD.PROGRESS_CODE = ?										</OPT>
			  <OPT=S,S>  AND TRHD.TAX_DIV = ?											</OPT>
			  
			GROUP BY TXHD.HOUSE_CODE,    
			         TXHD.TAX_NO,                                                                /* 세금계산서 번호       */
			         TXHD.TAX_APP_NO,                                                            /* 승인번호              */
			         TXHD.TAX_DATE,                                                              /* 발행일자              */
			         TXHD.ADD_DATE,                                                              /* 작성일자              */
			         TRHD.HOUSE_CODE,
			         TRHD.TAX_DIV,                                                               /* 과세구분              */
			         TXHD.SUP_AMT,                                                               /* 공급가액              */
			         TRHD.PAY_NO,
			         TXHD.PROGRESS_CODE,
			         TXHD.BUYER_REJECT_REMARK,
			         WBSINF.WBS,
			         WBSINF.WBS_NAME 
			         
			ORDER BY TXHD.ADD_DATE DESC, TXHD.TAX_NO DESC      			         
		]]> 	
	</method>
	<!--  세금계산서 현황 -->
	<method name="bl_getTaxList">
		
			SELECT
				    TO_CHAR(TO_DATE(TRHD.ADD_DATE,'YYYYMMDD'), 'YYYY/MM/DD') ADD_DATE,
				    TXHD.TAX_NO,
				    TRHD.PAY_NO,
				    IVHD.INV_NO,
				    IVHD.IV_NO,
				    TRHD.VENDOR_CODE,
				    GETCOMPANYNAMELOC(TRHD.HOUSE_CODE,TRHD.VENDOR_CODE,'S') AS VENDOR_NAME,
				    TXHD.SUP_IRS_NO,
				    TO_CHAR(TO_DATE(TXHD.TAX_DATE,'YYYYMMDD'), 'YYYY/MM/DD') TAX_DATE,
				    TXHD.TAX_APP_NO,
				    TRHD.TAX_DIV,                                                    
	                GETICOMCODE1(TRHD.HOUSE_CODE,'M400',TRHD.TAX_DIV) AS TAX_DIV_TXT, 
				    TXHD.SUP_AMT,
			        DECODE(TRHD.TAX_DIV,1,TRUNC(SUM(TRDT.TAX_AMT)),0) AS TAX_AMT,
			        TXHD.SUP_AMT + DECODE(TRHD.TAX_DIV,1,TRUNC(SUM(TRDT.TAX_AMT)),0) AS TOT_AMT,
				    TO_CHAR(TO_DATE(TXHD.PAY_DEMAND_DATE,'YYYYMMDD'), 'YYYY/MM/DD') PAY_DEMAND_DATE,
				    TXHD.PAY_END_DATE,
				    TXHD.PROGRESS_CODE,
	                GETICOMCODE1(TXHD.HOUSE_CODE,'M401',TXHD.PROGRESS_CODE) AS PROGRESS_CODE_TXT,
	                TRDT.PO_NO,
	                TXHD.SIGN_STATUS,
	                WBSINF.WBS,
                	WBSINF.WBS_NAME,
                	TXHD.ADD_USER_ID AS PURCHARSE_ID,
        			GETUSERNAMELOC(TXHD.HOUSE_CODE, TXHD.ADD_USER_ID) AS PURCHARSE_NAME ,
        			GETICOMCODE1(TXHD.HOUSE_CODE,'M010',(SELECT PAY_TERMS 
		                                                 FROM ICOYPOHD
		                                                 WHERE HOUSE_CODE = TRDT.HOUSE_CODE 
		                                                   AND PO_NO = TRDT.PO_NO
		                                                 ) 
		                         ) AS PAY_TERMS_DESC 			    
				    
				FROM ICOYTRHD TRHD, ICOYTRDT TRDT, ICOYIVHD IVHD ,ICOYTXHD TXHD,
					 (SELECT DISTINCT PO.HOUSE_CODE,
			                  PO.PO_NO,
			                  PJTH.PJT_SEQ AS WBS,
			                  PJTH.PJT_CODE AS WBS_CODE, 
			                  PJTH.PJT_NAME AS WBS_NAME
			           FROM ICOYPODT PO, ICOYPRHD PR, ICOYPJTH PJTH
			           WHERE PO.HOUSE_CODE = PR.HOUSE_CODE
			             AND PO.PR_NO = PR.PR_NO 
			          	 AND PR.HOUSE_CODE = PJTH.HOUSE_CODE (+)
			          	 AND PR.WBS = PJTH.PJT_SEQ (+)  
			          ) WBSINF

				WHERE TRHD.HOUSE_CODE = TRDT.HOUSE_CODE
				  AND TRHD.PAY_NO = TRDT.PAY_NO
				  AND TRDT.HOUSE_CODE = IVHD.HOUSE_CODE
				  AND TRDT.INV_NO = IVHD.INV_NO
				  AND TRDT.HOUSE_CODE = TXHD.HOUSE_CODE
	     		  AND TRDT.TAX_NO = TXHD.TAX_NO
	     		  AND TRDT.HOUSE_CODE = WBSINF.HOUSE_CODE
	     		  AND TRDT.PO_NO = WBSINF.PO_NO
				  AND TRHD.HOUSE_CODE  = '#house_code#'
				
				<if test="${progress_code}" operator="eq" value="PE">
				   AND TXHD.PROGRESS_CODE IN ('P','E','B')
				</if> 
				  
				<![CDATA[  
				  <OPT=S,S>  AND TXHD.COMPANY_CODE = ?										</OPT>
				  <OPT=S,S>  AND TXHD.ADD_DATE 	BETWEEN ? </OPT><OPT=S,S>AND ?              </OPT>
				  <OPT=S,S>  AND TXHD.TAX_DATE 	BETWEEN ? </OPT><OPT=S,S>AND ?              </OPT>
				  <OPT=S,S>  AND TXHD.PROGRESS_CODE = ?										</OPT>
				  <OPT=S,S>  AND TRHD.TAX_DIV = ?											</OPT>
				  <OPT=S,S>  AND TXHD.TAX_APP_NO = ?										</OPT>
				  <OPT=S,S>  AND TXHD.SIGN_STATUS = ?										</OPT>
				  <OPT=S,S>  AND TXHD.ADD_USER_ID = ?										</OPT>
					]]>   			  			 
				GROUP BY TXHD.HOUSE_CODE,
				         TRHD.HOUSE_CODE,
				         TRDT.HOUSE_CODE,
				         IVHD.HOUSE_CODE,
				         TXHD.TAX_NO,
				         TRHD.PAY_NO,
				         IVHD.INV_NO,
				         IVHD.IV_NO,
				         TRHD.ADD_DATE,
				         TRHD.VENDOR_CODE,
				         TXHD.SUP_IRS_NO,
				         TXHD.TAX_DATE,
				         TXHD.TAX_APP_NO,
				         TXHD.ADD_USER_ID,
				         TRHD.TAX_DIV,
				         TXHD.SUP_AMT,
				         TXHD.PAY_DEMAND_DATE,
				         TXHD.PAY_END_DATE,
				         TXHD.PROGRESS_CODE,
				         TRDT.PO_NO,
				         TXHD.SIGN_STATUS,
				         WBSINF.WBS,
             			 WBSINF.WBS_NAME
			ORDER BY TRHD.ADD_DATE DESC, TXHD.TAX_NO DESC
	
	</method>
	<!-- 구매요청상태 변경 -->
	<method name="setPr_progress_flag_1">
		    SELECT COUNT(TRHD.PAY_NO) AS TR_CNT
			        FROM  ICOYTRDT TRDT1, ICOYTRDT TRDT2, ICOYTRHD TRHD 
			        WHERE TRDT1.HOUSE_CODE = TRDT2.HOUSE_CODE
			          AND TRDT1.PO_NO = TRDT2.PO_NO
			          AND TRDT1.HOUSE_CODE = TRHD.HOUSE_CODE
			          AND TRDT1.PAY_NO = TRHD.PAY_NO
			          AND TRDT2.HOUSE_CODE = '#house_code#'
			          AND TRDT2.TAX_NO = '#doc_no#'
			          AND TRHD.STATUS <![CDATA[ <> ]]> 'D' 
			          AND TRHD.JOB_STATUS = 'V'
	
	</method>
	
	<method name="setPr_progress_flag_2">	
			SELECT COUNT(TXHD.TAX_NO) AS TX_CNT
			        FROM  ICOYTRDT TRDT1, ICOYTRDT TRDT2, ICOYTXHD TXHD
			        WHERE TRDT1.HOUSE_CODE = TRDT2.HOUSE_CODE
			          AND TRDT1.PO_NO = TRDT2.PO_NO
			          AND TRDT1.HOUSE_CODE = TXHD.HOUSE_CODE
			          AND TRDT1.TAX_NO = TXHD.TAX_NO
			          AND TRDT2.HOUSE_CODE = '#house_code#'
			          AND TRDT2.TAX_NO = '#doc_no#'
			          AND TXHD.SIGN_STATUS = 'E'
			          AND TXHD.PROGRESS_CODE = 'C'
			          AND TXHD.STATUS  <![CDATA[ <> ]]> 'D'	   
	</method>
	
	<method name="setPr_progress_flag_3">
			UPDATE ICOYPRDT SET PR_PROCEEDING_FLAG = '#pr_progress_flag#'
			                    ,CHANGE_DATE = TO_CHAR(SYSDATE,'YYYYMMDD')
			                    ,CHANGE_TIME = TO_CHAR(SYSDATE,'HH24MISS')
			                    ,CHANGE_USER_ID = '#user_id#'
			WHERE PR_NO = (SELECT DISTINCT PRDT.PR_NO
		                   FROM ICOYTRDT TRDT, ICOYIVDT IVDT, ICOYPODT PODT, ICOYPRDT PRDT
		                   WHERE TRDT.HOUSE_CODE = TRDT.HOUSE_CODE
		                     AND TRDT.INV_NO = IVDT.INV_NO
		                     AND TRDT.INV_SEQ = IVDT.INV_SEQ
		                     AND IVDT.HOUSE_CODE = PODT.HOUSE_CODE
		                     AND IVDT.PO_NO = PODT.PO_NO
		                     AND IVDT.PO_SEQ = PODT.PO_SEQ
		                     AND PODT.HOUSE_CODE = PRDT.HOUSE_CODE
		                     AND PODT.PR_NO = PRDT.PR_NO
		                     AND PODT.PR_SEQ = PRDT.PR_SEQ
		                     AND TRDT.HOUSE_CODE = '#house_code#'
		                     AND TRDT.TAX_NO = '#doc_no#' ) 
			AND PR_PROCEEDING_FLAG = '#prev_pr_progress_flag#'		
		
	</method>
	
	<!--  인터페이스 불러오기  -->
	<method name="getERPTaxList">
			SELECT 
			    TXHD.TAX_DATE AS RD_DATE
			    ,(SELECT IRS_NO
			      FROM ICOMVNGL
			      WHERE HOUSE_CODE = IVHD.HOUSE_CODE
			        AND VENDOR_CODE = IVHD.VENDOR_CODE
			        AND ROWNUM = 1
			      ) AS VENDOR_CODE
			    ,IVDT.INV_NO
			    ,IVDT.INV_SEQ
			    ,TXDT.TAX_NO
			    ,TXDT.TAX_SEQ
			    ,PJTH.ERP_ID
			    ,TXDT.ITEM_CODE
			    ,'2' AS UNIT_MEASURE
			    ,TXDT.ITEM_QTY
			    ,TXDT.UNIT_PRICE
			    ,(SELECT TAX_DIV FROM ICOYTRHD 
			      WHERE HOUSE_CODE = TRDT.HOUSE_CODE
			        AND PAY_NO = TRDT.PAY_NO 
			        AND ROWNUM = 1 
			     )AS TAX_DIV
			    ,TXHD.ADD_USER_ID
			    ,GETUSERNAMELOC(IVDT.HOUSE_CODE,TXHD.ADD_USER_ID) AS USER_NAME_LOC
			    ,DECODE(IVDT.STATUS,'C','A','R','A','D') AS STATUS
			    ,TXHD.TAX_DATE
			    ,TXHD.PAY_END_DATE
			    ,(SELECT COUNT(*) FROM ICOYTXDT 
			      WHERE HOUSE_CODE = TXHD.HOUSE_CODE
			        AND TAX_NO = TXHD.TAX_NO) AS COUNT
			    ,PRDT.ASSET_TYPE
			    , DECODE(MTGL.KTGRM,'01',
    		         DECODE(SUBSTR(PJTH.PJT_CODE,0, 2),'SI'
    		                       ,'상품(' || SUBSTR(SUBSTR(PJTH.PJT_CODE,0, 9),0, 5) ||')'
    		                       ,SUBSTR(PJTH.PJT_CODE,0, 9)
    		                )
    		        , SUBSTR(PJTH.PJT_CODE,0, 9)
    		   ) AS ASSETSEQ
    		   ,TXDT.SUP_AMT AS AMT
    		   ,(SELECT DECODE(TAX_DIV,'1',TXDT.VAT_AMT,0) 
                 FROM ICOYTRHD
                 WHERE HOUSE_CODE = TRDT.HOUSE_CODE
                   AND PAY_NO = TRDT.PAY_NO
                   AND ROWNUM = 1) AS VATAMT
			FROM ICOYTXHD TXHD, ICOYTRDT TRDT,  ICOYTXDT TXDT,
			     ICOYIVDT IVDT, ICOYIVHD IVHD , 
			     ICOYPODT PODT, ICOYPRDT PRDT ,
			     ICOYPRHD PRHD, ICOYPJTH PJTH ,
			     ICOMVNGL VNGL, ICOMMTGL MTGL 
			WHERE TXHD.HOUSE_CODE = TRDT.HOUSE_CODE
			  AND TXHD.TAX_NO = TRDT.TAX_NO
			  AND TRDT.TAX_NO = TXDT.TAX_NO
			  AND TRDT.TAX_SEQ = TXDT.TAX_SEQ
			  AND TRDT.HOUSE_CODE = IVDT.HOUSE_CODE
			  AND TRDT.INV_NO = IVDT.INV_NO
			  AND TRDT.INV_SEQ = IVDT.INV_SEQ     
			  AND IVDT.HOUSE_CODE = IVHD.HOUSE_CODE
			  AND IVDT.INV_NO = IVHD.INV_NO
			  AND IVDT.HOUSE_CODE  = PODT.HOUSE_CODE
			  AND IVDT.PO_NO = PODT.PO_NO
			  AND IVDT.PO_SEQ = PODT.PO_SEQ
			  AND PODT.HOUSE_CODE = PRDT.HOUSE_CODE
			  AND PODT.PR_NO = PRDT.PR_NO
			  AND PODT.PR_SEQ = PRDT.PR_SEQ
			  AND PRDT.HOUSE_CODE = PRHD.HOUSE_CODE
			  AND PRDT.PR_NO = PRHD.PR_NO
			  AND PRHD.HOUSE_CODE = PJTH.HOUSE_CODE
			  AND PRHD.WBS = PJTH.PJT_SEQ  
			  AND IVHD.HOUSE_CODE = VNGL.HOUSE_CODE (+)
			  AND IVHD.VENDOR_CODE = VNGL.VENDOR_CODE (+) 
			  AND PODT.HOUSE_CODE = MTGL.HOUSE_CODE
		      AND PODT.ITEM_NO = MTGL.ITEM_NO 
			  AND TXHD.HOUSE_CODE = '#house_code#'
			  AND TXHD.TAX_NO = '#tax_no#'
			ORDER BY TAX_NO, TAX_SEQ
	</method>
	
	<method name="et_setGroupApproval">
		UPDATE ICOYTXHD SET GROUP_TAX_NO = '#tax_no#'
		                   ,CHANGE_DATE = TO_CHAR(SYSDATE,'YYYYMMDD')
			               ,CHANGE_TIME = TO_CHAR(SYSDATE,'HH24MISS')
			               ,CHANGE_USER_ID = '#user_id#'
				WHERE HOUSE_CODE = '#house_code#'
				  AND TAX_NO IN (#tax_no_str#)
	</method>
	
	<method name="bl_getSignTaxList">
			SELECT
				    TXHD.TAX_NO,
				    WBSINF.WBS_NAME,
				    TRHD.VENDOR_CODE,
				    GETCOMPANYNAMELOC(TRHD.HOUSE_CODE,TRHD.VENDOR_CODE,'S') AS VENDOR_NAME,
				    TXHD.SUP_IRS_NO,
				    TRHD.TAX_DIV,                                                    
	                GETICOMCODE1(TRHD.HOUSE_CODE,'M400',TRHD.TAX_DIV) AS TAX_DIV_TXT, 
	                        			GETICOMCODE1(TXHD.HOUSE_CODE,'M010',(SELECT PAY_TERMS 
		                                                 FROM ICOYPOHD
		                                                 WHERE HOUSE_CODE = TRDT.HOUSE_CODE 
		                                                   AND PO_NO = TRDT.PO_NO
		                                                 ) 
		                         ) AS PAY_TERMS_DESC, 
				    TXHD.SUP_AMT,
				    TXHD.PAY_END_DATE,
				    SUM(TRDT.TAX_AMT) AS TAX_AMT,
				    TXHD.SUP_AMT + SUM(TRDT.TAX_AMT) AS TOT_AMT		    
				    
				FROM ICOYTRHD TRHD, ICOYTRDT TRDT, ICOYIVHD IVHD ,ICOYTXHD TXHD,
				       (SELECT DISTINCT PO.HOUSE_CODE,
			                  PO.PO_NO,
			                  PJTH.PJT_SEQ AS WBS,
			                  PJTH.PJT_CODE AS WBS_CODE, 
			                  PJTH.PJT_NAME AS WBS_NAME
			           FROM ICOYPODT PO, ICOYPRHD PR, ICOYPJTH PJTH
			           WHERE PO.HOUSE_CODE = PR.HOUSE_CODE
			             AND PO.PR_NO = PR.PR_NO 
			          	 AND PR.HOUSE_CODE = PJTH.HOUSE_CODE (+)
			          	 AND PR.WBS = PJTH.PJT_SEQ (+)  
			          ) WBSINF

				WHERE TRHD.HOUSE_CODE = TRDT.HOUSE_CODE
				  AND TRHD.PAY_NO = TRDT.PAY_NO
				  AND TRDT.HOUSE_CODE = IVHD.HOUSE_CODE
				  AND TRDT.INV_NO = IVHD.INV_NO
				  AND TRDT.HOUSE_CODE = TXHD.HOUSE_CODE
	     		  AND TRDT.TAX_NO = TXHD.TAX_NO
	     		  AND TRDT.HOUSE_CODE = WBSINF.HOUSE_CODE
	     		  AND TRDT.PO_NO = WBSINF.PO_NO
				  AND TRHD.HOUSE_CODE  = '#house_code#'
				  AND TXHD.GROUP_TAX_NO = '#group_tax_no#'
				  
		       GROUP BY TXHD.TAX_NO,  WBSINF.WBS_NAME, TRHD.HOUSE_CODE, TRHD.VENDOR_CODE, 
		                TXHD.SUP_IRS_NO, TRHD.TAX_DIV, TXHD.SUP_AMT, TXHD.HOUSE_CODE, 
		                TRDT.HOUSE_CODE, TRDT.PO_NO, TXHD.PAY_END_DATE
		                
		    ORDER BY TAX_NO            
		    		                
	</method>
	
	<method name="up_setApprovalHD">
		<![CDATA[
			UPDATE ICOYIVHD
			   SET JOB_STATUS 	= ${sign_status}
			      ,PAY_NO 		= ${pay_no}
			WHERE HOUSE_CODE 	= ${session.HOUSE_CODE}         
			  AND INV_NO		in ('#inv_no#')  
		]]>
	</method>	

	<method name="in_setApprovalHD_20160602bakup">
	<![CDATA[
		INSERT 
		  INTO ICOYTRHD 
		       ( 
		           HOUSE_CODE ,
		           PAY_NO ,
		           STATUS ,
		           ADD_DATE ,
		           ADD_TIME ,
		           ADD_USER_ID ,
		           CHANGE_DATE ,
		           CHANGE_TIME ,
		           CHANGE_USER_ID ,
		           COM_PERSON_FLAG ,
		           VENDOR_CODE ,
		           JOB_STATUS ,
		           TAX_TYPE ,
		           ISSUE_TYPE ,
		           ORIGIN_TYPE ,
		           REJECT_REASON ,
		           SERIAL_NO ,
		           PRICE_TOTAL ,
		           VAT_AMT ,
		           TAX_TOTAL ,
		           PAY_AMT ,
		           NEXT_PAY_AMT ,
		           NOTE ,
		           S_REG_NO ,
		           S_BIZ_ADDR ,
		           S_CEO_NAME ,
		           S_CO_NAME ,
		           S_BIZ_TYPE ,
		           S_BIZ_CATEGORY ,
		           S_USER_NAME ,
		           S_EMAIL ,
		           S_PHONE_NO ,
		           S_DEPT ,
		           B_REG_NO ,
		           B_BIZ_ADDR ,
		           B_CEO_NAME ,
		           B_CO_NAME ,
		           B_BIZ_TYPE ,
		           B_BIZ_CATEGORY ,
		           B_USER_NAME ,
		           B_EMAIL ,
		           B_PHONE_NO ,
		           B_DEPT ,
		           R_D_FLAG ,
		           CASH ,
		           PAYCHECK ,
		           DRAFT ,
		           CREDIT ,
		           CHIT_NO ,
		           PSTNG_DATE ,
		           SIGN_STATUS ,
		           SIGN_DATE ,
		           REMARKS ,
				   CTRL_CODE,
				   TAX_DIV
		       ) 
		SELECT HOUSE_CODE , 
		       PAY_NO , 
		       STATUS , 
		       ADD_DATE , 
		       ADD_TIME , 
		       ADD_USER_ID , 
		       CHANGE_DATE , 
		       CHANGE_TIME , 
		       CHANGE_USER_ID , 
		       COM_PERSON_FLAG , 
		       VENDOR_CODE , 
		       JOB_STATUS , 
		       TAX_TYPE , 
		       ISSUE_TYPE , 
		       ORIGIN_TYPE , 
		       REJECT_REASON , 
		       SERIAL_NO , 
		       NVL ( MAX (PRICE_TOTAL),0) AS PRICE_TOTAL , 
		       NVL (ROUND (MAX (VAT_AMT)),0) AS VAT_AMT , 
		       NVL (ROUND (MAX (TAX_TOTAL)),0) AS TAX_TOTAL , 
		       NVL ( MAX (PAY_AMT),0) AS PAY_AMT , 
		       NVL (ROUND (MAX (NEXT_PAY_AMT)),0) AS NEXT_PAY_AMT , 
		       NOTE , 
		       S_REG_NO , 
		       S_BIZ_ADDR , 
		       S_CEO_NAME , 
		       S_CO_NAME , 
		       S_BIZ_TYPE , 
		       S_BIZ_CATEGORY , 
		       S_USER_NAME , 
		       S_EMAIL , 
		       S_PHONE_NO , 
		       S_DEPT , 
		       B_REG_NO , 
		       B_BIZ_ADDR , 
		       B_CEO_NAME , 
		       B_CO_NAME , 
		       B_BIZ_TYPE , 
		       B_BIZ_CATEGORY , 
		       B_USER_NAME , 
		       B_EMAIL , 
		       B_PHONE_NO , 
		       B_DEPT , 
		       R_D_FLAG , 
		       NVL (ROUND (SUM (CASH)),0) AS CREDIT , 
		       NVL (ROUND (SUM (PAYCHECK)),0) AS CREDIT , 
		       NVL (ROUND (SUM (DRAFT)),0) AS CREDIT , 
		       NVL (ROUND (SUM (CREDIT)),0) AS CREDIT , 
		       CHIT_NO , 
		       PSTNG_DATE , 
		       SIGN_STATUS , 
		       SIGN_DATE , 
		       REMARKS ,
			   CTRL_CODE,
			   TAX_DIV
		  FROM 
		       (SELECT ${session.HOUSE_CODE} AS HOUSE_CODE , 
		              ${pay_no} AS PAY_NO , 
		              'C' AS STATUS , 
		              /*IVHD.CONFIRM_DATE1 AS ADD_DATE ,*/
		              TO_CHAR (SYSDATE,'YYYYMMDD') AS ADD_DATE ,
		              TO_CHAR (SYSDATE,'HH24MISS') AS ADD_TIME , 
		              ${session.ID} AS ADD_USER_ID , 
		              TO_CHAR (SYSDATE,'YYYYMMDD') AS CHANGE_DATE , 
		              TO_CHAR (SYSDATE,'HH24MISS') AS CHANGE_TIME , 
		              ${session.ID} AS CHANGE_USER_ID , 
		              'C' AS COM_PERSON_FLAG , 
		              IVHD.VENDOR_CODE , 
		              ${job_status} AS JOB_STATUS , 
		              '1' AS TAX_TYPE , 
		              'P' AS ISSUE_TYPE , 
		              'S' AS ORIGIN_TYPE , 
		              '' AS REJECT_REASON , 
		              '' AS SERIAL_NO , 
		              --(SELECT SUM (TRUNC (INV_AMT)) 
		              -- FROM ICOYIVDT DT 
		              -- WHERE DT.HOUSE_CODE = IVHD.HOUSE_CODE 
		              --       AND DT.INV_NO = IVHD.INV_NO 
		              --       AND DT.STATUS <> 'D' 
		              --) AS PRICE_TOTAL ,
	                  (SELECT 
	                	  CASE WHEN VNGL.TAX_DIV IS NULL OR VNGL.TAX_DIV <> '1'
	                	  THEN TRUNC(SUM (TRUNC (INV_AMT)))
	                	  ELSE TRUNC(SUM (TRUNC (INV_AMT)) / 1.1)
	                	  END 
	                      FROM ICOYIVDT DT 
	                   WHERE DT.HOUSE_CODE = IVHD.HOUSE_CODE 
	                     AND DT.INV_NO||DT.INV_SEQ in ('#inv_data#')
	                     AND DT.STATUS <> 'D' 
	                  )  AS PRICE_TOTAL , 		              
		              --'' AS VAT_AMT ,
	                  (SELECT 
	                	  CASE WHEN VNGL.TAX_DIV IS NULL OR VNGL.TAX_DIV <> '1'
	                	  THEN 0
	                	  ELSE TRUNC(SUM (TRUNC (INV_AMT))) - TRUNC(SUM (TRUNC (INV_AMT)) / 1.1)
	                	  END 
	                    FROM ICOYIVDT DT 
	                   WHERE DT.HOUSE_CODE = IVHD.HOUSE_CODE 
	                     AND DT.INV_NO||DT.INV_SEQ in ('#inv_data#')
	                     AND DT.STATUS <> 'D' 
	                  ) AS VAT_AMT ,		               
	                  (SELECT 
	                	  CASE WHEN VNGL.TAX_DIV IS NULL OR VNGL.TAX_DIV <> '1'
	                	  THEN TRUNC(SUM (TRUNC (INV_AMT)))
	                	  ELSE TRUNC(SUM (TRUNC (INV_AMT)) /1.1)
	                	  END 
	                      FROM ICOYIVDT DT 
	                   WHERE DT.HOUSE_CODE = IVHD.HOUSE_CODE 
	                     AND DT.INV_NO||DT.INV_SEQ in ('#inv_data#') 
	                     AND DT.STATUS <> 'D' 
	                  ) +
	                  (SELECT 
	                	  CASE WHEN VNGL.TAX_DIV IS NULL OR VNGL.TAX_DIV <> '1'
	                	  THEN 0
	                	  ELSE TRUNC(SUM (TRUNC (INV_AMT))) - TRUNC(SUM (TRUNC (INV_AMT)) / 1.1)
	                	  END 
	                    FROM ICOYIVDT DT 
	                   WHERE DT.HOUSE_CODE = IVHD.HOUSE_CODE 
	                     AND DT.INV_NO||DT.INV_SEQ in ('#inv_data#')
	                     AND DT.STATUS <> 'D' 
	                  ) AS TAX_TOTAL ,		               
		              --'' AS TAX_TOTAL , 
		              (SELECT SUM (TRUNC (INV_AMT)) 
		                FROM ICOYIVDT DT 
		               WHERE DT.HOUSE_CODE = IVHD.HOUSE_CODE 
		                     AND DT.INV_NO||DT.INV_SEQ in ('#inv_data#')
		                     AND DT.STATUS <> 'D' 
		              ) AS PAY_AMT , 
		              '' AS NEXT_PAY_AMT , 
		              '' AS NOTE , 
		              VNGL.IRS_NO AS S_REG_NO , 
		              ADDR.ZIP_CODE||' '||ADDR.ADDRESS_LOC AS S_BIZ_ADDR , 
		              ADDR.CEO_NAME_LOC AS S_CEO_NAME , 
		              VNGL.VENDOR_NAME_LOC AS S_CO_NAME , 
		              VNGL.INDUSTRY_TYPE AS S_BIZ_TYPE , 
		              VNGL.BUSINESS_TYPE AS S_BIZ_CATEGORY , 
		              VNCP.USER_NAME AS S_USER_NAME , 
		              VNCP.EMAIL AS S_EMAIL , 
		              VNCP.PHONE_NO AS S_PHONE_NO , 
		              VNCP.DIVISION AS S_DEPT , 
		              CMGL.IRS_NO AS B_REG_NO , 
		              ADDR1.ZIP_CODE||' '||ADDR1.ADDRESS_LOC AS B_BIZ_ADDR , 
		              ADDR1.CEO_NAME_LOC AS B_CEO_NAME , 
		              CMGL.COMPANY_NAME_LOC AS B_CO_NAME , 
		              CMGL.INDUSTRY_TYPE AS B_BIZ_TYPE , 
		              CMGL.BUSINESS_TYPE AS B_BIZ_CATEGORY , 
		              '' AS B_USER_NAME , 
		              ADDR1.EMAIL AS B_EMAIL , 
		              ADDR1.PHONE_NO1 AS B_PHONE_NO , 
		              '' AS B_DEPT , 
		              'D' AS R_D_FLAG , 
		              '' AS CASH , 
		              '' AS PAYCHECK , 
		              '' AS DRAFT , 
		              '' AS CREDIT , 
		              '' AS CHIT_NO , 
		              '' AS PSTNG_DATE , 
		              ${sign_status} AS SIGN_STATUS , 
		              to_char(sysdate,'YYYYMMDD') AS SIGN_DATE , 
		              '' AS REMARKS ,
					  ${ctrl_code} AS CTRL_CODE,
					  VNGL.tax_div AS TAX_DIV 
		         FROM ICOYIVHD IVHD, 
		              ICOMVNGL VNGL, 
		              ICOMVNCP VNCP, 
		              ICOMLUSR LUSR, 
		              ICOMADDR ADDR, 
		              ICOMCMGL CMGL, 
		              ICOMADDR ADDR1 
		        WHERE IVHD.HOUSE_CODE = ${session.HOUSE_CODE}
		              AND IVHD.INV_NO in ('#inv_no#') 
		              AND IVHD.STATUS <> 'D' 
		              AND IVHD.HOUSE_CODE = VNGL.HOUSE_CODE 
		              AND IVHD.VENDOR_CODE = VNGL.VENDOR_CODE 
		              AND VNGL.STATUS <> 'D' 
		              AND VNGL.HOUSE_CODE = VNCP.HOUSE_CODE 
		              AND VNGL.VENDOR_CODE = VNCP.VENDOR_CODE 
		              AND VNGL.HOUSE_CODE = LUSR.HOUSE_CODE 
		              AND VNGL.VENDOR_CODE = LUSR.COMPANY_CODE 
		              AND LUSR.USER_TYPE = 'S' 
		              AND LUSR.STATUS <> 'D' 
		              AND LUSR.HOUSE_CODE = ADDR.HOUSE_CODE 
		              AND LUSR.COMPANY_CODE = ADDR.CODE_NO 
		              AND ADDR.CODE_TYPE = '2' 
		              AND IVHD.HOUSE_CODE = CMGL.HOUSE_CODE 
		              AND IVHD.COMPANY_CODE = CMGL.COMPANY_CODE 
		              AND CMGL.STATUS <> 'D' 
		              AND CMGL.HOUSE_CODE = ADDR1.HOUSE_CODE 
		              AND CMGL.COMPANY_CODE = ADDR1.CODE_NO 
		              AND ADDR1.CODE_TYPE = '1'
		              AND VNCP.SEQ = '1'
		       ) 
		 GROUP BY HOUSE_CODE , 
		       PAY_NO , 
		       STATUS , 
		       ADD_DATE , 
		       ADD_TIME , 
		       ADD_USER_ID , 
		       CHANGE_DATE , 
		       CHANGE_TIME , 
		       CHANGE_USER_ID , 
		       COM_PERSON_FLAG , 
		       VENDOR_CODE , 
		       JOB_STATUS , 
		       TAX_TYPE , 
		       ISSUE_TYPE , 
		       ORIGIN_TYPE , 
		       REJECT_REASON , 
		       SERIAL_NO , 
		       NOTE , 
		       S_REG_NO , 
		       S_BIZ_ADDR , 
		       S_CEO_NAME , 
		       S_CO_NAME , 
		       S_BIZ_TYPE , 
		       S_BIZ_CATEGORY , 
		       S_USER_NAME , 
		       S_EMAIL , 
		       S_PHONE_NO , 
		       S_DEPT , 
		       B_REG_NO , 
		       B_BIZ_ADDR , 
		       B_CEO_NAME , 
		       B_CO_NAME , 
		       B_BIZ_TYPE , 
		       B_BIZ_CATEGORY , 
		       B_USER_NAME , 
		       B_EMAIL , 
		       B_PHONE_NO , 
		       B_DEPT , 
		       R_D_FLAG , 
		       CHIT_NO , 
		       PSTNG_DATE , 
		       SIGN_STATUS , 
		       SIGN_DATE , 
		       REMARKS ,
			   CTRL_CODE,
			   TAX_DIV
	]]>
	</method>

	<method name="in_setApprovalHD">
	<![CDATA[
		INSERT 
		  INTO ICOYTRHD 
		       ( 
		           HOUSE_CODE ,
		           PAY_NO ,
		           STATUS ,
		           ADD_DATE ,
		           ADD_TIME ,
		           ADD_USER_ID ,
		           CHANGE_DATE ,
		           CHANGE_TIME ,
		           CHANGE_USER_ID ,
		           COM_PERSON_FLAG ,
		           VENDOR_CODE ,
		           JOB_STATUS ,
		           TAX_TYPE ,
		           ISSUE_TYPE ,
		           ORIGIN_TYPE ,
		           REJECT_REASON ,
		           SERIAL_NO ,
		           PRICE_TOTAL ,
		           VAT_AMT ,
		           TAX_TOTAL ,
		           PAY_AMT ,
		           NEXT_PAY_AMT ,
		           NOTE ,
		           S_REG_NO ,
		           S_BIZ_ADDR ,
		           S_CEO_NAME ,
		           S_CO_NAME ,
		           S_BIZ_TYPE ,
		           S_BIZ_CATEGORY ,
		           S_USER_NAME ,
		           S_EMAIL ,
		           S_PHONE_NO ,
		           S_DEPT ,
		           B_REG_NO ,
		           B_BIZ_ADDR ,
		           B_CEO_NAME ,
		           B_CO_NAME ,
		           B_BIZ_TYPE ,
		           B_BIZ_CATEGORY ,
		           B_USER_NAME ,
		           B_EMAIL ,
		           B_PHONE_NO ,
		           B_DEPT ,
		           R_D_FLAG ,
		           CASH ,
		           PAYCHECK ,
		           DRAFT ,
		           CREDIT ,
		           CHIT_NO ,
		           PSTNG_DATE ,
		           SIGN_STATUS ,
		           SIGN_DATE ,
		           REMARKS ,
				   CTRL_CODE,
				   TAX_DIV
		       ) 
		SELECT HOUSE_CODE , 
		       PAY_NO , 
		       STATUS , 
		       ADD_DATE , 
		       ADD_TIME , 
		       ADD_USER_ID , 
		       CHANGE_DATE , 
		       CHANGE_TIME , 
		       CHANGE_USER_ID , 
		       COM_PERSON_FLAG , 
		       VENDOR_CODE , 
		       JOB_STATUS , 
		       TAX_TYPE , 
		       ISSUE_TYPE , 
		       ORIGIN_TYPE , 
		       REJECT_REASON , 
		       SERIAL_NO , 
		       NVL ( MAX (PRICE_TOTAL),0) AS PRICE_TOTAL , 
		       NVL (ROUND (MAX (VAT_AMT)),0) AS VAT_AMT , 
		       NVL (ROUND (MAX (TAX_TOTAL)),0) AS TAX_TOTAL , 
		       NVL ( MAX (PAY_AMT),0) AS PAY_AMT , 
		       NVL (ROUND (MAX (NEXT_PAY_AMT)),0) AS NEXT_PAY_AMT , 
		       NOTE , 
		       S_REG_NO , 
		       S_BIZ_ADDR , 
		       S_CEO_NAME , 
		       S_CO_NAME , 
		       S_BIZ_TYPE , 
		       S_BIZ_CATEGORY , 
		       S_USER_NAME , 
		       S_EMAIL , 
		       S_PHONE_NO , 
		       S_DEPT , 
		       B_REG_NO , 
		       B_BIZ_ADDR , 
		       B_CEO_NAME , 
		       B_CO_NAME , 
		       B_BIZ_TYPE , 
		       B_BIZ_CATEGORY , 
		       B_USER_NAME , 
		       B_EMAIL , 
		       B_PHONE_NO , 
		       B_DEPT , 
		       R_D_FLAG , 
		       NVL (ROUND (SUM (CASH)),0) AS CREDIT , 
		       NVL (ROUND (SUM (PAYCHECK)),0) AS CREDIT , 
		       NVL (ROUND (SUM (DRAFT)),0) AS CREDIT , 
		       NVL (ROUND (SUM (CREDIT)),0) AS CREDIT , 
		       CHIT_NO , 
		       PSTNG_DATE , 
		       SIGN_STATUS , 
		       SIGN_DATE , 
		       REMARKS ,
			   CTRL_CODE,
			   TAX_DIV
		  FROM 
		       (SELECT ${session.HOUSE_CODE} AS HOUSE_CODE , 
		              ${pay_no} AS PAY_NO , 
		              'C' AS STATUS , 
		              /*IVHD.CONFIRM_DATE1 AS ADD_DATE ,*/
		              TO_CHAR (SYSDATE,'YYYYMMDD') AS ADD_DATE ,
		              TO_CHAR (SYSDATE,'HH24MISS') AS ADD_TIME , 
		              ${session.ID} AS ADD_USER_ID , 
		              TO_CHAR (SYSDATE,'YYYYMMDD') AS CHANGE_DATE , 
		              TO_CHAR (SYSDATE,'HH24MISS') AS CHANGE_TIME , 
		              ${session.ID} AS CHANGE_USER_ID , 
		              'C' AS COM_PERSON_FLAG , 
		              IVHD.VENDOR_CODE , 
		              ${job_status} AS JOB_STATUS , 
		              '1' AS TAX_TYPE , 
		              'P' AS ISSUE_TYPE , 
		              'S' AS ORIGIN_TYPE , 
		              '' AS REJECT_REASON , 
		              '' AS SERIAL_NO , 
		              --(SELECT SUM (TRUNC (INV_AMT)) 
		              -- FROM ICOYIVDT DT 
		              -- WHERE DT.HOUSE_CODE = IVHD.HOUSE_CODE 
		              --       AND DT.INV_NO = IVHD.INV_NO 
		              --       AND DT.STATUS <> 'D' 
		              --) AS PRICE_TOTAL ,
	                  (SELECT 
	                	  CASE WHEN VNGL.TAX_DIV IS NULL OR VNGL.TAX_DIV <> '1'
	                	  THEN TRUNC(SUM (TRUNC (INV_AMT)))
	                	  ELSE TRUNC(SUM (TRUNC (INV_AMT)) / 1.1)
	                	  END 
	                      FROM ICOYIVDT DT 
	                   WHERE DT.HOUSE_CODE = IVHD.HOUSE_CODE 
	                     AND DT.INV_NO||DT.INV_SEQ in ('#inv_data#')
	                     AND DT.STATUS <> 'D' 
	                  )  AS PRICE_TOTAL , 		              
		              --'' AS VAT_AMT ,
	                  (SELECT 
	                	  CASE WHEN VNGL.TAX_DIV IS NULL OR VNGL.TAX_DIV <> '1'
	                	  THEN 0
	                	  ELSE TRUNC(SUM (TRUNC (INV_AMT))) - TRUNC(SUM (TRUNC (INV_AMT)) / 1.1)
	                	  END 
	                    FROM ICOYIVDT DT 
	                   WHERE DT.HOUSE_CODE = IVHD.HOUSE_CODE 
	                     AND DT.INV_NO||DT.INV_SEQ in ('#inv_data#')
	                     AND DT.STATUS <> 'D' 
	                  ) AS VAT_AMT ,		               
	                  (SELECT 
	                	  CASE WHEN VNGL.TAX_DIV IS NULL OR VNGL.TAX_DIV <> '1'
	                	  THEN TRUNC(SUM (TRUNC (INV_AMT)))
	                	  ELSE TRUNC(SUM (TRUNC (INV_AMT)) /1.1)
	                	  END 
	                      FROM ICOYIVDT DT 
	                   WHERE DT.HOUSE_CODE = IVHD.HOUSE_CODE 
	                     AND DT.INV_NO||DT.INV_SEQ in ('#inv_data#') 
	                     AND DT.STATUS <> 'D' 
	                  ) +
	                  (SELECT 
	                	  CASE WHEN VNGL.TAX_DIV IS NULL OR VNGL.TAX_DIV <> '1'
	                	  THEN 0
	                	  ELSE TRUNC(SUM (TRUNC (INV_AMT))) - TRUNC(SUM (TRUNC (INV_AMT)) / 1.1)
	                	  END 
	                    FROM ICOYIVDT DT 
	                   WHERE DT.HOUSE_CODE = IVHD.HOUSE_CODE 
	                     AND DT.INV_NO||DT.INV_SEQ in ('#inv_data#')
	                     AND DT.STATUS <> 'D' 
	                  ) AS TAX_TOTAL ,		               
		              --'' AS TAX_TOTAL , 
		              (SELECT SUM (TRUNC (INV_AMT)) 
		                FROM ICOYIVDT DT 
		               WHERE DT.HOUSE_CODE = IVHD.HOUSE_CODE 
		                     AND DT.INV_NO||DT.INV_SEQ in ('#inv_data#')
		                     AND DT.STATUS <> 'D' 
		              ) AS PAY_AMT , 
		              '' AS NEXT_PAY_AMT , 
		              '' AS NOTE , 
		              VNGL.IRS_NO AS S_REG_NO , 
		              ADDR.ZIP_CODE||' '||ADDR.ADDRESS_LOC AS S_BIZ_ADDR , 
		              ADDR.CEO_NAME_LOC AS S_CEO_NAME , 
		              VNGL.VENDOR_NAME_LOC AS S_CO_NAME , 
		              VNGL.INDUSTRY_TYPE AS S_BIZ_TYPE , 
		              VNGL.BUSINESS_TYPE AS S_BIZ_CATEGORY , 
		              (SELECT USER_NAME FROM ICOMVNCP    
		               WHERE HOUSE_CODE = VNGL.HOUSE_CODE 
		               AND VENDOR_CODE = VNGL.VENDOR_CODE 
		               AND ROWNUM = 1) AS S_USER_NAME , 
		              (SELECT EMAIL FROM ICOMVNCP    
		               WHERE HOUSE_CODE = VNGL.HOUSE_CODE 
		               AND VENDOR_CODE = VNGL.VENDOR_CODE 
		               AND ROWNUM = 1) AS S_EMAIL , 
		              (SELECT PHONE_NO FROM ICOMVNCP    
		               WHERE HOUSE_CODE = VNGL.HOUSE_CODE 
		               AND VENDOR_CODE = VNGL.VENDOR_CODE 
		               AND ROWNUM = 1) AS S_PHONE_NO , 
		              (SELECT DIVISION FROM ICOMVNCP    
		               WHERE HOUSE_CODE = VNGL.HOUSE_CODE 
		               AND VENDOR_CODE = VNGL.VENDOR_CODE 
		               AND ROWNUM = 1) AS S_DEPT , 		        
		              CMGL.IRS_NO AS B_REG_NO , 
		              ADDR1.ZIP_CODE||' '||ADDR1.ADDRESS_LOC AS B_BIZ_ADDR , 
		              ADDR1.CEO_NAME_LOC AS B_CEO_NAME , 
		              CMGL.COMPANY_NAME_LOC AS B_CO_NAME , 
		              CMGL.INDUSTRY_TYPE AS B_BIZ_TYPE , 
		              CMGL.BUSINESS_TYPE AS B_BIZ_CATEGORY , 
		              '' AS B_USER_NAME , 
		              ADDR1.EMAIL AS B_EMAIL , 
		              ADDR1.PHONE_NO1 AS B_PHONE_NO , 
		              '' AS B_DEPT , 
		              'D' AS R_D_FLAG , 
		              '' AS CASH , 
		              '' AS PAYCHECK , 
		              '' AS DRAFT , 
		              '' AS CREDIT , 
		              '' AS CHIT_NO , 
		              '' AS PSTNG_DATE , 
		              ${sign_status} AS SIGN_STATUS , 
		              to_char(sysdate,'YYYYMMDD') AS SIGN_DATE , 
		              '' AS REMARKS ,
					  ${ctrl_code} AS CTRL_CODE,
					  VNGL.tax_div AS TAX_DIV 
		         FROM ICOYIVHD IVHD, 
		              ICOMVNGL VNGL, 
		              ICOMLUSR LUSR, 
		              ICOMADDR ADDR, 
		              ICOMCMGL CMGL, 
		              ICOMADDR ADDR1 
		        WHERE IVHD.HOUSE_CODE = ${session.HOUSE_CODE}
		              AND IVHD.INV_NO in ('#inv_no#') 
		              AND IVHD.STATUS <> 'D' 
		              AND IVHD.HOUSE_CODE = VNGL.HOUSE_CODE 
		              AND IVHD.VENDOR_CODE = VNGL.VENDOR_CODE 
		              AND VNGL.STATUS <> 'D' 
		              AND VNGL.HOUSE_CODE = LUSR.HOUSE_CODE 
		              AND VNGL.VENDOR_CODE = LUSR.COMPANY_CODE 
		              AND LUSR.USER_TYPE = 'S' 
		              AND LUSR.STATUS <> 'D' 
		              AND LUSR.HOUSE_CODE = ADDR.HOUSE_CODE 
		              AND LUSR.COMPANY_CODE = ADDR.CODE_NO 
		              AND ADDR.CODE_TYPE = '2' 
		              AND IVHD.HOUSE_CODE = CMGL.HOUSE_CODE 
		              AND IVHD.COMPANY_CODE = CMGL.COMPANY_CODE 
		              AND CMGL.STATUS <> 'D' 
		              AND CMGL.HOUSE_CODE = ADDR1.HOUSE_CODE 
		              AND CMGL.COMPANY_CODE = ADDR1.CODE_NO 
		              AND ADDR1.CODE_TYPE = '1'		              
		       ) 
		 GROUP BY HOUSE_CODE , 
		       PAY_NO , 
		       STATUS , 
		       ADD_DATE , 
		       ADD_TIME , 
		       ADD_USER_ID , 
		       CHANGE_DATE , 
		       CHANGE_TIME , 
		       CHANGE_USER_ID , 
		       COM_PERSON_FLAG , 
		       VENDOR_CODE , 
		       JOB_STATUS , 
		       TAX_TYPE , 
		       ISSUE_TYPE , 
		       ORIGIN_TYPE , 
		       REJECT_REASON , 
		       SERIAL_NO , 
		       NOTE , 
		       S_REG_NO , 
		       S_BIZ_ADDR , 
		       S_CEO_NAME , 
		       S_CO_NAME , 
		       S_BIZ_TYPE , 
		       S_BIZ_CATEGORY , 
		       S_USER_NAME , 
		       S_EMAIL , 
		       S_PHONE_NO , 
		       S_DEPT , 
		       B_REG_NO , 
		       B_BIZ_ADDR , 
		       B_CEO_NAME , 
		       B_CO_NAME , 
		       B_BIZ_TYPE , 
		       B_BIZ_CATEGORY , 
		       B_USER_NAME , 
		       B_EMAIL , 
		       B_PHONE_NO , 
		       B_DEPT , 
		       R_D_FLAG , 
		       CHIT_NO , 
		       PSTNG_DATE , 
		       SIGN_STATUS , 
		       SIGN_DATE , 
		       REMARKS ,
			   CTRL_CODE,
			   TAX_DIV
	]]>
	</method>

	<method name="in_setApprovalDT">
	<![CDATA[
		INSERT 
		  INTO ICOYTRDT 
		       ( 
		           HOUSE_CODE ,
		           PAY_NO ,
		           PAY_SEQ ,
		           STATUS ,
		           ADD_DATE ,
		           ADD_TIME ,
		           ADD_USER_ID ,
		           CHANGE_DATE ,
		           CHANGE_TIME ,
		           CHANGE_USER_ID ,
		           SPLY_DATE ,
		           ITEM_NO ,
		           DESCRIPTION_LOC ,
		           DESCRIPTION_ENG ,
		           SPECIFICATION ,
		           UNIT_MEASURE ,
		           ITEM_QTY ,
		           CUR ,
		           UNIT_PRICE ,
		           ITEM_AMT ,
		           DELY_UNIT_PRICE ,
		           DELY_AMT ,
		           APP_TYPE ,
		           TAX_AMT ,
		           PAY_AMT ,
		           PRE_PAY_AMT ,
		           NEXT_PAY_AMT ,
		           ACCOUNT_CODE ,
		           INVEST_NO ,
		           Z_CODE3 ,
		           PO_NO ,
		           PO_SEQ ,
		           INV_NO ,
		           INV_SEQ ,
		           TAX_NO ,
		           TAX_SEQ ,
		           REMARKS 
		       ) 
		SELECT ${session.HOUSE_CODE} AS HOUSE_CODE , 
		       ${pay_no} AS PAY_NO , 
		       TRIM (TO_CHAR (ROWNUM, '000000')) AS PAY_SEQ , 
		       'C' AS STATUS , 
		       TO_CHAR (SYSDATE,'YYYYMMDD') AS ADD_DATE , 
		       TO_CHAR (SYSDATE,'HH24MISS') AS ADD_TIME , 
		       ${session.ID} AS ADD_USER_ID , 
		       TO_CHAR (SYSDATE,'YYYYMMDD') AS CHANGE_DATE , 
		       TO_CHAR (SYSDATE,'HH24MISS') AS CHANGE_TIME , 
		       ${session.ID} AS CHANGE_USER_ID , 
		       IVHD.PO_CREATE_DATE AS SPLY_DATE , 
		       IVDT.ITEM_NO AS ITEM_NO , 
		       IVDT.DESCRIPTION_LOC AS DESCRIPTION_LOC , 
		       '' AS DESCRIPTION_ENG , 
		       DECODE (IVDT.SPECIFICATION,NULL,(
			       	SELECT PRDT.SPECIFICATION 
	                  FROM ICOYPODT PODT, ICOYPRDT PRDT 
	                WHERE PODT.HOUSE_CODE = PRDT.HOUSE_CODE 
	                   AND PODT.PR_NO  = PRDT.PR_NO 
	                   AND PODT.PR_SEQ = PRDT.PR_SEQ 
	                   AND PODT.HOUSE_CODE = IVDT.HOUSE_CODE 
	                   AND PODT.PO_NO = IVDT.PO_NO
	                   AND PODT.PO_SEQ = IVDT.PO_SEQ),
		       		IVDT.SPECIFICATION
		       ) AS SPECIFICATION , 
		       IVDT.UNIT_MEASURE AS UNIT_MEASURE , 
		       IVDT.GR_QTY AS ITEM_QTY , 
		       (SELECT CUR FROM ICOYPRDT 
          		WHERE HOUSE_CODE = IVDT.HOUSE_CODE
           		  AND PR_NO IN (SELECT PR_NO FROM ICOYPODT 
                         		WHERE HOUSE_CODE = IVDT.HOUSE_CODE 
                          		  AND PO_NO = IVDT.PO_NO 
                           		  AND ITEM_NO = IVDT.ITEM_NO)
            	  AND ITEM_NO = IVDT.ITEM_NO 
            	  AND ROWNUM = 1 ) AS CUR , 
		       IVDT.UNIT_PRICE AS UNIT_PRICE , 
	           CASE WHEN (SELECT TAX_DIV FROM ICOMVNGL WHERE VENDOR_CODE = IVHD.VENDOR_CODE) IS NULL 
	           OR (SELECT TAX_DIV FROM ICOMVNGL WHERE VENDOR_CODE = IVHD.VENDOR_CODE) <> '1'
	           THEN TRUNC ((IVDT.UNIT_PRICE * IVDT.GR_QTY)) 
	           ELSE TRUNC ((IVDT.UNIT_PRICE * IVDT.GR_QTY)/1.1) 
	           END AS ITEM_AMT , 		       
		       IVDT.UNIT_PRICE AS DELY_UNIT_PRICE , 
		       TRUNC (IVDT.INV_AMT) AS DELY_AMT , 
		       '1' AS APP_TYPE , 
		       CASE WHEN (SELECT TAX_DIV FROM ICOMVNGL WHERE VENDOR_CODE = IVHD.VENDOR_CODE) IS NULL 
		       OR (SELECT TAX_DIV FROM ICOMVNGL WHERE VENDOR_CODE = IVHD.VENDOR_CODE) <> '1'
         	   THEN 0
         	   ELSE TRUNC(IVDT.UNIT_PRICE * IVDT.GR_QTY) - TRUNC ((IVDT.UNIT_PRICE * IVDT.GR_QTY) /1.1) 
         	   END AS TAX_AMT ,
		       TRUNC (IVDT.INV_AMT) AS PAY_AMT ,  
		       '' AS PRE_PAY_AMT , 
		       '' AS NEXT_PAY_AMT , 
		       '' AS ACCOUNT_CODE , 
		       '' AS INVEST_NO , 
		       '' AS Z_CODE3 , 
		       IVDT.PO_NO AS PO_NO , 
		       IVDT.PO_SEQ AS PO_SEQ , 
		       IVDT.INV_NO AS INV_NO , 
		       IVDT.INV_SEQ AS INV_SEQ , 
		       '' AS TAX_NO , 
		       '' AS TAX_SEQ , 
		       '' AS REMARKS 
		  FROM ICOYIVDT IVDT, ICOYIVHD IVHD 
		 WHERE IVDT.HOUSE_CODE = ${session.HOUSE_CODE} 
		       AND IVDT.HOUSE_CODE = IVHD.HOUSE_CODE
		       AND IVDT.INV_NO = IVHD.INV_NO
		       AND IVDT.INV_NO||IVDT.INV_SEQ IN ('#inv_no#')
		       AND IVDT.STATUS <> 'D'  
	]]>
	</method>
	
	<method name="setSaleEbill">
	<![CDATA[
		INSERT INTO SALEEBILL(
			RESSEQ,				
			DOCCODE,			
			EBILLKIND,			
			CUSTOMS,           
			DOCATTR,			
			PUBDATE,			
			SYSTEMCODE,			
			PUBTYPE,           
			PUBFORM,    		
			MEMID,				
			MEMDEPTNAME,		
			MEMNAME,			
			EMAIL,				
			TEL,				
			COREGNO,			
			COTAXREGNO, 		
			CONAME,				
			COCEO,				
			COADDR,				
			COBIZTYPE,			
			COBIZSUB,			
			RECMEMID,			
			RECMEMDEPTNAME,		
			RECMEMNAME,			
			RECEMAIL,			
			RECTEL,				
			RECCOREGNOTYPE,		
			RECCOREGNO,			
			RECCOTAXREGNO,		
			RECCONAME,      	
			RECCOCEO,   		
			RECCOADDR,			
			RECCOBIZTYPE,		
			RECCOBIZSUB,		
			SUPPRICE,          	
			TAX,				
			PUBKIND,			
			LOADSTATUS,			
			PUBSTATUS,			
			SMS,
			REMARKS
		)VALUES(
			${RESSEQ},			
			'02',				
			'1',				
			'T',           
			'N',				
			${PUBDATE},			
			'KF',				
			'S',           
			'D',	    		
			${MEMID},			
			${MEMDEPTNAME},		
			${MEMNAME},			
			${EMAIL},			
			${TEL},				
			${COREGNO},			
			${COTAXREGNO}, 		
			${CONAME},			
			${COCEO},			
			${COADDR},			
			SUBSTRB(${COBIZTYPE},1,40),
			${COBIZSUB},		
			${RECMEMID},		
			${RECMEMDEPTNAME},	
			${RECMEMNAME},		
			${RECEMAIL},		
			${RECTEL},			
			'01',				
			${RECCOREGNO},		
			${RECCOTAXREGNO},	
			${RECCONAME}, 	 	
			${RECCOCEO},   		
			${RECCOADDR},		
			${RECCOBIZTYPE},	
			${RECCOBIZSUB},		
			${SUPPRICE},		
			${TAX},				
			'R',				
			'0',				
			${PUBSTATUS},		
			${SMS},
			${REMARKS}
		)		
	]]>
	</method>
	
	<method name="setItemList_bak_20180822">
	<![CDATA[
		INSERT INTO ITEMLIST (
			SEQID,			
			DETAILSEQID,		
			ITEMDATE,
			ITEMNAME,		
			ITEMTYPE,			
			ITEMQTY,
			ITEMPRICE,		
			ITEMSUPPRICE,		
			ITEMTAX,
			ITEMREMARKS
		) VALUES (
			$S{SEQID},		
			$S{DETAILSEQID},	
			$S{ITEMDATE},
			$S{ITEMNAME},	
			$S{ITEMTYPE},		
			$S{ITEMQTY},
			$S{ITEMPRICE},	
			$S{ITEMSUPPRICE},	
			$S{ITEMTAX},
			$S{ITEMREMARKS}
		)		
	]]>
	</method>
	
	<method name="setItemList">
	<![CDATA[
		INSERT INTO ITEMLIST (
			SEQID,			
			DETAILSEQID,		
			ITEMDATE,
			ITEMNAME,		
			ITEMTYPE,			
			ITEMQTY,
			ITEMPRICE,		
			ITEMSUPPRICE,		
			ITEMTAX,
			ITEMREMARKS
		) VALUES (
			$S{SEQID},		
			$S{DETAILSEQID},	
			$S{ITEMDATE},
			SUBSTRB($S{ITEMNAME},1,33),	
			SUBSTRB($S{ITEMTYPE},1,20),
			$S{ITEMQTY},
			$S{ITEMPRICE},	
			$S{ITEMSUPPRICE},	
			$S{ITEMTAX},
			$S{ITEMREMARKS}
		)		
	]]>
	</method>
	

	<method name="et_delTxData_1">
		DELETE FROM ICOYTXHD WHERE TAX_NO IN (SELECT TAX_NO FROM ICOYTRDT 
		WHERE INV_NO||INV_SEQ IN ('#inv_no#'))
	</method>
	
	<method name="et_delTxData_2">
		DELETE FROM ICOYTXDT WHERE TAX_NO IN (SELECT TAX_NO FROM ICOYTRDT 
		WHERE INV_NO||INV_SEQ IN ('#inv_no#'))
	</method>
	
	<method name="et_delTxData_3">
		DELETE FROM ICOYTRHD WHERE PAY_NO IN (SELECT PAY_NO FROM ICOYTRDT 
		WHERE INV_NO||INV_SEQ IN ('#inv_no#'))
	</method>
	
	<method name="et_delTxData_4">
		DELETE FROM ICOYTRDT 
		WHERE INV_NO||INV_SEQ IN ('#inv_no#')
	</method>
	
	<method name="et_delTxData_5">
		UPDATE SALEEBILL SET DOCATTR = 'D' WHERE RESSEQ = '#tax_no#'
	</method>	
	
	<method name="getPiInfo">
		SELECT 	SEQ
		,		CASE
					WHEN PHONE_NO IS NULL THEN ' '
					ELSE PHONE_NO
				END AS PHONE_NO	
		,		CASE
					WHEN EMAIL IS NULL THEN ' '
					ELSE EMAIL
				END AS EMAIL	
		,		EMAIL
		,		USER_NAME
	    ,       MOBILE_NO 
		FROM 	ICOMVNCP 
		WHERE 	VENDOR_CODE = '#vendor_code#'
	</method>
	
	<method name="setInvTaxYn">
		UPDATE ICOYIVDT SET TAX_YN = 'Y' WHERE INV_NO||INV_SEQ IN ('#inv_no#')
	</method>
	
	<method name="delInvTaxYn">
		UPDATE ICOYIVDT SET TAX_YN = 'N' WHERE INV_NO||INV_SEQ IN ('#inv_no#')
	</method>
	
	<method name="et_getSpy2glSpy1ln_20201119bak">
		SELECT	 TAX_NO      AS TAX_NO
        ,PAY_ACT_NO  AS PAY_ACT_NO
		FROM 	SPY2GL
		WHERE 	1 = 1
		AND TAX_NO IN ('#tax_no1#')
		UNION ALL		
		SELECT   TAX_NO      AS TAX_NO
		        ,PAY_SEND_NO AS PAY_ACT_NO
		FROM    SPY1LN
		WHERE 	1 = 1
		AND TAX_NO IN ('#tax_no2#')		
	</method>
	
	<method name="et_getSpy2glSpy1ln">
		SELECT	 TAX_NO      AS TAX_NO
        ,PAY_ACT_NO  AS PAY_ACT_NO
		FROM 	SPY2GL
		WHERE 	1 = 1
		AND TAX_NO IN ('#tax_no1#')
		UNION ALL		
		SELECT   B.TAX_NO      AS TAX_NO
		        ,B.PAY_SEND_NO AS PAY_ACT_NO
		FROM    SPY1GL A ,SPY1LN B
		WHERE 	A.PAY_SEND_NO = B.PAY_SEND_NO
		<![CDATA[
		AND A.DEL_YN <> 'Y' 
		]]> 
		AND B.TAX_NO IN ('#tax_no2#')		
	</method>
	
	<method name="et_getSpy2glSpy1ln_2">	
		SELECT	 TAX_NO      AS TAX_NO
                ,PAY_ACT_NO  AS PAY_ACT_NO
        FROM 	SPY2GL
        WHERE 	1 = 1
        AND TAX_NO IN (SELECT DISTINCT TAX_NO FROM ICOYTRDT
                        WHERE INV_NO||INV_SEQ IN ('#inv_data1#'))    
        UNION ALL		
        SELECT   B.TAX_NO      AS TAX_NO
                ,B.PAY_SEND_NO AS PAY_ACT_NO
        FROM    SPY1GL A ,SPY1LN B  
        WHERE 	A.PAY_SEND_NO = B.PAY_SEND_NO
         <![CDATA[
         AND A.DEL_YN <> 'Y'
         ]]> 
         AND B.TAX_NO IN (SELECT DISTINCT TAX_NO FROM ICOYTRDT
                          WHERE INV_NO||INV_SEQ IN ('#inv_data2#'))    
	</method>
	
	<method name="et_getTaxProgressCode">
		SELECT
		        CASE
            		WHEN TRHD.REF_PAY_NO IS NULL
            		THEN 
	            	(
			            CASE 
		             		WHEN TXHD.TAX_APP_NO IS NOT NULL THEN '-1'
		             		WHEN 
		             			(	SELECT	COUNT(1) 
									FROM	ICOYTRHD
									WHERE 	PAY_NO IN 
									(
										SELECT 	REF_PAY_NO
										FROM	ICOYTRHD
										WHERE	REF_PAY_NO IS NOT NULL	
										AND 	REF_PAY_NO = TRHD.PAY_NO
									)
								)
								<![CDATA[	
								> 0 
								]]>  
								THEN '-'||BILL.STATUS
							ELSE BILL.STATUS
						END            	
	            	)
	            	ELSE
					(
			            CASE 
		             		WHEN TXHD.TAX_APP_NO IS NOT NULL THEN '-1'
							ELSE '-'||BILL.STATUS
						END            	
	            	)
            	END AS PROGRESS_CODE, 		        
            	CASE
            		WHEN TRHD.REF_PAY_NO IS NULL
            		THEN 
	            	(
			            CASE 
		             		WHEN TXHD.TAX_APP_NO IS NOT NULL THEN '승인'
		             		WHEN 
		             			(	SELECT	COUNT(1) 
									FROM	ICOYTRHD
									WHERE 	PAY_NO IN 
									(
										SELECT 	REF_PAY_NO
										FROM	ICOYTRHD
										WHERE	REF_PAY_NO IS NOT NULL	
										AND 	REF_PAY_NO = TRHD.PAY_NO
									)	
								)
								<![CDATA[	
								> 0
								]]>  
								THEN DECODE(BILL.STATUS_TXT, NULL, '전송대기' ,'취소'||BILL.STATUS_TXT)
		             		
							ELSE DECODE(BILL.STATUS_TXT, NULL, '전송대기' ,BILL.STATUS_TXT) 
						END            	
	            	)
	            	ELSE
					(
			            CASE 
		             		WHEN TXHD.TAX_APP_NO IS NOT NULL THEN '취소승인'
							ELSE DECODE(BILL.STATUS_TXT, NULL, '취소 전송대기' ,'취소'|| BILL.STATUS_TXT) 
						END            	
	            	)
            	END AS PROGRESS_CODE_TXT
		FROM ICOYTXHD TXHD
		INNER JOIN ICOYTRDT TRDT
		ON 	TXHD.HOUSE_CODE = TRDT.HOUSE_CODE 
		AND TXHD.TAX_NO = TRDT.TAX_NO 
		INNER JOIN ICOYTRHD TRHD 
		ON TRHD.HOUSE_CODE = TRDT.HOUSE_CODE      
		AND TRHD.PAY_NO = TRDT.PAY_NO
		AND TRHD.HOUSE_CODE  = ${session.HOUSE_CODE}
		AND TXHD.PROGRESS_CODE IN ('V','C','I', 'B')		
	    LEFT OUTER JOIN
	    		( SELECT 	PUBCODE
					,		RESSEQ
					,		NTS_ISSUEID
					,		STATUS
     				,		CASE 
     							WHEN LOADSTATUS = '0' THEN '전송대기'
     							WHEN LOADSTATUS = '1' THEN (CASE
	        													WHEN STATUS = '30' THEN '미확인'
	        													WHEN STATUS = '35' THEN '미승인'
	        													WHEN STATUS = '50' THEN '승인'
	        													WHEN STATUS = '60' THEN '거부(반려)'
	        													WHEN STATUS = '65' THEN '수신 취소요청'
	        													WHEN STATUS = '66' THEN '발신 취소요청'
	        													WHEN STATUS = '99' THEN '발급취소'     	
	        												END)
   	   							ELSE '전송오류 ' || '[' || LOADSTATUS ||  ']' 
       						END AS STATUS_TXT 		
					FROM 
					(
					SELECT 	SB.RESSEQ
					,		EH.STATUS
					,		SB.PUBCODE
					,		SB.LOADSTATUS
					,		SB.NTS_ISSUEID
					FROM 	SALEEBILL SB
					,		(
						 		SELECT	ORDER_SEQ
								,		PUBCODE
								,		STATUS
								FROM	(
										SELECT 	RANK() OVER( PARTITION BY PUBCODE ORDER BY STATUSDATE DESC) AS ORDER_SEQ
										,		PUBCODE
										,		STATUSDATE
										,		STATUS
										FROM 	EB_HISTORY
								)WHERE ORDER_SEQ = 1								
							)EH
					WHERE	SB.PUBCODE = EH.PUBCODE(+) 
					)
			)BILL
		ON	TXHD.TAX_NO = BILL.RESSEQ
		WHERE TXHD.TAX_NO = '#tax_no#'
	</method>
	
	<method name="in_copyTrhd">
		INSERT INTO ICOYTRHD (
		        HOUSE_CODE,
				PAY_NO,
				STATUS,
				ADD_DATE,
				ADD_TIME,
				ADD_USER_ID,
				CHANGE_DATE,
				CHANGE_TIME,
				CHANGE_USER_ID,
				COM_PERSON_FLAG,
				VENDOR_CODE,
				JOB_STATUS,
				TAX_TYPE,
				ISSUE_TYPE,
				ORIGIN_TYPE,
				REJECT_REASON,
				SERIAL_NO,
				PRICE_TOTAL,
				VAT_AMT,
				TAX_TOTAL,
				PAY_AMT,
				NEXT_PAY_AMT,
				NOTE,
				S_REG_NO,
				S_BIZ_ADDR,
				S_CEO_NAME,
				S_CO_NAME,
				S_BIZ_TYPE,
				S_BIZ_CATEGORY,
				S_USER_NAME,
				S_EMAIL,
				S_PHONE_NO,
				S_DEPT,
				B_REG_NO,
				B_BIZ_ADDR,
				B_CEO_NAME,
				B_CO_NAME,
				B_BIZ_TYPE,
				B_BIZ_CATEGORY,
				B_USER_NAME,
				B_EMAIL,
				B_PHONE_NO,
				B_DEPT,
				R_D_FLAG,
				CASH,
				PAYCHECK,
				DRAFT,
				CREDIT,
				CHIT_NO,
				PSTNG_DATE,
				SIGN_STATUS,
				SIGN_DATE,
				REMARKS,
				CTRL_CODE,
				TAX_DIV,
				REF_PAY_NO
		)		
		SELECT	HOUSE_CODE
		, 		${n_pay_no}
		, 		STATUS
		, 		TO_CHAR(SYSDATE,'YYYYMMDD')
		, 		TO_CHAR(SYSDATE,'HH24MISS')
		, 		${session.ID}
		, 		TO_CHAR(SYSDATE,'YYYYMMDD')
		, 		TO_CHAR(SYSDATE,'HH24MISS')
		, 		${session.ID}
		, 		COM_PERSON_FLAG
		, 		VENDOR_CODE
		, 		JOB_STATUS
		, 		TAX_TYPE
		, 		ISSUE_TYPE
		, 		ORIGIN_TYPE
		, 		REJECT_REASON
		, 		SERIAL_NO
		, 		PRICE_TOTAL * -1
		, 		VAT_AMT		* -1
		, 		TAX_TOTAL	* -1
		, 		PAY_AMT		* -1
		, 		NEXT_PAY_AMT* -1
		, 		NOTE
		, 		S_REG_NO
		, 		S_BIZ_ADDR
		, 		S_CEO_NAME
		, 		S_CO_NAME
		, 		S_BIZ_TYPE
		, 		S_BIZ_CATEGORY
		, 		S_USER_NAME
		, 		S_EMAIL
		, 		S_PHONE_NO
		, 		S_DEPT
		, 		B_REG_NO
		, 		B_BIZ_ADDR
		, 		B_CEO_NAME
		, 		B_CO_NAME
		, 		B_BIZ_TYPE
		, 		B_BIZ_CATEGORY
		, 		B_USER_NAME
		, 		B_EMAIL
		, 		B_PHONE_NO
		, 		B_DEPT
		, 		R_D_FLAG
		, 		CASH
		, 		PAYCHECK
		, 		DRAFT
		, 		CREDIT
		, 		CHIT_NO
		, 		PSTNG_DATE
		, 		SIGN_STATUS
		, 		SIGN_DATE
		, 		REMARKS
		, 		CTRL_CODE
		, 		TAX_DIV 
		,		${pay_no}
		FROM 	ICOYTRHD
		WHERE 	PAY_NO = ${pay_no}
	</method>	
	
	<method name="in_copyTrdt">
		INSERT INTO ICOYTRDT (
		        HOUSE_CODE,
				PAY_NO,
				PAY_SEQ,
				STATUS,
				ADD_DATE,
				ADD_TIME,
				ADD_USER_ID,
				CHANGE_DATE,
				CHANGE_TIME,
				CHANGE_USER_ID,
				SPLY_DATE,
				ITEM_NO,
				DESCRIPTION_LOC,
				DESCRIPTION_ENG,
				SPECIFICATION,
				UNIT_MEASURE,
				ITEM_QTY,
				CUR,
				UNIT_PRICE,
				ITEM_AMT,
				DELY_UNIT_PRICE,
				DELY_AMT,
				APP_TYPE,
				TAX_AMT,
				PAY_AMT,
				PRE_PAY_AMT,
				NEXT_PAY_AMT,
				ACCOUNT_CODE,
				INVEST_NO,
				Z_CODE3,
				PO_NO,
				PO_SEQ,
				INV_NO,
				INV_SEQ,
				TAX_NO,
				TAX_SEQ,
				REMARKS
		)
		SELECT	HOUSE_CODE
		, 		${n_pay_no}
		, 		PAY_SEQ
		, 		STATUS
		, 		TO_CHAR(SYSDATE,'YYYYMMDD')
		, 		TO_CHAR(SYSDATE,'HH24MISS')
		, 		${session.ID}
		, 		TO_CHAR(SYSDATE,'YYYYMMDD')
		, 		TO_CHAR(SYSDATE,'HH24MISS')
		, 		${session.ID}
		, 		SPLY_DATE
		, 		ITEM_NO
		, 		DESCRIPTION_LOC
		, 		DESCRIPTION_ENG
		, 		SPECIFICATION
		, 		UNIT_MEASURE
		, 		ITEM_QTY
		, 		CUR
		, 		UNIT_PRICE 		* -1
		, 		ITEM_AMT		* -1
		, 		DELY_UNIT_PRICE * -1
		, 		DELY_AMT 		* -1
		, 		APP_TYPE
		, 		TAX_AMT 		* -1
		, 		PAY_AMT 		* -1
		, 		PRE_PAY_AMT 	* -1
		, 		NEXT_PAY_AMT 	* -1
		, 		ACCOUNT_CODE
		, 		INVEST_NO
		, 		Z_CODE3
		, 		PO_NO
		, 		PO_SEQ
		, 		INV_NO
		, 		INV_SEQ
		, 		${n_tax_no}
		, 		TAX_SEQ
		, 		REMARKS
		FROM 	ICOYTRDT
		WHERE 	PAY_NO = ${pay_no}
	</method>
	
	<method name="in_copyTxhd">
		INSERT	INTO ICOYTXHD (
		        HOUSE_CODE,
				TAX_NO,
				COMPANY_CODE,
				ADD_DATE,
				ADD_TIME,
				ADD_USER_ID,
				CHANGE_DATE,
				CHANGE_TIME,
				CHANGE_USER_ID,
				STATUS,
				SUPBUY_TYPE,
				DIRECT_TYPE,
				TAX_DATE,
				TAX_APP_NO,
				ATTACH_NO,
				BLANK_CNT,
				TAX_TYPE,
				RECEIPT_TYPE,
				SUP_IRS_NO,
				SUP_COM_CODE,
				SUP_CEO_USER_NAME,
				SUP_COM_NAME,
				SUP_BUSINESS_TYPE,
				SUP_INDUSTRY_TYPE,
				SUP_ADDRESS,
				BUYER_IRS_NO,
				BUYER_CEO_USER_NAME,
				BUYER_COM_NAME,
				BUYER_BUSINESS_TYPE,
				BUYER_INDUSTRY_TYPE,
				BUYER_ADDRESS,
				SUP_AMT,
				VAT_AMT,
				TOTAL_AMT,
				DEAL_FLAG,
				SUP_REJECT_REMARK,
				BUYER_REJECT_REMARK,
				PROGRESS_CODE,
				SIGN_DATE,
				SIGN_PERSON_ID,
				SIGN_STATUS,
				PAY_DEMAND_FLAG,
				PAY_DEMAND_DATE,
				PAY_END_DATE,
				GROUP_TAX_NO,
				KTGRM,
				PROC_DEPT 
		)
		SELECT	HOUSE_CODE
		, 		${n_tax_no}
		,		COMPANY_CODE
		,		TO_CHAR(SYSDATE,'YYYYMMDD')
		,		TO_CHAR(SYSDATE,'HH24MISS')
		,		${session.ID}              
		,		TO_CHAR(SYSDATE,'YYYYMMDD')
		,		TO_CHAR(SYSDATE,'HH24MISS')
		,		${session.ID}  
		,		STATUS
		,		SUPBUY_TYPE
		, 		DIRECT_TYPE
		, 		TO_CHAR(SYSDATE,'YYYYMMDD')
		, 		TAX_APP_NO
		, 		ATTACH_NO
		, 		BLANK_CNT
		, 		TAX_TYPE
		, 		RECEIPT_TYPE
		, 		SUP_IRS_NO
		, 		SUP_COM_CODE
		, 		SUP_CEO_USER_NAME
		, 		SUP_COM_NAME
		, 		SUP_BUSINESS_TYPE
		, 		SUP_INDUSTRY_TYPE
		, 		SUP_ADDRESS
		, 		BUYER_IRS_NO
		, 		BUYER_CEO_USER_NAME
		, 		BUYER_COM_NAME
		, 		BUYER_BUSINESS_TYPE
		, 		BUYER_INDUSTRY_TYPE
		, 		BUYER_ADDRESS
		, 		SUP_AMT		* -1		
		, 		VAT_AMT		* -1
		, 		TOTAL_AMT	* -1
		, 		DEAL_FLAG	
		, 		SUP_REJECT_REMARK
		, 		BUYER_REJECT_REMARK
		, 		PROGRESS_CODE
		, 		SIGN_DATE
		, 		SIGN_PERSON_ID
		, 		SIGN_STATUS
		, 		PAY_DEMAND_FLAG
		, 		PAY_DEMAND_DATE
		, 		PAY_END_DATE
		, 		GROUP_TAX_NO
		, 		KTGRM 
		, 		PROC_DEPT
		FROM 	ICOYTXHD
		WHERE 	TAX_NO = ${tax_no}
	</method>
	
	<method name="in_copyTxdt">
		INSERT	INTO ICOYTXDT (
				HOUSE_CODE,
				TAX_NO,
				TAX_SEQ,
				COMPANY_CODE,
				ADD_DATE,
				ADD_TIME,
				ADD_USER_ID,
				CHANGE_DATE,
				CHANGE_TIME,
				CHANGE_USER_ID,
				STATUS,
				ITEM_CODE,
				ITEM_DESC,
				ITEM_SPEC,
				BUY_DATE,
				UNIT_PRICE,
				ITEM_QTY,
				SUP_AMT,
				VAT_AMT,
				FOR_SUP_AMT,
				CUR,
				REMARK,
				SPY_CHECK
		)
		SELECT	HOUSE_CODE
		, 		${n_tax_no}
		, 		TAX_SEQ
		, 		COMPANY_CODE
		,		TO_CHAR(SYSDATE,'YYYYMMDD')
		,		TO_CHAR(SYSDATE,'HH24MISS')
		,		${session.ID}              
		,		TO_CHAR(SYSDATE,'YYYYMMDD')
		,		TO_CHAR(SYSDATE,'HH24MISS')
		,		${session.ID}    
		, 		STATUS
		, 		ITEM_CODE
		, 		ITEM_DESC
		, 		ITEM_SPEC
		, 		BUY_DATE
		, 		UNIT_PRICE	* -1
		, 		ITEM_QTY
		, 		SUP_AMT		* -1
		, 		VAT_AMT		* -1
		, 		FOR_SUP_AMT	* -1
		, 		CUR
		, 		REMARK
		, 		SPY_CHECK
		FROM 	ICOYTXDT
		WHERE 	TAX_NO = ${tax_no}
	</method>
	
	<method name="in_copySaleEbill">
		INSERT INTO SALEEBILL(
			RESSEQ,				
			DOCCODE,			
			EBILLKIND,			
			CUSTOMS,           
			DOCATTR,			
			PUBDATE,			
			SYSTEMCODE,			
			PUBTYPE,           
			PUBFORM,    		
			MEMID,				
			MEMDEPTNAME,		
			MEMNAME,			
			EMAIL,				
			TEL,				
			COREGNO,			
			COTAXREGNO, 		
			CONAME,				
			COCEO,				
			COADDR,				
			COBIZTYPE,			
			COBIZSUB,			
			RECMEMID,			
			RECMEMDEPTNAME,		
			RECMEMNAME,			
			RECEMAIL,			
			RECTEL,				
			RECCOREGNOTYPE,		
			RECCOREGNO,			
			RECCOTAXREGNO,		
			RECCONAME,      	
			RECCOCEO,   		
			RECCOADDR,			
			RECCOBIZTYPE,		
			RECCOBIZSUB,		
			SUPPRICE,          	
			TAX,				
			PUBKIND,			
			LOADSTATUS,			
			PUBSTATUS,			
			SMS
		)
		SELECT 
			${n_tax_no},				
			DOCCODE,			
			EBILLKIND,			
			CUSTOMS,           
			DOCATTR,			
			PUBDATE,			
			SYSTEMCODE,			
			PUBTYPE,           
			PUBFORM,    		
			MEMID,				
			MEMDEPTNAME,		
			MEMNAME,			
			EMAIL,				
			TEL,				
			COREGNO,			
			COTAXREGNO, 		
			CONAME,				
			COCEO,				
			COADDR,				
			COBIZTYPE,			
			COBIZSUB,			
			RECMEMID,			
			RECMEMDEPTNAME,		
			RECMEMNAME,			
			RECEMAIL,			
			RECTEL,				
			RECCOREGNOTYPE,		
			RECCOREGNO,			
			RECCOTAXREGNO,		
			RECCONAME,      	
			RECCOCEO,   		
			RECCOADDR,			
			RECCOBIZTYPE,		
			RECCOBIZSUB,		
			SUPPRICE * -1,          	
			TAX * -1,				
			PUBKIND,			
			'0',			
			null,			
			SMS
			FROM SALEEBILL	
			WHERE RESSEQ = ${tax_no}			
	</method>
	
	<method name="in_copyItemList">
		INSERT INTO ITEMLIST (
			SEQID,			
			DETAILSEQID,		
			ITEMDATE,
			ITEMNAME,		
			ITEMTYPE,			
			ITEMQTY,
			ITEMPRICE,		
			ITEMSUPPRICE,		
			ITEMTAX,
			ITEMREMARKS
		) 		
		SELECT ${n_tax_no}|| SUBSTR(SEQID, 14 ,17) 	,	
			${n_tax_no},		
			ITEMDATE,
			ITEMNAME,		
			ITEMTYPE,			
			ITEMQTY,
			ITEMPRICE * -1,		
			ITEMSUPPRICE * -1,		
			ITEMTAX * -1,
			ITEMREMARKS from ITEMLIST
		WHERE DETAILSEQID = ${tax_no}
	</method>
		
</service>