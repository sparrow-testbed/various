<?xml version="1.0" encoding="UTF-8"?> 
<service>
	<!--  세금계산서 현황 -->
	<method name="et_getPayList_20210421bak">
		SELECT
			TXHD.TAX_NO, 
			TXDT.TAX_SEQ, 
			
			PRDT.DEMAND_DEPT                                                          AS DELY_TO_LOCATION,
            GETDEPTNAME(PRDT.HOUSE_CODE, PRDT.COMPANY_CODE, PRDT.DEMAND_DEPT, 'LOC' ) AS DELY_TO_LOCATION_NM,
     							
			OGIL.ILGAE_CD AS IGJM_CD,
			'' AS ACCOUNT_CODE,
			'' AS ACCOUNT_NM,
			MTGL.ACCOUNT_CODE AS ACCOUNT_CODE,
			MTGL.ACCOUNT_NM AS ACCOUNT_NM,
			TRDT.ITEM_NO AS ITEM_NO,
			MTGL.DESCRIPTION_LOC AS ITEM_NM,
			PODT.SPECIFICATION AS SPECIFICATION,
			TRDT.ITEM_QTY AS QTY,
			TRDT.DELY_UNIT_PRICE AS UNIT_PRICE,
			TRDT.DELY_AMT AS AMT,
			TRHD.VENDOR_CODE,
			VNGL.VENDOR_NAME_LOC AS VENDOR_NAME,
			MTGL.MODEL_NO,
			MTGL.MATERIAL_TYPE,
		    TXDT.REMARK,
		    TRDT.INV_NO,
		    TRDT.INV_SEQ	
		FROM
			ICOYTRHD TRHD
		INNER JOIN ICOYTRDT TRDT ON TRHD.HOUSE_CODE = TRDT.HOUSE_CODE AND TRHD.PAY_NO      = TRDT.PAY_NO 
		INNER JOIN ICOYPODT PODT ON TRDT.HOUSE_CODE = PODT.HOUSE_CODE AND TRDT.PO_NO       = PODT.PO_NO       AND TRDT.PO_SEQ = PODT.PO_SEQ
		INNER JOIN ICOYPRHD PRHD ON PODT.HOUSE_CODE = PRHD.HOUSE_CODE AND PODT.PR_NO       = PRHD.PR_NO
		
		INNER JOIN ICOYPRDT PRDT ON PRHD.HOUSE_CODE = PRDT.HOUSE_CODE AND PRHD.PR_NO       = PRDT.PR_NO
                                                           AND PODT.PR_NO       = PRDT.PR_NO   AND PODT.PR_SEQ  = PRDT.PR_SEQ                
		INNER JOIN ICOMOGIL OGIL ON PRDT.HOUSE_CODE = OGIL.HOUSE_CODE AND PRDT.DEMAND_DEPT = OGIL.DEPT
				
		INNER JOIN ICOYTXHD TXHD ON TRDT.HOUSE_CODE = TXHD.HOUSE_CODE AND TRDT.TAX_NO      = TXHD.TAX_NO
		INNER JOIN ICOYTXDT TXDT ON TRDT.HOUSE_CODE = TXDT.HOUSE_CODE AND TRDT.TAX_NO      = TXDT.TAX_NO      AND TRDT.TAX_SEQ = TXDT.TAX_SEQ
		INNER JOIN ICOMMTGL MTGL ON TRDT.HOUSE_CODE = MTGL.HOUSE_CODE AND TRDT.ITEM_NO     = MTGL.ITEM_NO
		INNER JOIN ICOMVNGL VNGL ON TRHD.HOUSE_CODE = VNGL.HOUSE_CODE AND TRHD.VENDOR_CODE = VNGL.VENDOR_CODE
		WHERE 
			MTGL.MATERIAL_TYPE IN ('02','04')
		AND
			TRHD.HOUSE_CODE  = ${HOUSE_CODE}
		AND
			(TXHD.TAX_NO, TXDT.TAX_SEQ ) IN (#TAX_NO_SEQ#)
		AND
			TXHD.PROGRESS_CODE IN ('P','E')  
		ORDER BY
			TRHD.ADD_DATE DESC,
			TXHD.TAX_NO DESC
	</method>
	
	<method name="et_getPayList">
		SELECT
			TAX_NO,
			TAX_SEQ,  
			DELY_TO_LOCATION,
            DELY_TO_LOCATION_NM,
     							
			IGJM_CD,
		    ACCOUNT_CODE,
			ACCOUNT_NM,
			ITEM_NO,
			ITEM_NM,
			SPECIFICATION,
			QTY,
			UNIT_PRICE,
			AMT,
			VENDOR_CODE,
			VENDOR_NAME,
		    CASE WHEN MDLMDLNM IS NULL THEN MODEL_NO
		 	ELSE  MDLMDLNM
		 	END			AS MODEL_NO,	 		
			MATERIAL_TYPE,
		    REMARK,
		    INV_NO,
		    INV_SEQ
		FROM
			(
				SELECT
					TXHD.TAX_NO, 
					TXDT.TAX_SEQ, 
					
					PRDT.DEMAND_DEPT                                                          AS DELY_TO_LOCATION,
		            GETDEPTNAME(PRDT.HOUSE_CODE, PRDT.COMPANY_CODE, PRDT.DEMAND_DEPT, 'LOC' ) AS DELY_TO_LOCATION_NM,
		     							
					OGIL.ILGAE_CD AS IGJM_CD,
					MTGL.ACCOUNT_CODE AS ACCOUNT_CODE,
					MTGL.ACCOUNT_NM AS ACCOUNT_NM,
					TRDT.ITEM_NO AS ITEM_NO,
					MTGL.DESCRIPTION_LOC AS ITEM_NM,
					PODT.SPECIFICATION AS SPECIFICATION,
					TRDT.ITEM_QTY AS QTY,
					TRDT.DELY_UNIT_PRICE AS UNIT_PRICE,
					TRDT.DELY_AMT AS AMT,
					TRHD.VENDOR_CODE,
					VNGL.VENDOR_NAME_LOC AS VENDOR_NAME,
					MTGL.MODEL_NO,
					INFO.MDLMDLNM,
					MTGL.MATERIAL_TYPE,
				    TXDT.REMARK,
				    TRDT.INV_NO,
				    TRDT.INV_SEQ,
				    TRHD.ADD_DATE,
				    (
						SELECT
							COUNT(1)
						FROM
							SPY1LN PYLN
						INNER JOIN SPY1GL PYGL ON PYLN.HOUSE_CODE = PYGL.HOUSE_CODE AND PYLN.PAY_SEND_NO = PYGL.PAY_SEND_NO
						WHERE
							PYLN.HOUSE_CODE = TXDT.HOUSE_CODE
						AND
							PYLN.TAX_NO     = TXDT.TAX_NO
						AND
							PYLN.TAX_SEQ    = TXDT.TAX_SEQ
						AND
							PYGL.DEL_YN     = 'N'
					) AS PY_CNT	
				FROM
					ICOYTRHD TRHD
				INNER JOIN ICOYTRDT TRDT ON TRHD.HOUSE_CODE = TRDT.HOUSE_CODE AND TRHD.PAY_NO      = TRDT.PAY_NO 
				INNER JOIN ICOYPODT PODT ON TRDT.HOUSE_CODE = PODT.HOUSE_CODE AND TRDT.PO_NO       = PODT.PO_NO       AND TRDT.PO_SEQ = PODT.PO_SEQ
				INNER JOIN ICOYPRHD PRHD ON PODT.HOUSE_CODE = PRHD.HOUSE_CODE AND PODT.PR_NO       = PRHD.PR_NO
				
				INNER JOIN ICOYPRDT PRDT ON PRHD.HOUSE_CODE = PRDT.HOUSE_CODE AND PRHD.PR_NO       = PRDT.PR_NO
		                                                           AND PODT.PR_NO       = PRDT.PR_NO   AND PODT.PR_SEQ  = PRDT.PR_SEQ                
				INNER JOIN ICOMOGIL OGIL ON PRDT.HOUSE_CODE = OGIL.HOUSE_CODE AND PRDT.DEMAND_DEPT = OGIL.DEPT
						
				INNER JOIN ICOYTXHD TXHD ON TRDT.HOUSE_CODE = TXHD.HOUSE_CODE AND TRDT.TAX_NO      = TXHD.TAX_NO
				INNER JOIN ICOYTXDT TXDT ON TRDT.HOUSE_CODE = TXDT.HOUSE_CODE AND TRDT.TAX_NO      = TXDT.TAX_NO      AND TRDT.TAX_SEQ = TXDT.TAX_SEQ
				INNER JOIN ICOMMTGL MTGL ON TRDT.HOUSE_CODE = MTGL.HOUSE_CODE AND TRDT.ITEM_NO     = MTGL.ITEM_NO
				INNER JOIN ICOMVNGL VNGL ON TRHD.HOUSE_CODE = VNGL.HOUSE_CODE AND TRHD.VENDOR_CODE = VNGL.VENDOR_CODE
				LEFT OUTER JOIN ICOYINFO INFO ON TRDT.HOUSE_CODE = INFO.HOUSE_CODE AND TRDT.ITEM_NO     = INFO.ITEM_NO  AND TRHD.VENDOR_CODE = INFO.VENDOR_CODE  AND INFO.STATUS IN ('C','D')
                             AND TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN INFO.VALID_FROM_DATE AND INFO.VALID_TO_DATE
				WHERE 
					MTGL.MATERIAL_TYPE IN ('02','04')
				AND
					TRHD.HOUSE_CODE  = ${HOUSE_CODE}
				AND
					TXHD.TAX_NO IN (#TAX_NO#)
				AND
					TXHD.PROGRESS_CODE IN ('P','E') 
	       )
			WHERE
				PY_CNT = 0
			ORDER BY
				ADD_DATE DESC,
				TAX_NO DESC
	</method>
	
	<method name="selectValidVendor_20210421bak">
		SELECT
			DISTINCT
			TRHD.VENDOR_CODE,
			VNGL.VENDOR_NAME_LOC,
			VNGL.IRS_NO,
			VNGL.DEPOSITOR_NAME,
			GETICOMCODE1(VNGL.HOUSE_CODE, 'M349', VNGL.BANK_CODE) AS BANK_NAME,
			VNGL.BANK_ACCT,
			VNGL.BANK_CODE
		FROM
			ICOYTRHD TRHD
		INNER JOIN ICOYTRDT TRDT ON TRHD.HOUSE_CODE  = TRDT.HOUSE_CODE AND TRHD.PAY_NO           = TRDT.PAY_NO 
		INNER JOIN ICOYPODT PODT ON TRDT.HOUSE_CODE  = PODT.HOUSE_CODE AND TRDT.PO_NO            = PODT.PO_NO       AND TRDT.PO_SEQ = PODT.PO_SEQ
		INNER JOIN ICOMOGIL OGIL ON PODT.HOUSE_CODE  = OGIL.HOUSE_CODE AND PODT.DELY_TO_LOCATION = OGIL.DEPT
		INNER JOIN ICOYTXHD TXHD ON TRDT.HOUSE_CODE  = TXHD.HOUSE_CODE AND TRDT.TAX_NO           = TXHD.TAX_NO
		INNER JOIN ICOYTXDT TXDT ON TRDT.HOUSE_CODE  = TXDT.HOUSE_CODE AND TRDT.TAX_NO           = TXDT.TAX_NO      AND TRDT.TAX_SEQ = TXDT.TAX_SEQ
		INNER JOIN ICOMMTGL MTGL ON TRDT.HOUSE_CODE  = MTGL.HOUSE_CODE AND TRDT.ITEM_NO          = MTGL.ITEM_NO
		INNER JOIN ICOMVNGL VNGL ON TRHD.HOUSE_CODE  = VNGL.HOUSE_CODE AND TRHD.VENDOR_CODE      = VNGL.VENDOR_CODE
		WHERE 
			MTGL.MATERIAL_TYPE IN ('02','04')
		AND
			TRHD.HOUSE_CODE  = ${HOUSE_CODE}
		AND
			(TXHD.TAX_NO, TXDT.TAX_SEQ ) IN (#TAX_NO_SEQ#)
	</method>
	
	<method name="selectValidVendor">
		SELECT
			DISTINCT
			TRHD.VENDOR_CODE,
			VNGL.VENDOR_NAME_LOC,
			VNGL.IRS_NO,
			VNGL.DEPOSITOR_NAME,
			GETICOMCODE1(VNGL.HOUSE_CODE, 'M349', VNGL.BANK_CODE) AS BANK_NAME,
			VNGL.BANK_ACCT,
			VNGL.BANK_CODE,
			TRHD.PRICE_TOTAL,           
            TRHD.VAT_AMT,               
            TRHD.TAX_TOTAL
		FROM
			ICOYTRHD TRHD
		INNER JOIN ICOYTRDT TRDT ON TRHD.HOUSE_CODE  = TRDT.HOUSE_CODE AND TRHD.PAY_NO           = TRDT.PAY_NO 
		INNER JOIN ICOYPODT PODT ON TRDT.HOUSE_CODE  = PODT.HOUSE_CODE AND TRDT.PO_NO            = PODT.PO_NO       AND TRDT.PO_SEQ = PODT.PO_SEQ
		INNER JOIN ICOMOGIL OGIL ON PODT.HOUSE_CODE  = OGIL.HOUSE_CODE AND PODT.DELY_TO_LOCATION = OGIL.DEPT
		INNER JOIN ICOYTXHD TXHD ON TRDT.HOUSE_CODE  = TXHD.HOUSE_CODE AND TRDT.TAX_NO           = TXHD.TAX_NO
		INNER JOIN ICOYTXDT TXDT ON TRDT.HOUSE_CODE  = TXDT.HOUSE_CODE AND TRDT.TAX_NO           = TXDT.TAX_NO      AND TRDT.TAX_SEQ = TXDT.TAX_SEQ
		INNER JOIN ICOMMTGL MTGL ON TRDT.HOUSE_CODE  = MTGL.HOUSE_CODE AND TRDT.ITEM_NO          = MTGL.ITEM_NO
		INNER JOIN ICOMVNGL VNGL ON TRHD.HOUSE_CODE  = VNGL.HOUSE_CODE AND TRHD.VENDOR_CODE      = VNGL.VENDOR_CODE
		WHERE 
			MTGL.MATERIAL_TYPE IN ('02','04')
		AND
			TRHD.HOUSE_CODE  = ${HOUSE_CODE}
		AND
			TXHD.TAX_NO IN (#TAX_NO#)
	</method>
	
	<method name="selectValidIgjm">
		SELECT
			DISTINCT
			OGDP.DEPT,
   			OGDP.DEPT_NAME_LOC
		FROM
			ICOYTRHD TRHD
		INNER JOIN ICOYTRDT TRDT ON TRHD.HOUSE_CODE = TRDT.HOUSE_CODE AND TRHD.PAY_NO           = TRDT.PAY_NO 
		INNER JOIN ICOYPODT PODT ON TRDT.HOUSE_CODE = PODT.HOUSE_CODE AND TRDT.PO_NO            = PODT.PO_NO   AND TRDT.PO_SEQ = PODT.PO_SEQ
		INNER JOIN ICOMOGIL OGIL ON PODT.HOUSE_CODE = OGIL.HOUSE_CODE AND PODT.DELY_TO_LOCATION = OGIL.DEPT    
		INNER JOIN ICOYTXHD TXHD ON TRDT.HOUSE_CODE = TXHD.HOUSE_CODE AND TRDT.TAX_NO           = TXHD.TAX_NO  
		INNER JOIN ICOYTXDT TXDT ON TRDT.HOUSE_CODE = TXDT.HOUSE_CODE AND TRDT.TAX_NO           = TXDT.TAX_NO  AND TRDT.TAX_SEQ = TXDT.TAX_SEQ
		INNER JOIN ICOMMTGL MTGL ON TRDT.HOUSE_CODE = MTGL.HOUSE_CODE AND TRDT.ITEM_NO          = MTGL.ITEM_NO
		INNER JOIN ICOMOGDP OGDP ON OGIL.HOUSE_CODE = OGDP.HOUSE_CODE AND OGIL.ILGAE_CD         = OGDP.DEPT
		WHERE 
			MTGL.MATERIAL_TYPE IN ('02','04')
		AND
			TRHD.HOUSE_CODE  = ${HOUSE_CODE}
		AND
			(TXHD.TAX_NO, TXDT.TAX_SEQ ) IN (#TAX_NO_SEQ#)
		AND
			OGDP.STATUS != 'D'
	</method>
	
	<method name="selectSumDelyAmt_20210421bak">
		SELECT
			SUM(TRDT.DELY_AMT) AS AMT
		FROM
			ICOYTRHD TRHD
		INNER JOIN ICOYTRDT TRDT ON TRHD.HOUSE_CODE  = TRDT.HOUSE_CODE AND TRHD.PAY_NO           = TRDT.PAY_NO 
		INNER JOIN ICOYPODT PODT ON TRDT.HOUSE_CODE  = PODT.HOUSE_CODE AND TRDT.PO_NO            = PODT.PO_NO       AND TRDT.PO_SEQ = PODT.PO_SEQ
		INNER JOIN ICOMOGIL OGIL ON PODT.HOUSE_CODE  = OGIL.HOUSE_CODE AND PODT.DELY_TO_LOCATION = OGIL.DEPT
		INNER JOIN ICOYTXHD TXHD ON TRDT.HOUSE_CODE  = TXHD.HOUSE_CODE AND TRDT.TAX_NO           = TXHD.TAX_NO
		INNER JOIN ICOYTXDT TXDT ON TRDT.HOUSE_CODE  = TXDT.HOUSE_CODE AND TRDT.TAX_NO           = TXDT.TAX_NO      AND TRDT.TAX_SEQ = TXDT.TAX_SEQ
		INNER JOIN ICOMMTGL MTGL ON TRDT.HOUSE_CODE  = MTGL.HOUSE_CODE AND TRDT.ITEM_NO          = MTGL.ITEM_NO
		INNER JOIN ICOMVNGL VNGL ON TRHD.HOUSE_CODE  = VNGL.HOUSE_CODE AND TRHD.VENDOR_CODE      = VNGL.VENDOR_CODE
		WHERE 
			MTGL.MATERIAL_TYPE IN ('02','04')
		AND
			TRHD.HOUSE_CODE  = ${HOUSE_CODE}
		AND
			(TXHD.TAX_NO, TXDT.TAX_SEQ ) IN (#TAX_NO_SEQ#)
	</method>
	
	<method name="selectSumDelyAmt">
		SELECT
			SUM(DELY_AMT) AS AMT
		FROM
			(
				SELECT
					TRDT.DELY_AMT,
					(
						SELECT
							COUNT(1)
						FROM
							SPY1LN PYLN
						INNER JOIN SPY1GL PYGL ON PYLN.HOUSE_CODE = PYGL.HOUSE_CODE AND PYLN.PAY_SEND_NO = PYGL.PAY_SEND_NO
						WHERE
							PYLN.HOUSE_CODE = TXDT.HOUSE_CODE
						AND
							PYLN.TAX_NO     = TXDT.TAX_NO
						AND
							PYLN.TAX_SEQ    = TXDT.TAX_SEQ
						AND
							PYGL.DEL_YN     = 'N'
					) AS PY_CNT	
				FROM
					ICOYTRHD TRHD
				INNER JOIN ICOYTRDT TRDT ON TRHD.HOUSE_CODE  = TRDT.HOUSE_CODE AND TRHD.PAY_NO           = TRDT.PAY_NO 
				INNER JOIN ICOYPODT PODT ON TRDT.HOUSE_CODE  = PODT.HOUSE_CODE AND TRDT.PO_NO            = PODT.PO_NO       AND TRDT.PO_SEQ = PODT.PO_SEQ
				INNER JOIN ICOMOGIL OGIL ON PODT.HOUSE_CODE  = OGIL.HOUSE_CODE AND PODT.DELY_TO_LOCATION = OGIL.DEPT
				INNER JOIN ICOYTXHD TXHD ON TRDT.HOUSE_CODE  = TXHD.HOUSE_CODE AND TRDT.TAX_NO           = TXHD.TAX_NO
				INNER JOIN ICOYTXDT TXDT ON TRDT.HOUSE_CODE  = TXDT.HOUSE_CODE AND TRDT.TAX_NO           = TXDT.TAX_NO      AND TRDT.TAX_SEQ = TXDT.TAX_SEQ
				INNER JOIN ICOMMTGL MTGL ON TRDT.HOUSE_CODE  = MTGL.HOUSE_CODE AND TRDT.ITEM_NO          = MTGL.ITEM_NO
				INNER JOIN ICOMVNGL VNGL ON TRHD.HOUSE_CODE  = VNGL.HOUSE_CODE AND TRHD.VENDOR_CODE      = VNGL.VENDOR_CODE
				WHERE 
					MTGL.MATERIAL_TYPE IN ('02','04')
				AND
					TRHD.HOUSE_CODE  = ${HOUSE_CODE}
				AND
					TXHD.TAX_NO IN (#TAX_NO#)
			)
			WHERE
				PY_CNT = 0
	</method>
	
	<method name="insertSpy1glInfo">
		INSERT INTO SPY1GL(
			HOUSE_CODE,   PAY_SEND_NO,         VENDOR_CODE, DEPOSITOR_NAME, BANK_CODE,
			BANK_ACCT,    PAY_AMT,             SIGNER_FLAG, SIGNER_NO,      SIGNER_BIO,
			WORK_KIND,    BMSBMSYY,            SOGSOGCD,    ASTASTGB,       MNGMNGNO,
			BSSBSSNO,     APPAPPYY,            BMSSRLNO,    APPAPPNO,       APPAPPAM,
			JUMJUM_CD,    IGJM_CD,             BDSBDSCD,    BDSBDSNM,       USE_KIND,
			DEAL_AREA,    DURABLE_YEAR,        DEAL_DEBT,   ACCOUNTKIND,    DEAL_KIND,
			TRM_RTN_SQNO, USER_TRM_NO,         STATUS_CD,   ADD_DATE,       ADD_TIME,
			ADD_USER_ID,  CHANGE_DATE,         CHANGE_TIME, CHANGE_USER_ID, TCP_STATE,
			WEB_STATE,    MANUAL_ACCOUNT_KIND, DEL_YN,      BEFORE_SIGN_NO, SIGN_STATUS
		)
		VALUES(
			${HOUSE_CODE},
			${PAY_SEND_NO},
			${VENDOR_CODE},
			${DEPOSITOR_NAME},
			${BANK_CODE},
			
			${BANK_ACCT},
			${PAY_AMT},      
			${SIGNER_FLAG},
			${SIGNER_NO},
			null,
			
			${WORK_KIND},
			${BMSBMSYY},
			${SOGSOGCD},
			${ASTASTGB},
			${MNGMNGNO},
			
			${BSSBSSNO},
			${APPAPPYY},
			${BMSSRLNO},
			${APPAPPNO},
			${APPAPPAM},
			
			${JUMJUM_CD},
			${IGJM_CD},
			${BDSBDSCD},
			${BDSBDSNM},
			${USE_KIND},
			
			${DEAL_AREA},
			${DURABLE_YEAR},
			${DEAL_DEBT},
			${ACCOUNTKIND},
			${DEAL_KIND},
			
			${TRM_RTN_SQNO},
			${USER_TRM_NO},
			${STATUS_CD},
			TO_CHAR(SYSDATE, 'YYYYMMDD'),
			TO_CHAR(SYSDATE, 'HH24MISS'),
			
			${ADD_USER_ID},
			TO_CHAR(SYSDATE, 'YYYYMMDD'),
			TO_CHAR(SYSDATE, 'HH24MISS'),
			${ADD_USER_ID},
			'N',
			
			'N',
			'N',
			'N',
			${BEFORE_SIGN_NO},
			'P'
		)
	</method>
	
	<method name="insertSpy1lnInfo">
		INSERT INTO SPY1LN (
			HOUSE_CODE,  PAY_SEND_NO, PAY_SEND_SEQ,   TAX_NO,   TAX_SEQ,
			JUMJUJMCD,   IGJMCD,      PMKPMKCD,       CNT,      AMT,
			APPAPPAM,    DOSUNQNO,    ADD_DATE,       ADD_TIME, ADD_USER_ID,
			CHANGE_DATE, CHANGE_TIME, CHANGE_USER_ID, MODEL_NO
		)
		VALUES(
			${HOUSE_CODE},
			${PAY_SEND_NO},
			${PAY_SEND_SEQ},
			${TAX_NO},
			${TAX_SEQ},
			
			${JUMJUJMCD},
			${IGJMCD},
			${PMKPMKCD},
			${CNT},
			${AMT},
			
			${APPAPPAM},
			${DOSUNQNO},
			TO_CHAR(SYSDATE, 'YYYYMMDD'),
			TO_CHAR(SYSDATE, 'HH24MISS'),
			${ADD_USER_ID},
			
			TO_CHAR(SYSDATE, 'YYYYMMDD'),
			TO_CHAR(SYSDATE, 'HH24MISS'),
			${ADD_USER_ID},
			REPLACE(REPLACE(${MODEL_NO},CHR(10),''),CHR(13),'')
		)
	</method>
	
	<method name="updateICOYPRHD_JUMJUMCD">
		UPDATE ICOYPRHD 
           SET DEMAND_DEPT = ${JUMJUJMCD}
              ,DEMAND_DEPT_NAME = (SELECT DEPT_NAME_LOC
		                             FROM ICOMOGDP 
		                            WHERE HOUSE_CODE = ${HOUSE_CODE} 
		                              AND DEPT = ${JUMJUJMCD})
         WHERE PR_NO IN  ( SELECT  PR_NO 
                             FROM ICOYPODT 
                            WHERE (PO_NO,PO_SEQ) IN (SELECT PO_NO,PO_SEQ
							                           FROM ICOYTRDT 
							                          WHERE TAX_NO = ${TAX_NO} 
									                    AND TAX_SEQ = ${TAX_SEQ})
						 )
	</method>
	
	<method name="updateICOYPRDT_JUMJUMCD_20160520_backup">
		UPDATE ICOYPRDT 
		SET DELY_TO_ADDRESS_CD = ${JUMJUJMCD}
		   ,DELY_TO_ADDRESS= (SELECT DEPT_NAME_LOC
		                        FROM ICOMOGDP 
		                       WHERE HOUSE_CODE = ${HOUSE_CODE} 
		                         AND DEPT = ${JUMJUJMCD})
		   ,DEMAND_DEPT = ${JUMJUJMCD} 
		WHERE (PR_NO,PR_SEQ) IN ( SELECT PR_NO,PR_SEQ 
									FROM ICOYPODT 
									WHERE (PO_NO,PO_SEQ) IN (SELECT PO_NO,PO_SEQ
									                           FROM ICOYTRDT 
									                          WHERE TAX_NO = ${TAX_NO} 
									                            AND TAX_SEQ = ${TAX_SEQ})
								)
					
	</method>
	
	<method name="updateICOYPRDT_JUMJUMCD">
		UPDATE ICOYPRDT 
		SET DEMAND_DEPT = ${JUMJUJMCD} 
		WHERE (PR_NO,PR_SEQ) IN ( SELECT PR_NO,PR_SEQ 
									FROM ICOYPODT 
									WHERE (PO_NO,PO_SEQ) IN (SELECT PO_NO,PO_SEQ
									                           FROM ICOYTRDT 
									                          WHERE TAX_NO = ${TAX_NO} 
									                            AND TAX_SEQ = ${TAX_SEQ})
								)
					
	</method>
	
	<method name="selectValidVendor2">
		SELECT
			DISTINCT
			TRHD.VENDOR_CODE,
			VNGL.VENDOR_NAME_LOC,
			VNGL.IRS_NO,
			VNGL.DEPOSITOR_NAME,
			GETICOMCODE1(VNGL.HOUSE_CODE, 'M349', VNGL.BANK_CODE) AS BANK_NAME,
			VNGL.BANK_ACCT,
			VNGL.BANK_CODE
		FROM
			ICOYTRHD TRHD
		INNER JOIN ICOYTRDT TRDT ON TRHD.HOUSE_CODE  = TRDT.HOUSE_CODE AND TRHD.PAY_NO           = TRDT.PAY_NO 
		INNER JOIN ICOYPODT PODT ON TRDT.HOUSE_CODE  = PODT.HOUSE_CODE AND TRDT.PO_NO            = PODT.PO_NO       AND TRDT.PO_SEQ = PODT.PO_SEQ
		INNER JOIN ICOMOGIL OGIL ON PODT.HOUSE_CODE  = OGIL.HOUSE_CODE AND PODT.DELY_TO_LOCATION = OGIL.DEPT
		INNER JOIN ICOYTXHD TXHD ON TRDT.HOUSE_CODE  = TXHD.HOUSE_CODE AND TRDT.TAX_NO           = TXHD.TAX_NO
		INNER JOIN ICOYTXDT TXDT ON TRDT.HOUSE_CODE  = TXDT.HOUSE_CODE AND TRDT.TAX_NO           = TXDT.TAX_NO      AND TRDT.TAX_SEQ = TXDT.TAX_SEQ
		INNER JOIN ICOMMTGL MTGL ON TRDT.HOUSE_CODE  = MTGL.HOUSE_CODE AND TRDT.ITEM_NO          = MTGL.ITEM_NO
		INNER JOIN ICOMVNGL VNGL ON TRHD.HOUSE_CODE  = VNGL.HOUSE_CODE AND TRHD.VENDOR_CODE      = VNGL.VENDOR_CODE
		WHERE 
			MTGL.MATERIAL_TYPE IN ('02','04')
		AND
			TRHD.HOUSE_CODE  = ${HOUSE_CODE}
		AND
			(TXHD.TAX_NO, TXDT.TAX_SEQ ) IN (SELECT TAX_NO, TAX_SEQ FROM SPY1LN WHERE PAY_SEND_NO = ${PAY_SEND_NO})
	</method>
	
	<method name="selectSumDelyAmt2">
		SELECT
			SUM(TRDT.DELY_AMT) AS AMT
		FROM
			ICOYTRHD TRHD
		INNER JOIN ICOYTRDT TRDT ON TRHD.HOUSE_CODE  = TRDT.HOUSE_CODE AND TRHD.PAY_NO           = TRDT.PAY_NO 
		INNER JOIN ICOYPODT PODT ON TRDT.HOUSE_CODE  = PODT.HOUSE_CODE AND TRDT.PO_NO            = PODT.PO_NO       AND TRDT.PO_SEQ = PODT.PO_SEQ
		INNER JOIN ICOMOGIL OGIL ON PODT.HOUSE_CODE  = OGIL.HOUSE_CODE AND PODT.DELY_TO_LOCATION = OGIL.DEPT
		INNER JOIN ICOYTXHD TXHD ON TRDT.HOUSE_CODE  = TXHD.HOUSE_CODE AND TRDT.TAX_NO           = TXHD.TAX_NO
		INNER JOIN ICOYTXDT TXDT ON TRDT.HOUSE_CODE  = TXDT.HOUSE_CODE AND TRDT.TAX_NO           = TXDT.TAX_NO      AND TRDT.TAX_SEQ = TXDT.TAX_SEQ
		INNER JOIN ICOMMTGL MTGL ON TRDT.HOUSE_CODE  = MTGL.HOUSE_CODE AND TRDT.ITEM_NO          = MTGL.ITEM_NO
		INNER JOIN ICOMVNGL VNGL ON TRHD.HOUSE_CODE  = VNGL.HOUSE_CODE AND TRHD.VENDOR_CODE      = VNGL.VENDOR_CODE
		WHERE 
			MTGL.MATERIAL_TYPE IN ('02','04')
		AND
			TRHD.HOUSE_CODE  = ${HOUSE_CODE}
		AND
			(TXHD.TAX_NO, TXDT.TAX_SEQ ) IN (SELECT TAX_NO, TAX_SEQ FROM SPY1LN WHERE PAY_SEND_NO = ${PAY_SEND_NO})
	</method>
	
	<!--  세금계산서 현황 -->
	<method name="et_getPayList2">
		SELECT
			TXHD.TAX_NO, 
			TXDT.TAX_SEQ, 
			
			--PRDT.DEMAND_DEPT                                                          AS DELY_TO_LOCATION,
            --GETDEPTNAME(PRDT.HOUSE_CODE, PRDT.COMPANY_CODE, PRDT.DEMAND_DEPT, 'LOC' ) AS DELY_TO_LOCATION_NM,
     		--OGIL.ILGAE_CD AS IGJM_CD,
			
     		(SELECT MAX(JUMJUJMCD) FROM SPY1LN 
		      WHERE PAY_SEND_NO = ${pay_send_no}
		        AND HOUSE_CODE = TXDT.HOUSE_CODE 
		        AND TAX_NO = TXDT.TAX_NO 
		        AND TAX_SEQ = TXDT.TAX_SEQ
		    GROUP BY TAX_NO,TAX_SEQ) AS DELY_TO_LOCATION,
		        		       
		    (SELECT DEPT_NAME_LOC
		       FROM ICOMOGDP 
		      WHERE (HOUSE_CODE,DEPT) IN (SELECT MAX(HOUSE_CODE),MAX(JUMJUJMCD) FROM SPY1LN
									       WHERE PAY_SEND_NO = ${pay_send_no} 
									         AND HOUSE_CODE = TXDT.HOUSE_CODE 
									         AND TAX_NO = TXDT.TAX_NO 
									         AND TAX_SEQ = TXDT.TAX_SEQ									         
									      GROUP BY TAX_NO,TAX_SEQ)) AS DELY_TO_LOCATION_NM, 
									         
            (SELECT MAX(IGJMCD) FROM SPY1LN 
		      WHERE PAY_SEND_NO = ${pay_send_no}
		        AND HOUSE_CODE = TXDT.HOUSE_CODE 
		        AND TAX_NO = TXDT.TAX_NO 
		        AND TAX_SEQ = TXDT.TAX_SEQ
		     GROUP BY TAX_NO,TAX_SEQ) AS IGJM_CD,									         
		    
		    '' AS ACCOUNT_CODE,
			'' AS ACCOUNT_NM,
			MTGL.ACCOUNT_CODE AS ACCOUNT_CODE,
			MTGL.ACCOUNT_NM AS ACCOUNT_NM,
			TRDT.ITEM_NO AS ITEM_NO,
			MTGL.DESCRIPTION_LOC AS ITEM_NM,
			PODT.SPECIFICATION AS SPECIFICATION,
			TRDT.ITEM_QTY AS QTY,
			TRDT.DELY_UNIT_PRICE AS UNIT_PRICE,
			TRDT.DELY_AMT AS AMT,
			TRHD.VENDOR_CODE,
			VNGL.VENDOR_NAME_LOC AS VENDOR_NAME,
			MTGL.MODEL_NO,
			MTGL.MATERIAL_TYPE
		FROM
			ICOYTRHD TRHD
		INNER JOIN ICOYTRDT TRDT ON TRHD.HOUSE_CODE = TRDT.HOUSE_CODE AND TRHD.PAY_NO      = TRDT.PAY_NO 
		INNER JOIN ICOYPODT PODT ON TRDT.HOUSE_CODE = PODT.HOUSE_CODE AND TRDT.PO_NO       = PODT.PO_NO       AND TRDT.PO_SEQ = PODT.PO_SEQ
		INNER JOIN ICOYPRHD PRHD ON PODT.HOUSE_CODE = PRHD.HOUSE_CODE AND PODT.PR_NO       = PRHD.PR_NO
		
		INNER JOIN ICOYPRDT PRDT ON PRHD.HOUSE_CODE = PRDT.HOUSE_CODE AND PRHD.PR_NO       = PRDT.PR_NO
                                                           AND PODT.PR_NO       = PRDT.PR_NO   AND PODT.PR_SEQ  = PRDT.PR_SEQ                
		--INNER JOIN ICOMOGIL OGIL ON PRDT.HOUSE_CODE = OGIL.HOUSE_CODE AND PRDT.DEMAND_DEPT = OGIL.DEPT
		
		INNER JOIN ICOYTXHD TXHD ON TRDT.HOUSE_CODE = TXHD.HOUSE_CODE AND TRDT.TAX_NO      = TXHD.TAX_NO
		INNER JOIN ICOYTXDT TXDT ON TRDT.HOUSE_CODE = TXDT.HOUSE_CODE AND TRDT.TAX_NO      = TXDT.TAX_NO      AND TRDT.TAX_SEQ = TXDT.TAX_SEQ
		INNER JOIN ICOMMTGL MTGL ON TRDT.HOUSE_CODE = MTGL.HOUSE_CODE AND TRDT.ITEM_NO     = MTGL.ITEM_NO
		INNER JOIN ICOMVNGL VNGL ON TRHD.HOUSE_CODE = VNGL.HOUSE_CODE AND TRHD.VENDOR_CODE = VNGL.VENDOR_CODE
		
		
		WHERE 
			MTGL.MATERIAL_TYPE IN ('02','04')
		AND
			(TXHD.TAX_NO, TXDT.TAX_SEQ ) IN (SELECT TAX_NO, TAX_SEQ FROM SPY1LN WHERE PAY_SEND_NO = ${pay_send_no})
		AND
			TXHD.PROGRESS_CODE IN ('P','E')  
	    ORDER BY
			TRHD.ADD_DATE DESC,
			TXHD.TAX_NO DESC
	</method>
	
	<method name="selectSpy1gl">
		SELECT GL.HOUSE_CODE
	          ,GL.PAY_SEND_NO
		      ,GL.VENDOR_CODE
		      ,GL.DEPOSITOR_NAME
		      ,GL.BANK_CODE
		      ,GL.BANK_ACCT
		      ,GL.PAY_AMT
		      ,GL.SIGNER_FLAG
		      ,GL.SIGNER_NO
		      ,GL.SIGNER_BIO
		      ,GL.WORK_KIND     
		      ,GL.BMSBMSYY
		      ,GETDEPTNAMELOC(GL.HOUSE_CODE,'WOORI',GL.SOGSOGCD) SOGSOGCD
		      ,GETCODETEXT1('M800',GL.ASTASTGB,'KO') ASTASTGB
		      ,GETCODETEXT1('M801',GL.MNGMNGNO,'KO') MNGMNGNO  
		      ,GETCODETEXT1('M802',GL.BSSBSSNO,'KO') BSSBSSNO
		      ,GL.APPAPPYY
		      ,GL.BMSSRLNO
		      ,GL.APPAPPNO
		      ,GL.APPAPPAM
		      ,GL.ACCOUNTKIND
		      ,GETCODETEXT1('M803',GL.DEAL_KIND,'KO') DEAL_KIND
		      ,GL.JUMJUM_CD
              ,GETDEPTNAMELOC(GL.HOUSE_CODE,'WOORI',GL.JUMJUM_CD) JUMJUM_NM
              ,GL.BDSBDSCD
              ,GL.BDSBDSNM
              ,GL.DEAL_AREA
              ,GETCODETEXT1('M804',GL.USE_KIND,'KO') USE_KIND
              ,GL.DEAL_DEBT
	     FROM SPY1GL GL
	    WHERE GL.PAY_SEND_NO = ${PAY_SEND_NO}
	</method>
	
	<method name="et_getSpy2glSpy1ln">	
		SELECT	 TAX_NO      AS TAX_NO
                ,PAY_ACT_NO  AS PAY_ACT_NO
        FROM 	SPY2GL
        WHERE 	1 = 1
        AND TAX_NO IN (SELECT DISTINCT TAX_NO FROM ICOYTRDT
                        WHERE INV_NO||INV_SEQ IN ('#inv_data1#'))    
        UNION ALL		
        SELECT   B.TAX_NO      AS TAX_NO
                ,B.PAY_SEND_NO AS PAY_ACT_NO
        FROM    SPY1GL A ,SPY1LN B  
        WHERE 	A.PAY_SEND_NO = B.PAY_SEND_NO
         <![CDATA[
         AND A.DEL_YN <> 'Y'
         ]]> 
         AND B.TAX_NO IN (SELECT DISTINCT TAX_NO FROM ICOYTRDT
                          WHERE INV_NO||INV_SEQ IN ('#inv_data2#'))    
	</method>
	
	<method name="et_getTaxTotal">	
		SELECT SUM(TAX_TOTAL) AS TAX_TOTAL FROM ICOYTRHD 
		WHERE STATUS IN ('C','R') 
		AND PAY_NO IN (SELECT PAY_NO 
		                 FROM ICOYTRDT 
		                WHERE STATUS IN ('C','R') 
		                  AND TAX_NO IN (SELECT DISTINCT TAX_NO FROM ICOYTRDT
		                                  WHERE INV_NO||INV_SEQ IN ('#inv_data#')))
	</method>
</service>