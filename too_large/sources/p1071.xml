<?xml version="1.0" encoding="UTF-8"?>
<service>
	<method name="getQuery_RFQNO">
	<![CDATA[
			 SELECT A.RFQ_NO,	A.RFQ_COUNT, A.SUBJECT                                                  
			 FROM (SELECT RH.HOUSE_CODE, RH.RFQ_NO,	RH.RFQ_COUNT, MAX(RH.SUBJECT) SUBJECT,                           
					      COUNT(*) AS CNT,                                                   
					      SUM(CASE SETTLE_FLAG WHEN 'N' THEN	1 ELSE 0 END) AS N_COUNT     
					FROM ICOYRQDT RD, ICOYRQHD	RH                                           
				WHERE RD.STATUS	IN ('C','R')                                                 
				<OPT=S,S>  AND RH.CTRL_CODE IN (?) </OPT>                                       
				  AND RH.RFQ_TYPE IN ('MA',	'MI', 'SI')                                      
				  AND (RH.RFQ_FLAG	= 'P' OR RH.RFQ_FLAG = 'B' OR RH.RFQ_FLAG = 'C')                                                    
				  AND RH.BID_TYPE	= 'RQ'	                                                 
				  AND RD.HOUSE_CODE	= RH.HOUSE_CODE                                          
				  AND RD.RFQ_NO		= RH.RFQ_NO                                              
				  AND RD.RFQ_COUNT	= RH.RFQ_COUNT                                           
				<OPT=F,S>  AND RH.HOUSE_CODE	= ? </OPT>                                         
				  AND RH.STATUS	IN ('C','R')                                                 
				  AND RH.SIGN_STATUS = 'E'                                                   
				  GROUP	BY RH.HOUSE_CODE, RH.RFQ_NO, RH.RFQ_COUNT) A                         
			 WHERE A.CNT	= A.N_COUNT  
			 ORDER BY RFQ_NO DESC                                                    
	]]>
	</method>
	

	
	<method name="getRfqHistory">
	
	<![CDATA[
			 SELECT DISTINCT  RQHD.RFQ_NO,                                                             
	               RQHD.RFQ_COUNT,                                                            
	               RQHD.SUBJECT,                                                              
	               RQSE.VENDOR_CODE,                                                          
	               GETCOMPANYNAMELOC(RQSE.HOUSE_CODE,RQSE.VENDOR_CODE,'S') AS VENDOR_NAME,    
	               CASE RQSE.BID_FLAG WHEN 'N' THEN '견적포기' ELSE QTHD.QTA_NO END AS QTA_NO,  
	               QTHD.CHANGE_DATE,                                                          	
	               TO_CHAR(TO_DATE( RQHD.RFQ_CLOSE_DATE || RQHD.RFQ_CLOSE_TIME , 'YYYY/MM/DD HH24:MI:SS'), 'YYYY/MM/DD HH24:MI:SS') AS CLOSE_DATE, 
	               RQHD.CHANGE_USER_ID,                                                       
	               Getusernameloc(RQSE.HOUSE_CODE,RQHD.CHANGE_USER_ID ) AS  CHANGE_USER_NAME,                          
	               RQSE.CONFIRM_DATE,                                                         
	               RQHD.CTRL_CODE,                                                            
	               RQHD.RFQ_CLOSE_DATE || RQHD.RFQ_CLOSE_TIME AS CLOSE_DATA,                     
	        	   CONVERT_DATE(QTHD.QTA_VAL_DATE) AS QTA_VAL_DATE              											
	         FROM                                                                             
	         	ICOYRQHD RQHD                                                                 
	         	,ICOYRQSE RQSE LEFT OUTER JOIN                                                
	         	ICOYQTHD QTHD                                                                
	           ON RQSE.HOUSE_CODE = QTHD.HOUSE_CODE                                        
	           AND RQSE.VENDOR_CODE = QTHD.VENDOR_CODE                                     
	           AND RQSE.RFQ_NO = QTHD.RFQ_NO                                               
	           AND RQSE.RFQ_COUNT = QTHD.RFQ_COUNT                                          
	           WHERE RQHD.HOUSE_CODE = ${session.HOUSE_CODE}                       
	           AND RQHD.HOUSE_CODE = RQSE.HOUSE_CODE                                          
	           AND RQHD.RFQ_NO = RQSE.RFQ_NO                                                  
	           AND RQHD.RFQ_COUNT = RQSE.RFQ_COUNT                                            
	                                                                                          
	           AND RQHD.RFQ_CLOSE_DATE BETWEEN $S{start_rfq_date} 	                           
	           AND $S{end_rfq_date}                            	                          
	           AND RQHD.ADD_USER_ID LIKE $S{session_user_id}                         
	           AND QTHD.VENDOR_CODE LIKE $S{vendor_code}                           
	           AND RQHD.RFQ_NO LIKE $S{rfq_no}                         
	           AND RQHD.SUBJECT LIKE '%' || $S{subject} || '%'                        
	           AND RQHD.BID_TYPE = 'RQ'                                                      
	           AND RQSE.BID_FLAG is not null                                  				  
	           AND RQHD.BID_RFQ_TYPE = $S{bid_rfq_type}                             
	           AND RQHD.STATUS IN ('C','R')                                                   
	           AND RQSE.STATUS IN ('C','R')         
	           AND QTHD.SEND_FLAG = 'Y' 
	        ]]>
	        <if test="${RFQ_FLAG}" operator="eq" value="1">
	        	AND RQHD.RFQ_FLAG IN ('P','C')                                                        
	        </if>
	        <if test="${RFQ_FLAG}" operator="eq" value="2">
	        	AND RQHD.RFQ_FLAG = 'P'                                                        
	        </if>
	        <if test="${RFQ_FLAG}" operator="eq" value="3">
	        	AND RQHD.RFQ_FLAG = 'C'                                                        
	        </if>
	           
	        <![CDATA[                                             
	         ORDER BY RQHD.RFQ_NO DESC 														  
	         		, RQHD.RFQ_COUNT DESC 													  
	         		, RQSE.VENDOR_CODE 		
	         		
    		]]>												  
	</method>


	<method name="et_getQtaDispDT">
	
	<![CDATA[
		   SELECT                                                                                                                              
	                    PD.ITEM_NO,                                                          
	            		PD.SPECIFICATION,                            
	             		PD.DESCRIPTION_LOC,      
	             		
	                    RD.RFQ_QTY                                           AS RFQ_QTY,                                                         
	                    NVL(QD.ITEM_QTY,RD.RFQ_QTY)                          AS ITEM_QTY,                                                        
	                    NVL(QD.VENDOR_ITEM_NO,'')                            AS VENDOR_ITEM_NO,                                                  
	                    NVL(QD.UNIT_MEASURE,RD.UNIT_MEASURE)                 AS UNIT_MEASURE,                                                    
	                    NVL(QD.CUSTOMER_PRICE,'')                            AS CUSTOMER_PRICE,                                                      
	                    NVL(QD.UNIT_PRICE,'')                                AS UNIT_PRICE,                                                      
	                    NVL(QD.UNIT_PRICE,'')                                AS SUPPLY_PRICE,                                                      
	                    NVL(QD.DISCOUNT,'')                                  AS DISCOUNT,                                                      
	            
	                   (CASE                                                                                                                          
	                         WHEN RH.PRICE_TYPE = 'N' THEN 'N'                                                                                            
	                         ELSE RH.PRICE_TYPE                                                                                                       
	                    END                                                                                                                           
	                    )                                                         AS UNIT_PRICE_IMG,                                                  
	            
	            
	                    GETBEFOREQTADATA(RD.HOUSE_CODE, RD.RFQ_NO, RH.RFQ_COUNT, RD.RFQ_SEQ, RS.VENDOR_CODE, 'UNIT_PRICE')  AS BEFORE_PRICE,          
	                    QD.ITEM_AMT                                               AS ITEM_AMT,                                                        
	                    CONVERT_DATE(NVL(QD.DELIVERY_LT,''))                               AS DELIVERY_LT,                                                     
	                    CONVERT_DATE(RD.RD_DATE)                                                AS RD_DATE,                                                         
	                   (CASE                                                                                                                          
	                         WHEN RD.STR_FLAG = 'S' THEN ''   
	                         WHEN RD.STR_FLAG = 'D' THEN GETDEPTNAME(RD.HOUSE_CODE, RD.COMPANY_CODE, RD.DELY_TO_LOCATION, 'LOC' )                     
	                         ELSE RD.DELY_TO_LOCATION                                                                                                 
	                    END                                                                                                                           
	                    )                                                         AS DELY_TO_LOCATION_NAME,                                           
	                    NVL(RD.YEAR_QTY,'')                                  AS YEAR_QTY,                                                        
	                   (CASE                                                                                                                          
	             		   WHEN NVL(QD.ATTACH_NO,'N') = 'N' THEN 'N'                                                                             
	             		   ELSE QD.ATTACH_NO                                                                                                          
	                    END                                                                                                                           
	                    )                                                          AS QTA_ATTACH_NO,                                                  
	                   (CASE                                                                                                                          
	             		   WHEN NVL(QD.ATTACH_NO,'N') = 'N' THEN '0'                                                                             
	             		   ELSE (SELECT COUNT(*) || '' FROM ICOMATCH WHERE DOC_NO = QD.ATTACH_NO)                                                  
	                    END                                                                                                                           
	                    )                                                          AS QTA_ATTACH_CNT,                                                 
	                   (CASE                                                                                                                          
	             		   WHEN NVL(RD.ATTACH_NO,'N') = 'N' THEN 'N'                                                                             
	             		   ELSE RD.ATTACH_NO                                                                                                          
	                    END                                                                                                                           
	                    )                                                          AS RFQ_ATTACH_NO,                                                  
	                   (CASE                                                                                                                          
	             		   WHEN NVL(RD.ATTACH_NO,'N') = 'N' THEN '0'                                                                             
	             		   ELSE (SELECT COUNT(*) || '' FROM ICOMATCH WHERE DOC_NO = RD.ATTACH_NO)                                                  
	                    END                                                                                                                           
	                    )                                                     AS RFQ_ATTACH_CNT,                                                      
	                    GETUSERNAME(RD.HOUSE_CODE, RD.CHANGE_USER_ID, 'LOC')  AS PURCHASER,                                                           
	                    GETADDRATTR(RD.HOUSE_CODE, RD.CHANGE_USER_ID, '3', 'PHONE_NO1') AS PURCHASER_PHONE,                                           
	                    RD.SHIPPER_TYPE                                       AS SHIPPER_TYPE,                                                        
	                    NVL(QD.MOLDING_CHARGE,'')                        AS MOLDING_CHARGE,                                                      
	                    RD.COST_COUNT                                         AS COST_COUNT,                                                          
	                    QD.MOLDING_FLAG                                       AS MOLDING_FLAG,                                                        
	                    GETRQEPDATADISP(QD.HOUSE_CODE, QD.QTA_NO, QD.QTA_SEQ, QD.VENDOR_CODE, 'F_DATE')  AS EP_FROM_DATE,                             
	                    GETRQEPDATADISP(QD.HOUSE_CODE, QD.QTA_NO, QD.QTA_SEQ, QD.VENDOR_CODE, 'T_DATE')  AS EP_TO_DATE,                               
	                    GETRQEPDATADISP(QD.HOUSE_CODE, QD.QTA_NO, QD.QTA_SEQ, QD.VENDOR_CODE, 'F_QTY')  AS EP_FROM_QTY,                               
	                    GETRQEPDATADISP(QD.HOUSE_CODE, QD.QTA_NO, QD.QTA_SEQ, QD.VENDOR_CODE, 'T_QTY')  AS EP_TO_QTY,                                 
	                    GETRQEPDATADISP(QD.HOUSE_CODE, QD.QTA_NO, QD.QTA_SEQ, QD.VENDOR_CODE, 'UNIT_PRICE')  AS EP_UNIT_PRICE,                        
	                    case NVL(QD.QTA_NO,'') when '' then '' else QD.QTA_NO end        AS QTA_NO,                                                              
	                    case NVL(QD.QTA_SEQ,'') when '' then '' else QD.QTA_SEQ end     AS QTA_SEQ,                                                             
	                    ''			                                          AS MAKER_CODE,                                                          
	                    PD.MAKER_NAME                                         AS MAKER_NAME,                                                          
	                    RD.RFQ_NO                                             AS RFQ_NO,                                                              
	                    RD.RFQ_COUNT                                          AS RFQ_COUNT,                                                           
	                    RD.RFQ_SEQ                                            AS RFQ_SEQ ,                                                            
	                    QD.QTA_SEQ                                            AS QTA_SEQ  ,                                                                        
	                    QD.MOLDING_QTY                                        AS MOLDING_PROSPECTIVE_QTY,                                      	            
	                    PD.Z_CODE1                                                    AS Z_CODE1 ,                             		
	                    PD.WBS_NAME                                                   AS Z_CODE1_NAME ,
				        QD.TECHNIQUE_GRADE	                                          AS TECHNIQUE_GRADE	 ,                                      	
	        	        RD.TECHNIQUE_FLAG 	                                          AS TECHNIQUE_FLAG 	 ,                                     	
	        	        RD.TECHNIQUE_TYPE 	                                          AS TECHNIQUE_TYPE 	 ,                                     	
	        	        QD.INPUT_FROM_DATE	                                          AS INPUT_FROM_DATE	 ,                                      	
	        	        QD.INPUT_TO_DATE 	                                          AS INPUT_TO_DATE	 ,                                         	
	        	    	HUNT.COMPANY_CODE AS HUMAN_COMPANY_CODE,
               			HUNT.VENDOR_CODE AS HUMAN_VENDOR_CODE,   
               			HUNT.HUMAN_NO AS HUMAN_NO ,                                           
               			HUNT.NAME_LOC AS HUMAN_NAME_LOC 
						,PD.REC_VENDOR_NAME    	
						,QD.REMARK  	
						,RD.CUR
						,QD.RATE
      					,QD.SEC_VENDOR_CODE
      					,GETVENDORNAME(QD.HOUSE_CODE,QD.SEC_VENDOR_CODE) AS SEC_VENDOR_CODE_TEXT
	              FROM  ICOYRQDT RD, ICOYPRDT PD, ICOYQTDT QD, ICOYRQSE RS, ICOYRQHD RH, ICOYQTHD QH, ICOYPRHD PH, ICOMHUMT HUNT                                    
	              WHERE RH.STATUS  IN ('C', 'R')                                                                                                     
	                AND QH.HOUSE_CODE   = ${session.HOUSE_CODE}                                                                                            
	                AND QH.QTA_NO       = $S{qta_no}                                                                                            
	                AND QH.VENDOR_CODE  = $S{vendor_code}                                                                                            
	                AND RS.VENDOR_CODE  = $S{vendor_code}                                                                                            
	              AND QH.HOUSE_CODE   = RH.HOUSE_CODE                                                                                                 
	              AND QH.RFQ_NO       = RH.RFQ_NO                                                                                                     
	              AND QH.RFQ_COUNT    = RH.RFQ_COUNT                                                                                                  
	              AND QH.RFQ_COUNT    = RH.RFQ_COUNT                                                                                                  
	              AND RD.HOUSE_CODE   = RS.HOUSE_CODE                                                                                                 
	              AND RH.HOUSE_CODE   = RD.HOUSE_CODE                                                                                                 
	              AND RD.RFQ_NO       = RS.RFQ_NO                                                                                                     
	              AND RH.RFQ_NO       = RD.RFQ_NO                                                                                                     
	              AND RD.RFQ_COUNT    = RS.RFQ_COUNT                                                                                                  
	              AND RH.RFQ_COUNT    = RD.RFQ_COUNT                                                                                                  
	              AND RD.RFQ_SEQ      = RS.RFQ_SEQ                                                                                                    
	              AND RD.HOUSE_CODE   = PD.HOUSE_CODE                                                                                                 
	              AND RD.PR_NO        = PD.PR_NO                                                                                                      
	              AND RD.PR_SEQ       = PD.PR_SEQ                                                                                                     
	              AND RS.HOUSE_CODE   = QD.HOUSE_CODE                                                                                                 
	              AND RS.RFQ_NO       = QD.RFQ_NO                                                                                                     
	              AND RS.RFQ_COUNT    = QD.RFQ_COUNT                                                                                                  
	              AND RS.RFQ_SEQ      = QD.RFQ_SEQ                                                                                                    
	              AND RS.VENDOR_CODE  = QD.VENDOR_CODE                                                                                                
	              AND PH.HOUSE_CODE   = PD.HOUSE_CODE                                                                                                 
	              AND PH.PR_NO        = PD.PR_NO
	              AND QD.HOUSE_CODE   = HUNT.HOUSE_CODE (+)
               	  AND QD.HUMAN_NO     = HUNT.HUMAN_NO (+) 
	              AND QD.STATUS <> 'D'                                                                                                                	                                                                                                         
	              AND NVL(LTRIM(RTRIM(RS.BID_FLAG)), 'Y') <> 'N'                                                                                         
	              AND RS.STATUS  IN ('C', 'R')                                                                                                        
	              AND RD.STATUS  IN ('C', 'R')  
	            
	            ]]>
	</method>

	<method name="et_getRfqEP_qta">
		<![CDATA[
    		SELECT COST_PRICE_NAME,	                
    			   COST_PRICE_VALUE,                
    			   COST_SEQ	                        
    		  FROM ICOYRQEP	                        
    		 WHERE STATUS IN ('C', 'R')             
    		 <OPT=F,S>  AND HOUSE_CODE  = ? </OPT>  
    		 <OPT=S,S>  AND RFQ_NO      = ? </OPT>  
    		 <OPT=S,N>  AND RFQ_COUNT   = ? </OPT>  
    		 <OPT=S,S>  AND RFQ_SEQ     = ? </OPT>  
     		 <OPT=S,S>  AND VENDOR_CODE = ? </OPT>  
		]]>
	</method>
	
	<method name="getQuery_Upd_Qta_Detail_Qta">
		<if test="${GROUP_YN}" operator="eq" value="Y">
            	 SELECT
            	  ITEM_NO
            	 ,MAX(MATERIAL_CTRL_TYPE) AS MATERIAL_CTRL_TYPE
            	 ,ITEM_GBN
            	 ,SPECIFICATION           SPECIFICATION
            	 ,DESCRIPTION_LOC       DESCRIPTION_LOC
            	 ,SUM(RFQ_QTY                ) RFQ_QTY
            	 ,SUM(ITEM_QTY               ) ITEM_QTY
            	 ,MAX(VENDOR_ITEM_NO         ) VENDOR_ITEM_NO
            	 ,MAX(UNIT_MEASURE           ) UNIT_MEASURE
            	 ,MAX(CUSTOMER_PRICE         ) CUSTOMER_PRICE
            	 ,MAX(UNIT_PRICE             ) UNIT_PRICE
            	 ,MAX(SUPPLY_PRICE           ) SYPPLY_PRICE
            	 ,MAX(UNIT_PRICE_IMG         ) UNIT_PRICE_IMG
            	 ,MAX(BEFORE_PRICE           ) BEFORE_PRICE
            	 ,SUM(ITEM_AMT               ) ITEM_AMT
            	 ,SUM(SUPPLY_AMT             ) SUPPLY_AMT
            	 ,MAX(DELIVERY_LT            ) DELIVERY_LT
            	 ,MAX(RD_DATE                ) RD_DATE
            	 ,MAX(DELY_TO_LOCATION_NAME  ) DELY_TO_LOCATION_NAME
            	 ,MAX(YEAR_QTY               ) YEAR_QTY
            	 ,MAX(QTA_ATTACH_NO          ) QTA_ATTACH_NO
            	 ,MAX(QTA_ATTACH_CNT         ) QTA_ATTACH_CNT
            	 ,MAX(RFQ_ATTACH_NO          ) RFQ_ATTACH_NO
            	 ,MAX(RFQ_ATTACH_CNT         ) RFQ_ATTACH_CNT
            	 ,MAX(PURCHASER              ) PURCHASER
            	 ,MAX(PURCHASER_PHONE        ) PURCHASER_PHONE
            	 ,MAX(SHIPPER_TYPE           ) SHIPPER_TYPE
            	 ,MAX(MOLDING_CHARGE         ) MOLDING_CHARGE
            	 ,MAX(COST_COUNT             ) COST_COUNT
            	 ,MAX(MOLDING_FLAG           ) MOLDING_FLAG
            	 ,MAX(EP_FROM_DATE           ) EP_FROM_DATE
            	 ,MAX(EP_TO_DATE             ) EP_TO_DATE
            	 ,MAX(EP_FROM_QTY            ) EP_FROM_QTY
            	 ,MAX(EP_TO_QTY              ) EP_TO_QTY
            	 ,MAX(EP_UNIT_PRICE          ) EP_UNIT_PRICE
            	 ,MAX(QTA_NO                 ) QTA_NO
            	 ,MAX(QTA_SEQ                ) QTA_SEQ
            	 ,MAX(MAKER_CODE             ) MAKER_CODE
            	 ,MAX(MAKER_NAME             ) MAKER_NAME
            	 ,MAX(DELY_TO_LOCATION       ) DELY_TO_LOCATION
           		 ,MAX(RFQ_NO                 ) RFQ_NO
            	 ,MAX(RFQ_COUNT              ) RFQ_COUNT
            	 ,MAX(RFQ_SEQ                ) RFQ_SEQ
            	 ,MAX(MOLDING_PROSPECTIVE_QTY) MOLDING_PROSPECTIVE_QTY
            	 ,MAX(CUR) CUR
            	 ,MAX(CUSTOMER_PRICE) CUSTOMER_PRICE
            	 ,MAX(TECHNIQUE_GRADE)	 TECHNIQUE_GRADE
            	 ,MAX(TECHNIQUE_FLAG) 	 TECHNIQUE_FLAG
            	 ,MAX(TECHNIQUE_TYPE) 	 TECHNIQUE_TYPE
            	 ,MAX(INPUT_FROM_DATE)	 INPUT_FROM_DATE
            	 ,MAX(INPUT_TO_DATE )	 INPUT_TO_DATE
				 ,MAX(REMARK )	 REMARK
	             ,MAX(HUMAN_NAME_LOC       )  HUMAN_NAME_LOC
	             ,MAX(DISCOUNT) DISCOUNT
				 ,MAX(CONTRACT_DIV) CONTRACT_DIV
            	 FROM (
            </if>
            <![CDATA[
              SELECT NVL(QD.ITEM_NO,RD.ITEM_NO) AS ITEM_NO,
              		(SELECT MATERIAL_CTRL_TYPE FROM ICOMMTGL WHERE ITEM_NO = RD.ITEM_NO AND ROWNUM = 1) AS MATERIAL_CTRL_TYPE,
	            	 NVL (DECODE ((SELECT KTGRM FROM ICOMMTGL WHERE HOUSE_CODE = RD.HOUSE_CODE AND ITEM_NO = RD.ITEM_NO),'01','I','02','S'),'I') AS ITEM_GBN, -- 01 : 상품, 02 : 용역
             		 CASE WHEN RD.ITEM_NO IS NULL THEN
			 				(SELECT DESCRIPTION_LOC FROM ICOYPRDT
			 		 		  WHERE HOUSE_CODE = RD.HOUSE_CODE
			 		 		  AND PR_NO = RD.PR_NO AND PR_SEQ = RD.PR_SEQ )
			 		  ELSE (SELECT DESCRIPTION_LOC FROM ICOMMTGL
			 		 		  WHERE HOUSE_CODE = RD.HOUSE_CODE
			 		 		  AND   ITEM_NO    = RD.ITEM_NO) END AS DESCRIPTION_LOC,
            		RD.SPECIFICATION AS SPECIFICATION,
                    RD.RFQ_QTY                                                AS RFQ_QTY,
                    NVL(QD.ITEM_QTY,RD.RFQ_QTY)                          AS ITEM_QTY,
                    NVL(QD.VENDOR_ITEM_NO,'')                            AS VENDOR_ITEM_NO,
                    NVL(QD.UNIT_MEASURE,RD.UNIT_MEASURE)                 AS UNIT_MEASURE,
                    NVL(QD.CUSTOMER_PRICE,'')                            AS CUSTOMER_PRICE,
                    NVL(QD.UNIT_PRICE,'')                                AS UNIT_PRICE,
                    NVL(QD.UNIT_PRICE,'')                                AS SUPPLY_PRICE,
                   (CASE
             		   WHEN NVL(RH.PRICE_TYPE,'N') = 'N' THEN 'N'
             		   ELSE RH.PRICE_TYPE
                    END
                    )                                                          AS UNIT_PRICE_IMG,
                    GETBEFOREQTADATA(RD.HOUSE_CODE, RD.RFQ_NO, RH.RFQ_COUNT, RD.RFQ_SEQ, RS.VENDOR_CODE, 'UNIT_PRICE')  AS BEFORE_PRICE,
                    QD.ITEM_AMT                                               AS ITEM_AMT,
                    QD.ITEM_AMT                                               AS SUPPLY_AMT,
                    CONVERT_DATE(NVL(QD.DELIVERY_LT,''))                               AS DELIVERY_LT,
                    CONVERT_DATE(RD.RD_DATE)                                                AS RD_DATE,
                   (CASE
                         WHEN RD.STR_FLAG = 'S' THEN '' --GETSTORAGENAME(RD.HOUSE_CODE, RD.COMPANY_CODE, RD.PLANT_CODE, RD.DELY_TO_LOCATION, 'LOC' )
                         WHEN RD.STR_FLAG = 'D' THEN GETDEPTNAME(RD.HOUSE_CODE, RD.COMPANY_CODE, RD.DELY_TO_LOCATION, 'LOC' )
                         ELSE RD.DELY_TO_LOCATION
                    END
                    )                                                         AS DELY_TO_LOCATION_NAME,
                    NVL(RD.YEAR_QTY,'')                                  AS YEAR_QTY,
                   (CASE
             		   WHEN NVL(QD.ATTACH_NO,'N') = 'N' THEN 'N'
             		   ELSE QD.ATTACH_NO
                    END
                    )                                                          AS QTA_ATTACH_NO,
                   (CASE
             		   WHEN NVL(QD.ATTACH_NO,'N') = 'N' THEN '0'
             		   ELSE (SELECT COUNT(*) FROM ICOMATCH WHERE DOC_NO = QD.ATTACH_NO) || ''
                    END
                    )                                                          AS QTA_ATTACH_CNT,
                   (CASE
             		   WHEN NVL(RD.ATTACH_NO,'N') = 'N' THEN 'N'
             		   ELSE RD.ATTACH_NO
                    END
                    )                                                          AS RFQ_ATTACH_NO,
                   (CASE
             		   WHEN NVL(RD.ATTACH_NO,'N') = 'N' THEN '0'
             		   ELSE (SELECT COUNT(*) FROM ICOMATCH WHERE DOC_NO = RD.ATTACH_NO) || ''
                    END
                    )                                                     AS RFQ_ATTACH_CNT,
                    GETUSERNAME(RD.HOUSE_CODE, RD.CHANGE_USER_ID, 'LOC')  AS PURCHASER,
                    GETADDRATTR(RD.HOUSE_CODE, RD.CHANGE_USER_ID, '3', 'PHONE_NO1') AS PURCHASER_PHONE,
                    RD.SHIPPER_TYPE                                       AS SHIPPER_TYPE,
                    NVL(QD.MOLDING_CHARGE,'')                        AS MOLDING_CHARGE,
                    RD.COST_COUNT                                         AS COST_COUNT,
                    QD.MOLDING_FLAG                                       AS MOLDING_FLAG,
                    GETRQEPDATADISP(QD.HOUSE_CODE, QD.QTA_NO, QD.QTA_SEQ, QD.VENDOR_CODE, 'F_DATE')  AS EP_FROM_DATE,
                    GETRQEPDATADISP(QD.HOUSE_CODE, QD.QTA_NO, QD.QTA_SEQ, QD.VENDOR_CODE, 'T_DATE')  AS EP_TO_DATE,
                    GETRQEPDATADISP(QD.HOUSE_CODE, QD.QTA_NO, QD.QTA_SEQ, QD.VENDOR_CODE, 'F_QTY')  AS EP_FROM_QTY,
                    GETRQEPDATADISP(QD.HOUSE_CODE, QD.QTA_NO, QD.QTA_SEQ, QD.VENDOR_CODE, 'T_QTY')  AS EP_TO_QTY,
                    GETRQEPDATADISP(QD.HOUSE_CODE, QD.QTA_NO, QD.QTA_SEQ, QD.VENDOR_CODE, 'UNIT_PRICE')  AS EP_UNIT_PRICE,
                    CASE NVL(QD.QTA_NO,'') WHEN '' THEN '' ELSE QD.QTA_NO end        AS QTA_NO,
                    CASE NVL(QD.QTA_SEQ,'') WHEN '' THEN '' ELSE QD.QTA_SEQ end     AS QTA_SEQ,
                    PD.MAKER_CODE                                         AS MAKER_CODE,
                    PD.MAKER_NAME                                         AS MAKER_NAME,
                    RD.DELY_TO_LOCATION                                   AS DELY_TO_LOCATION,
                    RD.RFQ_NO                                             AS RFQ_NO,
                    RD.RFQ_COUNT                                          AS RFQ_COUNT,
                    RD.RFQ_SEQ                                            AS RFQ_SEQ ,
                    QD.MOLDING_QTY                                        AS MOLDING_PROSPECTIVE_QTY,
                    RD.CUR                                        		AS CUR      ,
                    QD.TECHNIQUE_GRADE	                                          AS TECHNIQUE_GRADE	 ,
                    RD.TECHNIQUE_FLAG 	                                          AS TECHNIQUE_FLAG 	 ,
                    RD.TECHNIQUE_TYPE 	                                          AS TECHNIQUE_TYPE 	 ,
                    QD.INPUT_FROM_DATE	                                          AS INPUT_FROM_DATE	 ,
                    QD.INPUT_TO_DATE 	                                          AS INPUT_TO_DATE 	  ,
                    QD.REMARK 	                                          AS REMARK ,
			    	(SELECT NAME_LOC 
                       FROM ICOMHUMT 
                      WHERE HOUSE_CODE = QD.HOUSE_CODE 
                        AND HUMAN_NO   = QD.HUMAN_NO 
                        AND STATUS    != 'D') AS HUMAN_NAME_LOC
                    ,NVL(QD.DISCOUNT,0) 	                                          AS DISCOUNT
					,PD.CONTRACT_DIV
					,QD.RATE
      				,QD.SEC_VENDOR_CODE
      				--,GETVENDORNAME(QD.HOUSE_CODE,QD.SEC_VENDOR_CODE) AS SEC_VENDOR_CODE_TEXT
              FROM  ICOYRQDT RD, 
                    ICOYRQSE RS,
                    ICOYPRDT PD, 
                    ICOYRQHD RH,
                    ICOYQTDT QD, 
                    ICOYQTHD QH, 
                    ICOYPRHD PH 
             WHERE 1=1
                   AND RD.HOUSE_CODE   = RS.HOUSE_CODE
                   AND RD.RFQ_NO       = RS.RFQ_NO
                   AND RD.RFQ_COUNT    = RS.RFQ_COUNT
                   AND RD.RFQ_SEQ      = RS.RFQ_SEQ
                   AND RD.HOUSE_CODE   = PD.HOUSE_CODE
	               AND RD.PR_NO        = PD.PR_NO
	               AND RD.PR_SEQ       = PD.PR_SEQ
                   AND RD.HOUSE_CODE   = RH.HOUSE_CODE	               
	               AND RD.RFQ_NO       = RH.RFQ_NO	               
	               AND RD.RFQ_COUNT    = RH.RFQ_COUNT
                   AND RS.HOUSE_CODE   = QD.HOUSE_CODE(+)
                   AND RS.RFQ_NO       = QD.RFQ_NO(+)
                   AND RS.RFQ_COUNT    = QD.RFQ_COUNT(+)
                   AND RS.RFQ_SEQ      = QD.RFQ_SEQ(+)
                   AND RS.VENDOR_CODE  = QD.VENDOR_CODE(+)
	               AND QD.HOUSE_CODE   = QH.HOUSE_CODE(+)
	               AND QD.VENDOR_CODE  = QH.VENDOR_CODE(+)
	               AND QD.QTA_NO       = QH.QTA_NO(+)
	               AND PD.HOUSE_CODE   = PH.HOUSE_CODE
	               AND PD.PR_NO        = PH.PR_NO
                   AND RH.RFQ_TYPE IN ('MA','MI','SI')
	               AND RH.BID_TYPE     = 'RQ'
	               AND NVL(RTRIM(LTRIM(RS.BID_FLAG)), 'Y') <> 'N'
	               AND RS.STATUS  IN ('C', 'R')
	               AND RD.STATUS  IN ('C', 'R')
                   AND RH.STATUS  IN ('C', 'R')
                   AND 'D'  <> QD.STATUS(+)
			       AND RD.HOUSE_CODE    = ${session.HOUSE_CODE}	 
			       AND RD.RFQ_NO        = $S{st_rfq_no}
			       AND RD.RFQ_COUNT     = $S{st_rfq_count} 
			       AND RS.VENDOR_CODE   = $S{st_vendor_code} 
              ]]>
	<if test="${GROUP_YN}" operator="eq" value="Y">
            	) GROUP BY ITEM_NO, SPECIFICATION , DESCRIPTION_LOC
     </if>

	</method>
	
	<method name="getQuery_RFQVENDOR">
	<![CDATA[
	SELECT  ROWNUM AS R_NUM,                                                   
      TEMP.VENDOR_CODE,                                                    
      TEMP.NAME                                                            
	FROM(SELECT DISTINCT                                                       
            RS.HOUSE_CODE,                                                 
            RS.RFQ_NO,                                                     
            RS.RFQ_COUNT,                                                  
            RS.VENDOR_CODE,                                                
            GETCOMPANYNAMELOC(RS.HOUSE_CODE, RS.VENDOR_CODE, 'S') AS NAME  
     FROM ICOYRQSE RS                                                      
   <OPT=F,S>  WHERE HOUSE_CODE = ? </OPT>                                  
   <OPT=S,S>  AND   RFQ_NO     = ? </OPT>                                  
   <OPT=S,N>  AND   RFQ_COUNT  = ? </OPT>                                  
     ORDER BY RS.VENDOR_CODE) TEMP                                         
	]]>
	</method>
	
	<method name="chkRFQCntSecond">
	<![CDATA[
		SELECT	COUNT(*) AS RFQ_CNT   	       
		FROM ICOYRQHD						   
<OPT=F,S> WHERE HOUSE_CODE = ?	</OPT> 
<OPT=S,S> AND	RFQ_NO     = ?	</OPT> 
		  AND	RFQ_COUNT	 = 2				   
	]]>
	</method>
	
	<method name="et_getFlagQTACreate">
	<![CDATA[
		 SELECT COUNT(*) AS QTA_CNT			    	     
 		 FROM	ICOYQTDT DT							     
 		WHERE	DT.STATUS IN ('C', 'R')                  
<OPT=S,S> AND	DT.RFQ_NO		= ?	</OPT>       
<OPT=S,N> AND	DT.RFQ_COUNT	= ?	</OPT>       
<OPT=S,S> AND	DT.VENDOR_CODE	= ?	</OPT>       
<OPT=F,S> AND	DT.HOUSE_CODE	= ?	</OPT>  	 
		
	
	]]>
	</method>
	
	<method name="et_getQtaCreateHDRFQ">
	<![CDATA[
		SELECT                                                                                                                            
                        REPLACE(H.SUBJECT,'\"','''') AS SUBJECT                                                                                  
                      ,( SUBSTR(H.RFQ_CLOSE_DATE||H.RFQ_CLOSE_TIME,0,4) || '/'  || SUBSTR(H.RFQ_CLOSE_DATE||H.RFQ_CLOSE_TIME,5,2)  || '/'  ||    
                            SUBSTR(H.RFQ_CLOSE_DATE||H.RFQ_CLOSE_TIME,7,2) || '  ' || SUBSTR(H.RFQ_CLOSE_DATE||H.RFQ_CLOSE_TIME,9,2)  || ':'     
                        || SUBSTR(H.RFQ_CLOSE_DATE||H.RFQ_CLOSE_TIME,11,2) )  AS RFQ_CLOSE_DATE_VIEW                                             
                      , H.RFQ_CLOSE_DATE                                                                                                         
                      , H.RFQ_CLOSE_TIME                                                                                                         
                      , H.TERM_CHANGE_FLAG                                                                                                       
                      , H.DOM_EXP_FLAG                                                                                                           
                      , GETICOMCODE2(H.HOUSE_CODE, 'M032', H.DOM_EXP_FLAG) AS DOM_EXP_FLAG_TEXT                                                  
                      , H.DELY_TERMS                                                                                                             
                      , H.PAY_TERMS                                                                                                              
                      , D.CUR                                                                                                                    
                      , H.RFQ_TYPE                                                                                                               
                      , GETICOMCODE2(H.HOUSE_CODE, 'M112', H.RFQ_TYPE) AS RFQ_TYPE_TEXT                                                          
                      , H.SHIPPING_METHOD                                                                                                        
                      , D.PRICE_TYPE                                                                                                             
                      , H.USANCE_DAYS                                                                                                            
                      , GETICOMCODE2(H.HOUSE_CODE, 'M033', H.USANCE_DAYS) AS USANCE_DAYS_TEXT                                                    
                      , H.ARRIVAL_PORT                                                                                                           
                      , H.ARRIVAL_PORT_NAME                                                                                                      
                      , H.REMARK AS RFQ_REMARK                                                                                                   
                      , '' AS REMARK                                                                                                             
                      , D.SHIPPER_TYPE                                                                                                           
                      , GETICOMCODE2(H.HOUSE_CODE,'M025',D.SHIPPER_TYPE) AS SHIPPER_TYPE_TEXT                                                    
                      , GETICOMCODE2(H.HOUSE_CODE,'M009',H.DELY_TERMS) AS DELY_TERMS_TEXT                                                        
                      , GETICOMCODE2(H.HOUSE_CODE,'M010',H.PAY_TERMS) AS PAY_TERMS_TEXT                                                          
                      , D.COMPANY_CODE                                                                                                           
                      , GETICOMCODE2(H.HOUSE_CODE,'M015',H.SHIPPING_METHOD) AS SHIPPING_METHOD_TEXT                                              
                      , H.DEPART_PORT AS DEPART_PORT                                                                                             
                      , H.DEPART_PORT_NAME AS DEPART_PORT_NAME                                                                                   
                      ,(SELECT COUNT(*)                                                                                                          
                          FROM   ICOYRQAN                                                                                                        
                         WHERE  HOUSE_CODE = H.HOUSE_CODE                                                                                        
                         AND    RFQ_NO     = H.RFQ_NO                                                                                            
                         AND    RFQ_COUNT  = H.RFQ_COUNT) AS RQAN_CNT                                                                            
                      , GETICOMCODE2(H.HOUSE_CODE,'M149',H.SETTLE_TYPE) AS SETTLE_TYPE_TEXT                                                      
                      , H.SETTLE_TYPE                                                                                                            
                      , '' AS QTA_VAL_DATE                                                                                                       
                      , GETCOMPANYNAMELOC(S.HOUSE_CODE, S.VENDOR_CODE, 'S') AS VENDOR_NAME                                                       
                      , GETICOMCODE2(H.HOUSE_CODE,'M059', D.PRICE_TYPE) AS PRICE_TYPE_TEXT                                                       
                      , D.VALID_FROM_DATE   
                      , D.VALID_TO_DATE     
                      ,SUBSTR(D.VALID_FROM_DATE,0,4) || '/' || SUBSTR(D.VALID_FROM_DATE,5,2) || '/' ||SUBSTR(D.VALID_FROM_DATE,7,2) AS VALID_FROM_DATE_VIEW 
       		          ,SUBSTR(D.VALID_TO_DATE,0,4) || '/' || SUBSTR(D.VALID_TO_DATE,5,2) || '/' ||SUBSTR(D.VALID_TO_DATE,7,2) AS VALID_TO_DATE_VIEW         
       		          ,'' AS QTA_NO         
       		          ,'' AS BEFORE_QTA_NO  
       		          ,Z_SMS_SEND_FLAG    
       		          ,Z_RESULT_OPEN_FLAG 
       		          ,GETUSERNAMELOC(H.HOUSE_CODE, H.ADD_USER_ID) AS  ADD_USER_NAME 											
       		          ,H.CREATE_TYPE 												
       		          ,H.BID_REQ_TYPE 												
       		          ,GETFILEATTCOUNT(H.ATTACH_NO) AS RFQ_ATT_COUNT 				
       		          ,'0' AS QTA_ATTACH_CNT 										
       		          ,H.ATTACH_NO AS RFQ_ATTACH_NO 								
       		          ,'' AS QTA_ATTACH_NO 											
       		  FROM ICOYRQHD H, ICOYRQDT D, ICOYRQSE S                                                                                            
              WHERE H.HOUSE_CODE = D.HOUSE_CODE                                                                                                  
              AND D.HOUSE_CODE   = S.HOUSE_CODE                                                                                                  
              AND H.RFQ_NO       = D.RFQ_NO                                                                                                      
              AND D.RFQ_NO       = S.RFQ_NO                                                                                                      
              AND H.RFQ_COUNT    = D.RFQ_COUNT                                                                                                   
              AND D.RFQ_COUNT    = S.RFQ_COUNT                                                                                                   
            <OPT=S,S>  AND S.VENDOR_CODE  = ? </OPT>                                                                                             
            <OPT=F,S>  AND S.HOUSE_CODE   = ? </OPT>                                                                                             
            <OPT=S,S>  AND S.RFQ_NO       = ? </OPT>                                                                                             
            <OPT=S,N>  AND S.RFQ_COUNT    = ? </OPT>                                                                                             
              AND H.STATUS    IN ('C','R')                                                                                                       
              AND D.STATUS    IN ('C','R')                                                                                                       
              AND S.STATUS    IN ('C','R')                                                                                                       
              --AND H.RFQ_FLAG  = 'P'
              AND  (H.RFQ_FLAG = 'P' OR H.RFQ_FLAG = 'B' OR H.RFQ_FLAG = 'C')                                                                                                              
              AND H.BID_TYPE  = 'RQ'                                                                                                             
              AND H.RFQ_TYPE IN ('MA', 'MI', 'SI')                                                                                                     
              AND H.SIGN_STATUS  = 'E'                                                                                                           
              AND ROWNUM = 1                      
	
	]]>
	</method>
	
	<method name="et_getQtaCreateHDQTA">
	<![CDATA[
		SELECT                                                                                                                                          
	                     GETCOMPANYNAMELOC(QH.HOUSE_CODE, QH.VENDOR_CODE, 'S') AS VENDOR_NAME                                                                   
	                    ,RH.SUBJECT                                                                                                                             
	                    ,RH.COMPANY_CODE                                                                                                                         
	                    ,( SUBSTR(RH.RFQ_CLOSE_DATE||RH.RFQ_CLOSE_TIME,0,4) || '/'  || SUBSTR(RH.RFQ_CLOSE_DATE||RH.RFQ_CLOSE_TIME,5,2)  || '/'  ||             
	                       SUBSTR(RH.RFQ_CLOSE_DATE||RH.RFQ_CLOSE_TIME,7,2) || '  ' || SUBSTR(RH.RFQ_CLOSE_DATE||RH.RFQ_CLOSE_TIME,9,2)  || ':'                 
	                    || SUBSTR(RH.RFQ_CLOSE_DATE||RH.RFQ_CLOSE_TIME,11,2) )  AS RFQ_CLOSE_DATE_VIEW                                                          
	                    ,RH.RFQ_CLOSE_DATE                                                                                                                      
	                    ,RH.RFQ_CLOSE_TIME                                                                                                                      
	                    ,QH.DELY_TERMS                                                                                                                          
	                    ,GETICOMCODE2(QH.HOUSE_CODE,'M009',QH.DELY_TERMS) AS DELY_TERMS_TEXT                                                                    
	                    ,NVL(QH.PAY_TERMS, RH.PAY_TERMS) AS PAY_TERMS                                                                                           
	                    ,GETICOMCODE2(QH.HOUSE_CODE,'M010',NVL(QH.PAY_TERMS, RH.PAY_TERMS))  AS PAY_TERMS_TEXT                                                  
	                    ,QH.CUR                                                                                                                                 
	                    ,RH.SETTLE_TYPE                                                                                                                         
	                    ,GETICOMCODE2(RH.HOUSE_CODE,'M149',RH.SETTLE_TYPE) AS SETTLE_TYPE_TEXT                                                                  
	                    ,RH.TERM_CHANGE_FLAG                                                                                                                    
	                    ,SUBSTR(RD.VALID_FROM_DATE,0,4) || '/' || SUBSTR(RD.VALID_FROM_DATE,5,2) || '/' ||SUBSTR(RD.VALID_FROM_DATE,7,2) AS VALID_FROM_DATE_VIEW
	                    ,SUBSTR(RD.VALID_TO_DATE,0,4) || '/' || SUBSTR(RD.VALID_TO_DATE,5,2) || '/' ||SUBSTR(RD.VALID_TO_DATE,7,2) AS VALID_TO_DATE_VIEW        
	                    ,RH.RFQ_TYPE                                                                                                                            
	                    ,GETICOMCODE2(RH.HOUSE_CODE, 'M112', RH.RFQ_TYPE) AS RFQ_TYPE_TEXT                                                                      
	                    ,RD.PRICE_TYPE                                                                                                                          
	                    ,GETICOMCODE2(RH.HOUSE_CODE,'M059', RD.PRICE_TYPE) AS PRICE_TYPE_TEXT                                                                   
	                    ,QH.SHIPPING_METHOD                                                                                                                     
	                    ,GETICOMCODE2(QH.HOUSE_CODE,'M015',QH.SHIPPING_METHOD) AS SHIPPING_METHOD_TEXT                                                          
	                    ,QH.USANCE_DAYS                                                                                                                         
	                    ,GETICOMCODE2(QH.HOUSE_CODE, 'M033', QH.USANCE_DAYS) AS USANCE_DAYS_TEXT                                                                
	                    ,QH.DEPART_PORT                                                                                                                         
	                    ,QH.DEPART_PORT_NAME                                                                                                                    
	                    ,QH.ARRIVAL_PORT                                                                                                                        
	                    ,QH.ARRIVAL_PORT_NAME                                                                                                                   
	                    ,RH.DOM_EXP_FLAG                                                                                                                        
	                    ,GETICOMCODE2(RH.HOUSE_CODE, 'M032', RH.DOM_EXP_FLAG) AS DOM_EXP_FLAG_TEXT                                                              
	                    ,RD.SHIPPER_TYPE                                                                                                                        
	                    ,GETICOMCODE2(RD.HOUSE_CODE,'M025',RD.SHIPPER_TYPE) AS SHIPPER_TYPE_TEXT                                                                
	                    ,QH.QTA_VAL_DATE                                                                                                                        
	                    ,RH.REMARK AS RFQ_REMARK                                                                                                                
	                    ,QH.REMARK AS REMARK                                                                                                                    
	                    ,(SELECT COUNT(*)                                                                                                                       
	                      FROM   ICOYRQAN                                                                                                                       
	                      WHERE  HOUSE_CODE = RH.HOUSE_CODE                                                                                                     
	                      AND    RFQ_NO     = RH.RFQ_NO                                                                                                         
	                      AND    RFQ_COUNT  = RH.RFQ_COUNT                                                                                                      
	                    ) AS   RQAN_CNT                                                                                                                         
	                    ,QH.QTA_NO                                                                                                                              
	                    ,(SELECT QTA_NO FROM ICOYQTHD                                                                                                           
	                     WHERE HOUSE_CODE = QH.HOUSE_CODE                                                                                                       
	                     AND   RFQ_NO     = QH.RFQ_NO                                                                                                           
	                     AND   RFQ_COUNT  = 1                                                                                                                   
	                     AND   VENDOR_CODE= QH.VENDOR_CODE) AS BEFORE_QTA_NO                                                                                    
       		          ,Z_SMS_SEND_FLAG                                                   
       		          ,Z_RESULT_OPEN_FLAG                                               
       				,GETUSERNAMELOC(RH.HOUSE_CODE, RH.ADD_USER_ID) AS  ADD_USER_NAME	
       				,RH.CREATE_TYPE														
       				,RH.BID_REQ_TYPE														
       				,GETFILEATTCOUNT(RH.ATTACH_NO) AS RFQ_ATT_COUNT						
       				,GETFILEATTCOUNT(QH.ATTACH_NO) AS QTA_ATTACH_CNT   					
       				,RH.ATTACH_NO AS RFQ_ATTACH_NO											
       		 		,QH.ATTACH_NO AS QTA_ATTACH_NO											        
	             FROM ICOYQTHD QH, ICOYQTDT QD, ICOYRQHD RH, ICOYRQDT RD                                                                                        
	             WHERE QH.HOUSE_CODE  = QD.HOUSE_CODE                                                                                                           
	             AND   QH.QTA_NO      = QD.QTA_NO                                                                                                               
	             AND   QH.VENDOR_CODE = QD.VENDOR_CODE                                                                                                          
	             AND   RH.HOUSE_CODE  = QH.HOUSE_CODE                                                                                                           
	             AND   RH.RFQ_NO      = QH.RFQ_NO                                                                                                               
	             AND   RH.RFQ_COUNT   = QH.RFQ_COUNT                                                                                                            
	             AND   RH.HOUSE_CODE  = RD.HOUSE_CODE                                                                                                           
	             AND   RH.RFQ_NO      = RD.RFQ_NO                                                                                                               
	             AND   RH.RFQ_COUNT   = RD.RFQ_COUNT                                                                                                            
	             AND   RD.HOUSE_CODE  = QD.HOUSE_CODE                                                                                                           
	             AND   RD.RFQ_NO      = QD.RFQ_NO                                                                                                               
	             AND   RD.RFQ_COUNT   = QD.RFQ_COUNT                                                                                                            
	             AND   RD.RFQ_SEQ     = QD.RFQ_SEQ                                                                                                              
	             AND   QH.STATUS      IN ('C', 'R')                                                                                                             
	             AND   QD.STATUS      IN ('C', 'R')                                                                                                             
	             AND   RH.STATUS      IN ('C', 'R')                                                                                                             
	             AND   RD.STATUS      IN ('C', 'R')                                                                                                             
	             AND   RH.RFQ_TYPE    IN ('MA', 'MI', 'SI')                                                                                                     
	             AND   RH.SIGN_STATUS  = 'E'                                                                                                                    
	             AND   RH.BID_TYPE     = 'RQ'                                                                                                                   
	             AND   (RH.RFQ_FLAG     = 'P' OR RH.RFQ_FLAG     = 'B')                                                                                                                      
	             <OPT=S,S> AND   QH.RFQ_NO      = ? </OPT>                                                                                                      
	             <OPT=S,N> AND   QH.RFQ_COUNT   = ? </OPT>                                                                                                      
	             <OPT=S,S> AND   QH.VENDOR_CODE = ? </OPT>                                                                                                      
	             <OPT=F,S> AND   QH.HOUSE_CODE  = ? </OPT>                                                                                                      
	             AND   ROWNUM = 1                                 
	
	
	]]>
	</method>
	
	<method name="getQuery_RFQVENDOR_NEXT">
	<![CDATA[
		SELECT                                                                                                                        
			     AN.VENDOR_CODE,                                                                                                            
			     AN.NAME,                                                                                                                   
			     AN.R_NUM                                                                                                                   
			  FROM (SELECT  ROWNUM AS R_NUM,                                                                                                
			              TEMP.VENDOR_CODE,                                                                                                 
			              TEMP.NAME                                                                                                         
			        FROM(SELECT DISTINCT                                                                                                    
			                    RS.HOUSE_CODE,                                                                                              
			                    RS.RFQ_NO,                                                                                                  
			                    RS.RFQ_COUNT,                                                                                               
			                    RS.VENDOR_CODE,                                                                                             
			                    GETCOMPANYNAMELOC(RS.HOUSE_CODE, RS.VENDOR_CODE, 'S') AS NAME                                               
			             FROM ICOYRQSE RS                                                                                                   
			             WHERE STATUS IN ('C', 'R')                                                                                         
			            <OPT=F,S> AND   HOUSE_CODE = ? </OPT>                                                                               
			            <OPT=S,S> AND   RFQ_NO     = ? </OPT>                                                                               
			            <OPT=S,N> AND   RFQ_COUNT  = ? </OPT>                                                                               
			             ORDER BY RS.VENDOR_CODE) TEMP                                                                                      
			       ) AN                                                                                                                     
			  WHERE R_NUM = DECODE(SIGN( <OPT=S,S> ? </OPT> - (TO_NUMBER( <OPT=S,S> ? </OPT>)+1)), -1, 1,TO_NUMBER( <OPT=S,S> ? </OPT>)+1 ) 
	
	]]>
	</method>
	
</service>