<?xml version="1.0" encoding="UTF-8" ?>
<service>
	
	
	<method name="getPoList">
		<![CDATA[
		SELECT MAX
		       (
		           (
		               CASE 
		                   WHEN POHD.STATUS = ('C') 
		                   THEN '신규' 
		                   WHEN POHD.STATUS IN ('R') 
		                   THEN '변경' 
		               END
		           )
		       ) AS STATUS ,
		       MAX
		       (
		           (
		               CASE 
		                   WHEN POHD.CONFIRM_DATE IS NULL 
		                   THEN 'N' 
		                   ELSE DECODE (POHD.CONFIRM_CERTV,'N','R',POHD.CONFIRM_CERTV) 
		               END
		           )
		       ) AS CONFIRM_FLAG ,
		
		       MAX
		       (
		           (
		               CASE 
		                   WHEN POHD.CONFIRM_DATE IS NULL 
		                   THEN DECODE(POHD.SIGN_STATUS,'E',GETICOMCODE2(POHD.HOUSE_CODE,'M644','N'),GETICOMCODE2(POHD.HOUSE_CODE,'M100',POHD.SIGN_STATUS)) 
		                   ELSE GETICOMCODE2(POHD.HOUSE_CODE,'M644', DECODE (POHD.CONFIRM_CERTV,'N','R',POHD.CONFIRM_CERTV)) 
		               END
		           )
		       ) AS CONFIRM_FLAG_TEXT ,
		       MAX
		       (
		           (
		               CASE 
		                   WHEN POHD.SIGN_STATUS = 'E' 
		                   THEN '전송' 
		                   ELSE '미전송' 
		               END
		           )
		       ) AS SEND_FLAG ,
		       POHD.PO_NO ,
		       CONVERT_DATE(POHD.PO_CREATE_DATE) AS PO_CREATE_DATE ,
		       POHD.VENDOR_CODE ,
		       GETCOMPANYNAMELOC(POHD.HOUSE_CODE, POHD.VENDOR_CODE, 'S') AS VENDOR_NAME ,
		       GETUSERNAMELOC(POHD.HOUSE_CODE,POHD.PURCHASER_ID) AS CTRL_NAME ,
		       POHD.CTRL_CODE ,
		       --GETICOMBACO2(POHD.HOUSE_CODE, POHD.COMPANY_CODE, 'P', POHD.CTRL_CODE) AS CTRL_NAME,
		       PRHD.PR_TYPE ,
		       GETICOMCODE2(POHD.HOUSE_CODE,'M138',PRHD.PR_TYPE) AS PR_TYPE_DESC ,
		       GETUSERNAMELOC(POHD.HOUSE_CODE, POHD.TAKE_USER_NAME) AS TAKE_USER_NAME ,
		       POHD.CUR ,
		       ROUND(ROUND(SUM(PODT.ITEM_AMT),1) ,0 ) AS PO_TTL_AMT ,
		       MAX
		       (
		           (
		               CASE 
		                   WHEN POHD.END_DATE IS NOT NULL 
		                   THEN GETICOMCODE2(POHD.HOUSE_CODE,'M645', 'YY') 
		                   ELSE GETICOMCODE2(POHD.HOUSE_CODE,'M645', NVL(POHD.COMPLETE_MARK, 'N')) 
		               END
		           )
		       ) AS COMPLETE_MARK_TEXT ,
		       CASE 
		           WHEN POHD.END_DATE IS NOT NULL 
		           THEN 'YY' 
		           ELSE POHD.COMPLETE_MARK 
		       END COMPLETE_MARK ,
		       MIN(PODT.PR_NO || PODT.PR_SEQ) AS PR_INFO ,
		       MIN(PODT.PR_NO) AS PR_NO ,
		       MIN(PODT.PR_SEQ) AS PR_SEQ ,
		       POHD.SIGN_STATUS AS SIGN_STATUS ,
		       GETICOMCODE2(POHD.HOUSE_CODE,'M100',POHD.SIGN_STATUS) AS SIGN_STATUS_DESC ,
		       POHD.SUBJECT ,
		       PRHD.ORDER_NO ,
		       (SELECT CONVERT_DATE(MAX(CTR_DATE)) 
		         FROM ICOYCNDT 
		        WHERE POHD.HOUSE_CODE = HOUSE_CODE 
		              AND PODT.EXEC_NO = EXEC_NO
		       ) AS CTR_DATE ,
		       PRHD.TAKE_TEL ,
		       POHD.REMARK ,
		       (SELECT CONVERT_DATE(MAX(CTR_NO)) 
		         FROM ICOYCNDT 
		        WHERE POHD.HOUSE_CODE = HOUSE_CODE 
		              AND PODT.EXEC_NO = EXEC_NO
		       ) AS CTR_NO ,
		       PODT.EXEC_NO ,
		       (SELECT 
		              CASE COUNT(*) 
		                  WHEN 0 
		                  THEN 'Y' 
		                  ELSE 'N' 
		              END 
		         FROM ICOYIVDT 
		        WHERE HOUSE_CODE = POHD.HOUSE_CODE 
		              AND PO_NO = POHD.PO_NO 
		              AND STATUS != 'D'
		       ) AS DEL_FLAG ,
		       (
		           SELECT CASE COUNT(*) WHEN 0 THEN 'N' ELSE 'Y' END
		           FROM ICOYIVHD HD, ICOYIVDT DT
		           WHERE HD.HOUSE_CODE = POHD.HOUSE_CODE 
		           AND HD.INV_NO = DT.INV_NO
		           AND DT.PO_NO = POHD.PO_NO 
		           AND HD.STATUS != 'D'
		           --AND SIGN_STATUS = 'E1'
				) AS STOP_FLAG,
		       MIN(CNHD.SUBJECT) AS EXEC_NAME ,
		       MIN(PRHD.CUST_CODE) AS CUST_CODE ,
		       MIN(PRHD.CUST_NAME) AS CUST_NAME ,
		       MIN(PRHD.WBS) AS WBS_NO ,
		       MIN(PRHD.WBS_NAME) AS WBS_NAME ,
		       getDeptNameByID(nvl(PRHD.HOUSE_CODE,POHD.HOUSE_CODE), nvl(PRHD.COMPANY_CODE,POHD.COMPANY_CODE), nvl(PRHD.ADD_USER_ID,POHD.PURCHASER_ID)) AS REQ_DEPT,
		       --,MIN(PODT.MAKER_CODE) AS MAKER_CODE 
		       --,MIN(PODT.MAKER_NAME) AS MAKER_NAME 
		       MIN(CNDT.CONTRACT_FLAG) AS CONTRACT_FLAG ,
		       DECODE(ECCT.STATUS, 'SD', ECCT.CONT_SEQ , NULL) CONT_SEQ ,
		       DECODE(ECCT.STATUS, 'SD', MAX(ECCT.CONT_COUNT), NULL) AS CONT_COUNT ,
		       POHD.PAY_TERMS ,
		       MIN(VNGL.CLASS_GRADE) AS CLASS_GRADE ,
		       CONVERT_DATE(MIN(SUBSTR(ECCT.GAP_SIGN_DATE,0,8))) AS GAP_SIGN_DATE ,
		       MIN(TO_CHAR(TO_DATE(ECCT.START_DATE,'YYYY/MM/DD'),'YYYY/MM/DD') || '~' || TO_CHAR(TO_DATE(ECCT.END_DATE,'YYYY/MM/DD'),'YYYY/MM/DD')) AS CONT_PERIOD ,
		       MIN(ECCT.CONT_TITLE) AS CONT_TITLE ,
		       (
		           CASE NVL(MIN(ECCT.CONT_COUNT), -1) 
		               WHEN NULL 
		               THEN '미체결' 
		               WHEN '0' 
		               THEN '신규' 
		               ELSE '변경' 
		           END
		       ) AS CONT_STATUS ,
		       MIN(ECCT.TOTAL_AMT) AS TOTAL_AMT ,
		       getDeptNameLoc(POHD.HOUSE_CODE, POHD.COMPANY_CODE, MIN(PRHD.SALES_USER_DEPT)) AS SALES_DEPT_NAME ,
		       nvl(MIN(DEMAND_DEPT_NAME),getDeptNameByID(POHD.HOUSE_CODE, POHD.COMPANY_CODE, POHD.PURCHASER_ID)) AS REQ_DEPT_NAME ,
		       MIN(REPLACE(REPLACE( POHD.END_REMARK,CHR(13),' '),CHR(10),'')) AS END_REMARK ,
		       MIN(POHD.REJECT_REMARK) AS REJECT_REMARK ,
		       MIN(POHD.PO_TYPE) AS PO_TYPE,
		       DECODE(POHD.PO_TYPE, 'D', '직발주', 'M', '메뉴얼발주','C', '카탈로그발주','E','엑셀업로드발주','기안발주') AS PO_TYPE_TEXT
		       ,DECODE(POHD.EVAL_FLAG, null, '평가대기중', 'N', '평가제외', 'T', '평가대기중', 'P', '평가진행중', 'C', '평가완료') AS EVAL_FLAG_DESC
	         ,MAX(POHD.EVAL_FLAG) AS EVAL_FLAG
	         ,POHD.EVAL_REFITEM
	         ,(SELECT E_TEMPLATE_REFITEM FROM ICOMVEVH WHERE EVAL_REFITEM = POHD.EVAL_REFITEM) AS E_TEMPLATE_REFITEM
	         ,(SELECT TEMPLATE_TYPE FROM ICOMVETH WHERE E_TEMPLATE_REFITEM = (SELECT E_TEMPLATE_REFITEM FROM ICOMVEVH WHERE EVAL_REFITEM = POHD.EVAL_REFITEM)) AS TEMPLATE_TYPE
	         ,(SELECT EVAL_ITEM_REFITEM FROM ICOMVEVD WHERE EVAL_REFITEM = POHD.EVAL_REFITEM) AS EVAL_ITEM_REFITEM
	         ,(SELECT EVAL_VALUER_REFITEM FROM ICOMVEVL WHERE EVAL_ITEM_REFITEM = (SELECT EVAL_ITEM_REFITEM FROM ICOMVEVD WHERE EVAL_REFITEM = POHD.EVAL_REFITEM)) AS EVAL_VALUER_REFITEM
			 ,CNHD.YR_UNIT_PR_ORD_GB
			 ,PRDT.PR_SEQ AS PRDT_PR_SEQ 
		  FROM ICOYPOHD POHD ,
		       ICOYPODT PODT ,
		       ICOYCNHD CNHD ,
		       ICOYCNDT CNDT ,
		       ICOYPRHD PRHD ,
			   ICOYPRDT PRDT ,
		       ICOMVNGL VNGL ,
		       ICOMMTGL MTGL ,
		       (SELECT * 
		         FROM ICOYECCT 
		        WHERE HOUSE_CODE = ${session.HOUSE_CODE} AND STATUS IN ('SD','FD')
		]]>
		<if test="${cont_status}" operator="eq" value="C">
				AND CONT_COUNT = 1
		</if>
		<if test="${cont_status}" operator="eq" value="R">
				AND CONT_COUNT != 1
		</if>
		<![CDATA[
			     ) ECCT
			WHERE POHD.HOUSE_CODE    = PODT.HOUSE_CODE
			  AND POHD.PO_NO         = PODT.PO_NO
			  AND POHD.STATUS  		 <> 'D'
			  AND PODT.STATUS  		 <> 'D'
			  AND CNDT.HOUSE_CODE(+) = PODT.HOUSE_CODE
   			  AND CNDT.EXEC_NO(+) 	 = PODT.EXEC_NO
   			  AND CNDT.EXEC_SEQ(+) 	 = PODT.EXEC_SEQ
			  AND CNDT.STATUS(+)  	 <> 'D'
			  AND CNHD.HOUSE_CODE(+) = CNDT.HOUSE_CODE
   			  AND CNHD.EXEC_NO(+) 	 = CNDT.EXEC_NO
			  AND CNHD.STATUS(+) 	 <> 'D'
   			  AND PRHD.HOUSE_CODE(+) = PODT.HOUSE_CODE
   			  AND PRHD.PR_NO(+)      = PODT.PR_NO
   			  AND PODT.HOUSE_CODE	 = PRDT.HOUSE_CODE(+)
   			  AND PODT.PR_NO		 = PRDT.PR_NO(+)
   			  AND PODT.PR_SEQ		 = PRDT.PR_SEQ(+)
   			  AND VNGL.HOUSE_CODE    = POHD.HOUSE_CODE
   			  AND VNGL.VENDOR_CODE   = POHD.VENDOR_CODE
   			  AND MTGL.HOUSE_CODE    = PODT.HOUSE_CODE
   			  AND MTGL.ITEM_NO       = PODT.ITEM_NO
   			  AND ECCT.BID_NO(+)	 = PODT.PO_NO
   			  AND ECCT.HOUSE_CODE(+) = PODT.HOUSE_CODE
   			  AND POHD.HOUSE_CODE = ${session.HOUSE_CODE}   
   			 
   			  AND ECCT.CONT_SEQ 	LIKE '%' || $S{CONT_SEQ} || '%'   			
			AND ECCT.CONT_TITLE 	LIKE '%' || $S{CONT_TITLE} || '%' 			
			AND (( $S{cont_from_date}  BETWEEN ECCT.START_DATE AND ECCT.END_DATE)    
			     OR ( $S{cont_to_date} BETWEEN ECCT.START_DATE ECCT.AND END_DATE) 
			     OR ( ECCT.START_DATE BETWEEN $S{cont_from_date}   					
			                         	AND $S{cont_to_date})) 					
			AND ECCT.GAP_SIGN_DATE BETWEEN $S{cont_sign_from_date} 						
			                      		AND $S{cont_sign_to_date} 						
			AND POHD.HOUSE_CODE         = ${session.HOUSE_CODE}   					
			AND POHD.PO_CREATE_DATE BETWEEN $S{po_from_date} 					
			                            AND $S{po_to_date} 					
			AND POHD.PO_NO LIKE '%' || $S{po_no} || '%' 				
			AND VNGL.VENDOR_CODE       = $S{vendor_code} 					
			AND VNGL.VENDOR_NAME_LOC LIKE '%' || $S{vendor_name_loc} || '%' 		
			AND VNGL.CLASS_GRADE        = $S{class_grade} 					
   			AND POHD.CTRL_CODE		     IN ($S{ctrl_code}) 				
   			AND PRDT.PURCHASER_ID    = $S{ctrl_person_id} 					
			AND PRHD.CUST_CODE(+)    	 = $S{cust_code} 					
			AND PRHD.SALES_USER_DEPT(+) = $S{sales_dept} 
			AND MTGL.MATERIAL_TYPE      = $S{material_type} 
			AND MTGL.MATERIAL_CTRL_TYPE = $S{material_ctrl_type} 
			AND MTGL.MATERIAL_CLASS1    = $S{material_class1} 

			AND PODT.WBS_NAME    	    LIKE '%' || $S{wbs_name}  || '%' 	/* 프로젝트명 */	
			AND POHD.SUBJECT    	    LIKE '%' || $S{po_name} || '%' 	/* 발주명 */		
			AND CNHD.SUBJECT(+)   	    LIKE '%' || $S{ct_name} || '%' 	/* 품의명 */		
			AND PODT.MAKER_NAME    	LIKE '%' || $S{maker_name} || '%' 	/* 메이커명 */	
            AND CNDT.EXEC_NO LIKE '%' || $S{exec_no} || '%' 		
			  			   
   		      				
		]]>

		<if test="${po_status}" operator="eq" value="C">
				AND POHD.STATUS = ('C')
		</if>
		<if test="${po_status}" operator="eq" value="R">
				AND POHD.STATUS IN ('R')
		</if>
		<if test="${po_status}" operator="eq" value="F">
				AND POHD.STATUS IN ('C', 'R') AND POHD.CONFIRM_DATE > POHD.CHANGE_DATE
		</if>
		<if test="${confirm_flag}" operator="eq" value="Y">
				AND POHD.CONFIRM_CERTV = 'Y' -- 접수완료
				AND RTRIM(POHD.CONFIRM_DATE) IS NOT NULL
		</if>
		<if test="${confirm_flag}" operator="eq" value="N">
				AND POHD.CONFIRM_CERTV IS NULL -- 미접수
				AND RTRIM(POHD.CONFIRM_DATE) IS NULL
		</if>
		<if test="${confirm_flag}" operator="eq" value="R">
				AND POHD.CONFIRM_CERTV = 'N' -- 접수반려
				AND RTRIM(POHD.CONFIRM_DATE) IS NOT NULL
		</if>

		<if test="${complete_mark}" operator="eq" value="YY">
				AND POHD.END_DATE IS NOT NULL
		</if>
		<if test="${complete_mark}" operator="eq" value="Y">
				AND POHD.COMPLETE_MARK = '#complete_mark#'
		</if>
		<if test="${complete_mark}" operator="eq" value="N">
				AND POHD.COMPLETE_MARK = '#complete_mark#'
				AND POHD.END_DATE IS NULL
		</if>

		<![CDATA[
			GROUP BY POHD.HOUSE_CODE,   	GETICOMCODE2(POHD.HOUSE_CODE,'M100',POHD.SIGN_STATUS),
			       POHD.PO_NO,        		POHD.PO_CREATE_DATE,
			       POHD.VENDOR_CODE,  		GETCOMPANYNAMELOC(POHD.HOUSE_CODE, POHD.VENDOR_CODE, 'S'),
			       POHD.CUR,          		POHD.PO_TTL_AMT,
			       POHD.CTRL_CODE,    		POHD.COMPLETE_MARK, POHD.SIGN_STATUS,
			       POHD.COMPANY_CODE, 		PRHD.PR_TYPE,
			       POHD.TAKE_USER_NAME,		POHD.PAY_TERMS,
				   PRHD.ORDER_NO,			PRHD.TAKE_TEL,
				   POHD.REMARK,				PODT.EXEC_NO,
				   POHD.SUBJECT,			POHD.PURCHASER_ID,
				   CNHD.SUBJECT, PRHD.CUST_CODE, PRHD.CUST_NAME
				  ,PODT.WBS_NO, PODT.WBS_NAME, getDeptNameByID(nvl(PRHD.HOUSE_CODE,POHD.HOUSE_CODE), nvl(PRHD.COMPANY_CODE,POHD.COMPANY_CODE), nvl(PRHD.ADD_USER_ID,POHD.PURCHASER_ID))
				  ,ECCT.CONT_SEQ, ECCT.STATUS, POHD.END_DATE
				  ,POHD.PO_TYPE,POHD.EVAL_FLAG, POHD.EVAL_REFITEM, CNHD.YR_UNIT_PR_ORD_GB, PRDT.PR_SEQ

			HAVING MIN(PRHD.DEMAND_DEPT)	  = $S{req_dept}
				  
			ORDER BY POHD.PO_NO DESC, POHD.PO_CREATE_DATE DESC
		]]>
	</method>

	<method name="deletePODTList">
	<![CDATA[
	     SELECT PURCHASE_LOCATION,COMPANY_CODE,PR_NO,PR_SEQ,ITEM_NO, PO_NO, PO_SEQ, VENDOR_CODE, ITEM_QTY
	     FROM ICOYPODT
	     WHERE STATUS <> 'D'
	     <OPT=F,S>  AND HOUSE_CODE = ? </OPT>
	     <OPT=S,S>  AND PO_NO      = ? </OPT>
	]]>
	</method>

	<method name="up_icoyprdt">
		 UPDATE ICOYPRDT SET
		        PR_PROCEEDING_FLAG = 'B'
		 WHERE  HOUSE_CODE      = ?
		 AND    PR_NO           = ?
		 AND    PR_SEQ          = ?
	</method>

	<method name="del_ICOYPODR">
	<![CDATA[
		 UPDATE ICOYINDR SET
		        CUM_PO_QTY = NVL(CUM_PO_QTY,0) - NVL((SELECT NVL(ITEM_QTY,0)
		                                              FROM ICOYPODT
		                                              WHERE HOUSE_CODE        = ?
		                                                AND PO_NO             = ?
		                                                AND PO_SEQ            = ?
		                                                AND ITEM_NO           = ?
		                                                AND PURCHASE_LOCATION = ?),0)
		 WHERE STATUS <> 'D'
		   AND HOUSE_CODE        = ?
		   AND COMPANY_CODE 	 = ?
		   AND PURCHASE_LOCATION = ?
		   AND ITEM_NO           = ?
		   AND VENDOR_CODE       = ?
	]]>
	</method>

	<method name="del_ICOYPODT">
			 UPDATE ICOYPODT SET
			         STATUS                 = 'D'
			        ,CHANGE_DATE            = ?
			        ,CHANGE_TIME            = ?
			        ,CHANGE_USER_ID         = ?
			 WHERE HOUSE_CODE               = ?
			   AND PO_NO                    = ?
	</method>

	<method name="del_ICOYPOHD">
			 UPDATE ICOYPOHD SET
			         STATUS                 = 'D'
			        ,CHANGE_DATE            = ?
			        ,CHANGE_TIME            = ?
			        ,CHANGE_USER_ID         = ?
			 WHERE HOUSE_CODE               = ?
			   AND PO_NO                    = ?
	</method>

	<method name="del_ICOYECCT">
		UPDATE ICOYECCT 
		       SET STATUS = 'DD' 
		 WHERE BID_NO = ? 
		       AND CONT_COUNT = 
		       (SELECT MAX (CONT_COUNT) 
		         FROM ICOYECCT 
		        WHERE HOUSE_CODE = '#HOUSE_CODE#' AND BID_NO = ? 
		       )
		       AND HOUSE_CODE = '#HOUSE_CODE#'
	</method>

	<method name="setPoCompleteMark_1">
             UPDATE ICOYPOHD
             SET  COMPLETE_MARK    = 'Y'
                 ,CHANGE_DATE      = ?
                 ,CHANGE_TIME      = ?
                 ,CHANGE_USER_ID   = ?
                 ,STATUS           = 'R'
             WHERE HOUSE_CODE      = ?
             AND   PO_NO           = ?
	</method>

	<method name="setPoCompleteMark_2">
             UPDATE ICOYPODT
             SET  COMPLETE_GR_MARK = 'Y'
                 ,CHANGE_DATE      = ?
                 ,CHANGE_TIME      = ?
                 ,CHANGE_USER_ID   = ?
                 ,STATUS           = 'R'
             WHERE HOUSE_CODE      = ?
             AND   PO_NO           = ?
	</method>

	<method name="bl_getEvalCode">
	<![CDATA[
		SELECT TEXT3 AS TEMPLATE_ITEM, CODE AS EVAL_ID FROM ICOMCODE WHERE TYPE = 'M924' AND CODE = 1
	]]>
	</method>

	<method name="et_setEvalInert">
	<![CDATA[
		UPDATE ICOYPOHD
		SET EVAL_FLAG    = '#eval_flag#'
		   ,EVAL_REFITEM = '#eval_refitem#'
		WHERE HOUSE_CODE = '#house_code#'
		AND PO_NO = '#doc_no#'

		]]>
	</method>

	<method name="et_getEvalUser">
	<![CDATA[
		SELECT DECODE(PROJECT_PM, NULL, DECODE(SALES_USER_ID, NULL, ADD_USER_ID, SALES_USER_ID), PROJECT_PM) PROJECT_PM
  				, DECODE(PROJECT_PM, NULL
        				, DECODE(SALES_USER_ID, NULL, (SELECT DEPT FROM ICOMLUSR WHERE HOUSE_CODE = A.HOUSE_CODE AND USER_ID =A.ADD_USER_ID), SALES_USER_DEPT)
        				, (SELECT DEPT FROM ICOMLUSR WHERE HOUSE_CODE = A.HOUSE_CODE AND USER_ID =A.PROJECT_PM)
       			) PROJECT_DEPT
		FROM ICOYPRHD A
		WHERE HOUSE_CODE = '#house_code#'
		AND PR_NO = (
						SELECT PR_NO
                		FROM ICOYPODT PO
                		WHERE PO.HOUSE_CODE = '#house_code#'
                		AND PO.PO_NO = '#doc_no#'
                		AND PO.STATUS != 'D'
                		AND ROWNUM = 1
					)
	]]>
	</method>

	<method name="et_getEvalCompanyHuman">
	<![CDATA[
		SELECT CNDT.VENDOR_CODE, CNDT.HUMAN_NO
        FROM ICOYCNDT CNDT
        WHERE CNDT.HOUSE_CODE = '#house_code#'
        AND CNDT.HUMAN_NO IS NOT NULL
        AND (CNDT.EXEC_NO, CNDT.EXEC_SEQ) IN (  SELECT EXEC_NO, EXEC_SEQ
                                     			FROM ICOYPODT PO
                                     			WHERE PO.HOUSE_CODE = CNDT.HOUSE_CODE
                                     			AND (PO.PO_NO, PO.PO_SEQ) IN ( SELECT PO_NO, PO_SEQ FROM ICOYIVDT
                                                                    			WHERE HOUSE_CODE = PO.HOUSE_CODE AND INV_NO = '#doc_no#')
                                     			AND PO.STATUS != 'D'
                                    		 )

	]]>
	</method>

	<method name="et_getEvalCompany">
	<![CDATA[
		SELECT DISTINCT VENDOR_CODE FROM ICOYPOHD WHERE PO_NO = '#doc_no#'
	]]>
	</method>

	<method name="bl_getEvalResult">
	<![CDATA[
		SELECT E.EVAL_VALUER_REFITEM   
	   , A.E_TEMPLATE_REFITEM
	   , F.TEMPLATE_TYPE
	   , E.EVAL_ITEM_REFITEM
	   , A.EVAL_REFITEM
	  FROM ICOMVEVH A, ICOMVEVD B, ICOMVEVL E, ICOMVETH F
	  WHERE  A.HOUSE_CODE = '#house_code#' 
	  AND A.EVAL_REFITEM = (SELECT EVAL_REFITEM FROM ICOYPOHD WHERE PO_NO = '#inv_no#')
	  AND A.HOUSE_CODE = B.HOUSE_CODE        
	    AND A.HOUSE_CODE = E.HOUSE_CODE
	    AND A.HOUSE_CODE = F.HOUSE_CODE
	  AND A.EVAL_REFITEM = B.EVAL_REFITEM    
	  AND A.E_TEMPLATE_REFITEM = F.E_TEMPLATE_REFITEM
	  AND B.EVAL_ITEM_REFITEM = E.EVAL_ITEM_REFITEM   
	]]>
	</method>

	<method name="getERPPOList">
	    SELECT POHD.ADD_DATE AS PO_CREATE_DATE
	         ,(SELECT IRS_NO
			      FROM ICOMVNGL
			      WHERE HOUSE_CODE = POHD.HOUSE_CODE
			        AND VENDOR_CODE = POHD.VENDOR_CODE
			        AND ROWNUM = 1
			   ) AS VENDOR_CODE 
	         , POHD.PO_NO
	         , PODT.PO_SEQ
	         , (SELECT B.ERP_ID FROM ICOYPRHD A, ICOYPJTH B
	            WHERE A.HOUSE_CODE = B.HOUSE_CODE
	              AND A.WBS = B.PJT_SEQ
	              AND A.HOUSE_CODE = PODT.HOUSE_CODE 
	              AND A.PR_NO = PODT.PR_NO 
	              AND ROWNUM = 1) AS ERP_ID
	         , PODT.ITEM_NO
	         , PODT.ITEM_QTY AS Qty
	         , PODT.UNIT_PRICE 
	         , DECODE(VNGL.TAX_DIV,'1','1','0') AS TAX_DIV
	         , DECODE(VNGL.TAX_DIV,'1','10','0') AS VAT
	         , GETUSERNAMELOC(PODT.HOUSE_CODE,PODT.ADD_USER_ID) AS USER_NAME_LOC
	         , CNDT.VALID_FROM_DATE
	         , CNDT.VALID_TO_DATE    		 
	         , DECODE(MTGL.KTGRM,'01',
    		         DECODE(SUBSTR(PJTH.PJT_CODE,0, 2),'SI'
    		                       ,'상품(' || SUBSTR(SUBSTR(PJTH.PJT_CODE,0, 9),0, 5) ||')'
    		                       ,SUBSTR(PJTH.PJT_CODE,0, 9)
    		                )
    		        , SUBSTR(PJTH.PJT_CODE,0, 9)
    		   ) AS ASSETSEQ
	      FROM ICOYPOHD POHD, ICOYPODT PODT, 
	           ICOMVNGL VNGL, ICOYCNDT CNDT, 
	           ICOMMTGL MTGL, ICOYPRDT PRDT, 
		       ICOYPJTH PJTH, ICOYPRHD PRHD
	     WHERE POHD.HOUSE_CODE = PODT.HOUSE_CODE
	       AND POHD.PO_NO      = PODT.PO_NO
	       AND PODT.HOUSE_CODE = VNGL.HOUSE_CODE
	       AND PODT.VENDOR_CODE = VNGL.VENDOR_CODE
	       AND PODT.HOUSE_CODE = CNDT.HOUSE_CODE
	       AND PODT.EXEC_NO = CNDT.EXEC_NO
	       AND PODT.EXEC_SEQ = CNDT.EXEC_SEQ
	       AND PODT.HOUSE_CODE = MTGL.HOUSE_CODE
		   AND PODT.ITEM_NO = MTGL.ITEM_NO
	       AND PODT.HOUSE_CODE = PRDT.HOUSE_CODE
	       AND PODT.PR_NO = PRDT.PR_NO
	       AND PODT.PR_SEQ = PRDT.PR_SEQ 
	       AND PRDT.HOUSE_CODE = PRHD.HOUSE_CODE
	       AND PRDT.PR_NO = PRHD.PR_NO	       
	       AND PRHD.HOUSE_CODE = PJTH.HOUSE_CODE
	       AND PRHD.WBS = PJTH.PJT_SEQ      
	       AND POHD.HOUSE_CODE = '#house_code#'
	       AND POHD.PO_NO = '#po_no#'
	    ORDER BY POHD.ADD_DATE DESC
	</method>

	<method name="">
	<![CDATA[
	]]>
	</method>
	
	
	
	<method name="getPoDetailHeader">
		<![CDATA[
	SELECT   PH.PO_NO												    			
  	    	,PH.VENDOR_CODE                                         				
  	    	, GETCOMPANYNAMELOC(PH.HOUSE_CODE, PH.VENDOR_CODE, 'S')  AS VENDOR_NAME	
  	    	, GETUSERNAMELOC(PH.HOUSE_CODE, PH.ADD_USER_ID)  AS USER_NAME			
  	    	,PH.SUBJECT                                             				
  	    	,PH.CTRL_CODE															
  	    	,PH.PAY_TERMS															
  	    	,GETICOMCODE1(PH.HOUSE_CODE,'M010',PH.PAY_TERMS) AS PAY_TERMS_DESC	
  	    	,PH.DELY_TERMS															
  	    	,GETICOMCODE1(PH.HOUSE_CODE,'M009',DECODE (LENGTH (PH.DELY_TERMS), 1, '0'||PH.DELY_TERMS, PH.DELY_TERMS)) AS DELY_TERMS_DESC	
  	    	,PH.PR_TYPE																
  	    	,GETICOMCODE2(PH.HOUSE_CODE,'M138',PH.PR_TYPE) AS PR_TYPE_DESC			
  	    	,PH.ORDER_NO                                          					
  	    	,PH.ORDER_NAME                                         					
  	    	,PH.CUR                                                 				
  	    	,PH.PO_TTL_AMT
  	    	,PH.TAKE_USER_NAME AS TAKE_USER_ID				                               				
			,GetUserNameLoc(PH.HOUSE_CODE, PH.TAKE_USER_NAME) AS TAKE_USER_NAME
  	    	, GETDEPTCODEBYID(PH.HOUSE_CODE, 'WOORI', PH.TAKE_USER_NAME) AS TAKE_USER_DEPT
        	--, GETDEPTNAMEBYID(PH.HOUSE_CODE, 'WOORI', PH.TAKE_USER_NAME) AS TAKE_USER_DEPT_NAME
        	,DECODE(PH.TAKE_USER_NAME,PRHD.ADD_USER_ID,(SELECT DEPT_NAME_LOC FROM ICOMOGDP WHERE DEPT = PRHD.PLANT_CODE),GETDEPTNAMEBYID(PH.HOUSE_CODE, 'WOORI', PH.TAKE_USER_NAME)) TAKE_USER_DEPT_NAME
        	,(SELECT PHONE_NO FROM ICOMLUSR WHERE HOUSE_CODE = PH.HOUSE_CODE AND USER_ID = PH.TAKE_USER_NAME) AS TAKE_USER_IN_PHONE
  	    	--, DECODE(PRHD.PROJECT_PM, NULL, DECODE(PRHD.SALES_USER_ID, NULL, PRHD.ADD_USER_ID, PRHD.SALES_USER_ID), PRHD.PROJECT_PM) AS TAKE_USER_ID
  	    	--,GetUserNameLoc(PH.HOUSE_CODE, DECODE(PRHD.PROJECT_PM, NULL, DECODE(PRHD.SALES_USER_ID, NULL, PRHD.ADD_USER_ID, PRHD.SALES_USER_ID), PRHD.PROJECT_PM)) AS TAKE_USER_NAME
  	    	,CNDT.CTR_DATE                                          				
  	    	,PH.TAKE_TEL                                          					
  	    	,PH.REMARK                                              				
  	    	,PD.EXEC_NO                                             				
  	    	,CNDT.CTR_NO                                                  	      	
  	    	,PRHD.CUST_CODE
			,PRHD.CUST_NAME
  	    	,PH.PO_CREATE_DATE                                             	      	
  	    	,PH.VENDOR_CP_NAME	                                           	      	 
  	    	,PH.VENDOR_MOBILE_NO                                           	      	 
  	    	--,PH.CONTRACT_FROM_DATE	                                           	     
  	    	--,PH.CONTRACT_TO_DATE   
       		,CNDT.VALID_FROM_DATE      AS CONTRACT_FROM_DATE
       		,CNDT.VALID_TO_DATE        AS CONTRACT_TO_DATE  	    	
       		,TO_CHAR(TO_DATE(CNDT.VALID_FROM_DATE), 'YYYY/MM/DD')	AS CONTRACT_FROM_DATE_1
       		,TO_CHAR(TO_DATE(CNDT.VALID_TO_DATE), 'YYYY/MM/DD')		AS CONTRACT_TO_DATE_1
			, case PH.CONTRACT_FLAG when 'Y' then PH.CONTRACT_NO else '' end AS CONTRACT_NO			
  	    	,PH.SIGN_PERSON_ID	                                           	      	
  	    	,PH.SIGN_DATE	                                           	      		 
  	    	,PH.ADD_USER_ID	                                           	      		 
  	    	,PH.ADD_DATE	                                           	      		 
  	    	,PH.ADD_TIME	                                           	      		 
  	    	,PH.PO_TYPE	                                           	      			 
  	    	,PH.PO_TTL_AMT PO_AMT_KRW                                         	      			 
  	    	,PD.EXCHANGE_RATE                                         	      		 
  	    	--,GETICOMCODE1(PH.HOUSE_CODE,'M383',PH.BSART) AS BSART_DESC			
			,NVL(( SELECT  																											
					MAX(INV_PERSON_ID)                                                           
					FROM ICOYIVHD IVHD, ICOYIVDT IVDT                                       
					WHERE                                                                   
					IVDT.HOUSE_CODE = PD.HOUSE_CODE                                         
					AND IVDT.PO_NO = PD.PO_NO                                               
					AND IVDT.PO_SEQ = PD.PO_SEQ                                             
					AND IVHD.INV_NO = IVDT.INV_NO                                           
			),PD.PR_USER_ID) INV_PERSON_ID                                          
			,GETUSERNAMELOC(PH.HOUSE_CODE, NVL(( SELECT                      
													CASE MAX(INV_PERSON_ID) WHEN NULL THEN PD.PR_USER_ID ELSE MAX(INV_PERSON_ID) END  
												 FROM ICOYIVHD IVHD, ICOYIVDT IVDT                                       
												 WHERE                                                                   
												 IVDT.HOUSE_CODE = PD.HOUSE_CODE                                         
													AND IVDT.PO_NO = PD.PO_NO                                               
													AND IVDT.PO_SEQ = PD.PO_SEQ                                             
													AND IVHD.INV_NO = IVDT.INV_NO                                           
							),PD.PR_USER_ID)) INV_PERSON_NAME                                       
		    ,PD.PO_NO  AS DOC_NO
			,PH.ATTACH_NO
			,PH.VENDOR_EMAIL
			,PH.SIGN_STATUS AS ORIGINAL_SIGN_STATUS
			,ECCT.CONT_SEQ
			,ECCT.CONT_COUNT
			,ECCT.FORM_SEQ
			,SS.SRC_FILE_NAME	
			--,DECODE((SELECT DEPT FROM ICOMLUSR WHERE USER_ID = PH.TAKE_USER_NAME),PRHD.DEMAND_DEPT,0,1) TAKE_USER_CHANGE_FG
			-- ASIS 2017-07-01 ,DECODE((SELECT DEPT FROM ICOMLUSR WHERE USER_ID = PH.TAKE_USER_NAME),'020644',0,PRHD.DEMAND_DEPT,0,1) TAKE_USER_CHANGE_FG
			
			-- TOBE 2017-07-01 총무부 글로벌 상수 020644
			,DECODE((SELECT DEPT FROM ICOMLUSR WHERE USER_ID = PH.TAKE_USER_NAME),${DEFAULT_GAM_JUMCD},0,PRHD.DEMAND_DEPT,0,1) TAKE_USER_CHANGE_FG
			,GETFILENAMES(PH.ATTACH_NO) AS RPT_GETFILENAMES
	    FROM ICOYPODT PD, ICOYPOHD PH, ICOYPRHD PRHD, ICOYCNDT CNDT, ICOYECCT ECCT, SFILE SS                	
						WHERE PD.HOUSE_CODE   = ${session.HOUSE_CODE}
						AND   PD.PO_NO        = $S{po_no}
				  		AND   PD.STATUS       IN ('C', 'R')                                           	
				  		AND   PH.HOUSE_CODE   = PD.HOUSE_CODE
				  		AND   PH.PO_NO        = PD.PO_NO
				  		AND   PD.HOUSE_CODE	  = PRHD.HOUSE_CODE(+)
				  		AND   PD.PR_NO		  = PRHD.PR_NO(+)
				  		AND   PD.HOUSE_CODE	  = CNDT.HOUSE_CODE(+)
				  		AND   PD.EXEC_NO	  = CNDT.EXEC_NO(+)
				  		AND   PD.EXEC_SEQ     = CNDT.EXEC_SEQ(+)
				  		AND	  PH.ATTACH_NO	  = SS.DOC_NO(+)
				  		AND   PH.STATUS       IN ('C', 'R')
				  		AND   PH.PO_NO        = ECCT.PO_NO(+)
				  		AND   PH.HOUSE_CODE   = ECCT.HOUSE_CODE(+)
						ORDER BY 1 DESC
		]]>
	</method>
	
	
	<method name="getPoDetailLine">
		<![CDATA[
     			SELECT ROWNUM AS SEQ
     				,DT.ITEM_NO                              										 
    				,DT.DESCRIPTION_LOC                 	 										 
     				,CONVERT_DATE(DT.RD_DATE) AS RD_DATE      
     				,CONVERT_DATE(DT.VENDOR_RD_DATE) AS VENDOR_RD_DATE                         										 
     				,DT.UNIT_MEASURE                         										 
     				,DT.ITEM_QTY                             										 
     				,DT.UNIT_PRICE                           										 
     				,DT.ITEM_AMT                             										 
     				,PD.UNIT_PRICE AS PR_UNIT_PRICE          										 
     				,DT.PR_AMT                               										 
     				,DT.PR_AMT - DT.ITEM_AMT AS DOWN_AMT     										 
     				,DT.PR_NO                                										 
     				,DT.CUST_CODE
     				,(SELECT CUST_NAME FROM ICOYPRHD WHERE HOUSE_CODE = DT.HOUSE_CODE AND PR_NO = DT.PR_NO)  AS CUST_NAME
     				,HD.CUR                                  										 
     				,DT.EXCHANGE_RATE                        										 
     				,DT.ITEM_AMT AS EXEC_AMT_KRW             										 
     				,DT.ITEM_AMT_KRW 				          										 
     				,DT.DELY_TO_LOCATION                     										 
     				,DT.DELY_TO_ADDRESS						 										 
     				, GETICOMCODE1(DT.HOUSE_CODE,'M187',DT.DELY_TO_LOCATION) AS DELY_TO_LOCATION_DESC 
     				,DT.QTA_NO                               										 
     				,DT.QTA_SEQ                              										 
     				,DT.PR_SEQ                               										 
     				,DT.EXEC_NO                              										 
     				,DT.EXEC_SEQ                             										 
     				,DT.CUSTOMER_PRICE                       										 
     				,DT.DISCOUNT                             										 
    				, GETICOMCODE1(PD.HOUSE_CODE,'M169',PD.TECHNIQUE_GRADE) AS TECHNIQUE_GRADE	 	       
    				,CONVERT_DATE(PD.INPUT_FROM_DATE) AS INPUT_FROM_DATE						 										 	    
    				,CONVERT_DATE(PD.INPUT_TO_DATE) AS INPUT_TO_DATE						 										 	
    				,DT.PR_USER_ID																	 
					,DT.PR_DEPT																		 
					,DT.MAKER_CODE		 															 
					,DT.MAKER_NAME		 															 
	  				,DT.SPECIFICATION 																  	 
	  				,DT.PO_NO 																		  	 
	  				,DT.PO_SEQ		 																  
	  				,HD.CTRL_CODE		 															 
					,DT.ORDER_NO																	
					,DT.ORDER_SEQ	
					,DT.ORDER_COUNT																
					,DT.WBS_NO																		
					,DT.WBS_SUB_NO																	
					,DT.WBS_TXT	
					,DT.WBS_NAME																	
					--,DT.KNTTP																		
					--,DT.INVEST_NO																		
					--,DT.INVEST_SUB_NO																
					,DT.WARRANTY																
					,DT.ITEM_QTY AS PO_QTY
					,PD.REMARK																
     		FROM ICOYPOHD HD, ICOYPODT DT, ICOYPRDT PD       										 
     		WHERE DT.HOUSE_CODE = HD.HOUSE_CODE
     		AND   DT.PO_NO		= HD.PO_NO
     		AND   DT.HOUSE_CODE = PD.HOUSE_CODE(+)
     		AND   DT.PR_NO		= PD.PR_NO(+)
    		AND   DT.PR_SEQ		= PD.PR_SEQ(+)
     		AND   DT.HOUSE_CODE   = ${session.HOUSE_CODE}               										 
     		AND   DT.PO_NO        = $S{po_no}               										 
     		AND   DT.STATUS     IN ('C', 'R')       -- (발주상세조회 D 건도 조회)       										 
     		AND   HD.STATUS     IN ('C', 'R')              										 
     		ORDER BY DT.PO_SEQ, DT.PR_SEQ                               										 
		]]>
	</method>
	
	<method name="sel_getPoCreateInfo_2">
		<![CDATA[
SELECT GETICOMCODE1(CNHD.HOUSE_CODE,'M009',CNHD.DELY_TERMS) AS DELY_TERMS,
       CNHD.DELAY_REMARK,
       CNHD.WARRANTY_MONTH,
       MAX(CNDP.FIRST_PERCENT) AS FIRST_PERCENT,     /*선급금보증*/
       MAX(CNDP.CONTRACT_PERCENT) AS CONTRACT_PERCENT, /*계약이행보증*/
       MAX(CNDP.MENGEL_PERCENT) AS MENGEL_PERCENT /*하자이행보증*/
  FROM ICOYCNHD CNHD, ICOYCNDP CNDP
 WHERE CNHD.HOUSE_CODE = CNDP.HOUSE_CODE
   AND CNHD.EXEC_NO = CNDP.EXEC_NO
   AND CNHD.HOUSE_CODE = ${session.HOUSE_CODE}
   AND CNHD.EXEC_NO = (SELECT EXEC_NO
   								  FROM ICOYPODT
   								 WHERE HOUSE_CODE = ${session.HOUSE_CODE}
   								   AND PO_NO = $S{po_no}
   								   AND STATUS IN ('C','R')
   								   AND ROWNUM = 1)
   
  GROUP BY CNHD.HOUSE_CODE, CNHD.DELY_TERMS, CNHD.DELAY_REMARK, CNHD.WARRANTY_MONTH
		]]>
	</method>
	
	
	
	
	<method name="up_ICOYPODT_DO">
		<![CDATA[
			UPDATE ICOYPODT SET                                            	
				 STATUS                         =   ${STATUS}                                                                    
				,ADD_DATE                       =   ${ADD_DATE}                                                                     
				,ADD_TIME                       =   ${ADD_TIME}                                                                     
				,ADD_USER_ID                    =   ${ADD_USER_ID}                                                                     
				,CHANGE_DATE                    =   ${CHANGE_DATE}                                                                     
				,CHANGE_TIME                    =   ${CHANGE_TIME}                                                                     
				,CHANGE_USER_ID                 =   ${CHANGE_USER_ID}                                                                     
				,COMPANY_CODE                   =   ${COMPANY_CODE}                                                                     
				,PLANT_CODE                     =   ${SPACE}                                                                     
				,VENDOR_CODE                    =   ${VENDOR_CODE}                                                                     
				,ITEM_NO                        =   ${ITEM_NO}                                                                     
				,PURCHASE_LOCATION              =   ${SPACE}                                                                     
				,MAKER_CODE                     =   ${MAKER_CODE} 				                                             
				,MAKER_NAME                     =   ${MAKER_NAME} 				                                             
				,UNIT_MEASURE                   =   ${UNIT_MEASURE}                                                                     
				,ITEM_QTY                       =   ${PO_QTY}                                                                     
				,UNIT_PRICE                     =   ${UNIT_PRICE}                                                                     
				,ITEM_AMT                       =   ${ITEM_AMT}                                                                     
				,RD_DATE                        =   ${RD_DATE}                                                                     
				,VENDOR_ITEM_NO                 =   ''					                                          
				,COMPLETE_MARK                  =   'N'                                                                  
				,DO_QTY                         =   0                                                                    
				,INV_QTY                        =   0                                                                    
				,GR_QTY                         =   0                                                                    
				,INSPECT_TYPE                   =   ''				                                 	        
				,ATTACH_NO                      =   ${SPACE}                                                                     
				,PR_DEPT                        =   ${PR_DEPT}                                                                    
				,PR_USER_ID                     =   ${PR_USER_ID}                                                                     
				,INV_COMPLETE_FLAG              =   'N'                                                                  
				,COMPLETE_GR_MARK               =   'N'                                                                  
				,INFO_CREATE_TYPE               =   ${INFO_CREATE_TYPE}                                                                     
				,DELY_TO_ADDRESS                =   ${DELY_TO_ADDRESS}                                                                     
				,DESCRIPTION_ENG                =   ${DESCRIPTION_ENG}                                                                     
				,DESCRIPTION_LOC                =   ${DESCRIPTION_LOC}                                                                     
				,SPECIFICATION                  =   ${SPECIFICATION}                                                                     
				,DELY_TO_LOCATION               =   ${DELY_TO_LOCATION}                                                                    
				,PKG_TYPE                       =   ''			                                                      
				,UNIT_TAX                       =   0                                                                    
				,STR_FLAG                       =   ${STR_FLAG}                                                                     
				,PREV_UNIT_PRICE                =   ${PREV_UNIT_PRICE}                                                                     
				,ACCOUNT_CODE                   =   ${ACCOUNT_CODE}                                                                     
				,Z_CODE2						=	${Z_CODE2}                                                        		                                                                           
				,Z_CODE3						=	${Z_CODE3}                                                        		 
				,Z_LOI_FLAG						=	'N'                                                   			
				,DO_FLAG						=	CASE ${SPACE}  WHEN 'true' THEN 'Y' ELSE 'N' END                              		
				,Z_WORK_STAGE_FLAG              =   CASE ${SPACE}  WHEN 'true' THEN 'Y' ELSE 'N' END                                      
				,Z_DELIVERY_CONFIRM_FLAG        =   CASE ${SPACE}  WHEN 'true' THEN 'Y' ELSE 'N' END                                      
				,QI_FLAG						=	''			                                             			    
				,QTA_NO					        =   ${QTA_NO}                                                           
				,QTA_SEQ	                    =   ${QTA_SEQ}                                                                     
				,PR_NO	                        =   ${PR_NO}                                                                       
				,PR_SEQ	                        =   ${PR_SEQ}                                                                   
				,EXEC_NO	                    =   ${EXEC_NO}                                                                     
				,EXEC_SEQ                       =   ${EXEC_SEQ}                                                                      
				,CUSTOMER_PRICE	                =   ${CUSTOMER_PRICE}                                                                   
				,DISCOUNT						=	${DISCOUNT}                                                        
				,CUST_CODE                      =   ${CUST_CODE}                                                                      
				,EXCHANGE_RATE	                =   ${EXCHANGE_RATE}                                                                       
				,PR_AMT         				=	${PR_AMT}                                                              			    
				,VALID_FROM_DATE				=	''													   		    
				,VALID_TO_DATE					=	''													   		    											   		    
				,ITEM_AMT_KRW					=	${ITEM_AMT_KRW} 
				,WARRANTY						=   ${WARRANTY}
			WHERE HOUSE_CODE                    =   ${session.HOUSE_CODE}                                                                          
				AND PO_NO                       =   ${po_no}                                                                                
				AND PO_SEQ                      =   $S{PO_SEQ} 					                                                           
		]]>
	</method> 
	 
	
		<method name="up_ICOYPOHD_DO">
		<![CDATA[
			UPDATE  ICOYPOHD  SET       
			   	 VENDOR_EMAIL			= ${VENDOR_EMAIL}                      
				,STATUS                 = ${STATUS}                         
				,ADD_DATE               = ${ADD_DATE}                         
				,ADD_TIME               = ${ADD_TIME}                         
				,ADD_USER_ID            = ${ADD_USER_ID}                         
				,CHANGE_DATE            = ${CHANGE_DATE}                         
				,CHANGE_TIME            = ${CHANGE_TIME}                         
				,CHANGE_USER_ID         = ${CHANGE_USER_ID}                         
				,COMPANY_CODE           = ${COMPANY_CODE}                         
				,PLANT_CODE             = ${SPACE}                         
				,PO_CREATE_DATE         = ${ADD_DATE}                         
				,VENDOR_CODE            = ${VENDOR_CODE}                         
				--,SHIPPER_TYPE           = 'D'                      
				,PAY_TERMS              = ${PAY_TERMS}                         
				,DELY_TERMS             = ${DELY_TERMS}                         
				,CUR                    = ${CUR} 	                        
				,PO_TTL_AMT             = ${PO_TTL_AMT}                         
				,CTRL_CODE              = ${CTRL_CODE}                         
				,PURCHASER_ID           = ${PURCHASER_ID}                         
				,PURCHASER_NAME         = ${PURCHASER_NAME}                         
				,EMAIL_FLAG             = 'N'                      
				,COMPLETE_MARK          = 'N'                      
				,PO_TYPE                = ${PO_TYPE}                                               
				,SIGN_DATE              = ${SIGN_DATE}                         
				,SIGN_PERSON_ID         = ${SIGN_PERSON_ID}                         
				,GR_BASE_FLAG           = 'N'                      
				,SUBJECT                = ${SUBJECT}
				,REMARK                 = ${REMARK}
				,ORDER_NO               = ${ORDER_NO}
				,ORDER_NAME             = ${ORDER_NAME}
				,PR_TYPE                = ${PR_TYPE}
				,TAKE_USER_NAME         = ${TAKE_USER_NAME}
				,TAKE_TEL               = ${TAKE_TEL}
				,VENDOR_CP_NAME	 	   	= ${VENDOR_CP_NAME}
				,VENDOR_MOBILE_NO 	   	= ${VENDOR_MOBILE_NO}
				,CONTRACT_FROM_DATE	   	= ${CONTRACT_FROM_DATE}
				,CONTRACT_TO_DATE   	= ${CONTRACT_TO_DATE}
				,PO_AMT_KRW   	   	   	= ROUND(${PO_AMT_KRW} ,0)
				,SIGN_STATUS           	= DECODE(SIGN_STATUS, 'E', SIGN_STATUS, ${SIGN_STATUS}  )
				/*협력사에서 반려한 발주건을 다시 수정해서 발주할 경우 접수여부 및 반려사유 초기화*/
				,CONFIRM_CERTV			= ''
				,CONFIRM_DATE			= ''
				,CONFIRM_TIME			= ''
				,CONFIRM_USER_ID		= ''
				,REJECT_REMARK			= ''
			WHERE HOUSE_CODE           	= ${session.HOUSE_CODE}
				AND PO_NO              	= ${po_no}
		]]>
	</method> 
	
	<method name="setPRDT_1">
		<![CDATA[
	        SELECT PR_NO, PR_SEQ                   
	        FROM   ICOYPODT                        
	        WHERE  HOUSE_CODE = ${session.HOUSE_CODE}    
	          AND  PO_NO = ${po_no}     
	          AND  STATUS <> 'D'                   
		]]>
	</method>

	<method name="setPRDT_2">
		<![CDATA[
           UPDATE ICOYPRDT            			
           SET    PR_PROCEEDING_FLAG = 'O'       
           WHERE  HOUSE_CODE = ${session.HOUSE_CODE}  
             AND  PR_NO = ${PR_NO}     		
             AND  PR_SEQ = ${PR_SEQ}       	
		]]>
	</method>
	
	<method name="setPRDT2_1">
		<![CDATA[
	        SELECT PR_NO, PR_SEQ                   
	        FROM   ICOYPODT                        
	        WHERE  HOUSE_CODE = ${session.HOUSE_CODE}    
	          AND  PO_NO = ${po_no}     
	          AND  STATUS <> 'D'                   
		]]>
	</method>

	<method name="setPRDT2_2">
		<![CDATA[
           UPDATE ICOYPRDT            			
           SET    PR_PROCEEDING_FLAG = 'U'       
           WHERE  HOUSE_CODE = ${session.HOUSE_CODE}  
             AND  PR_NO = ${PR_NO}      		
             AND  PR_SEQ = ${PR_SEQ}        	
		]]>
	</method>

	<method name="updateCndt_1">
		<![CDATA[
	 	 	SELECT PD.PO_NO, PD.PO_SEQ, CD.EXEC_NO, CD.EXEC_SEQ	                        
	        FROM ICOYPODT PD, ICOYCNDT CD          
	        WHERE CD.HOUSE_CODE = PD.HOUSE_CODE    
				AND CD.EXEC_NO   = PD.EXEC_NO       
				AND PD.PO_NO     = ${po_no}     
				AND CD.EXEC_SEQ  = PD.EXEC_SEQ      
		]]>
	</method>

	<method name="updateCndt_2">
		<![CDATA[
            UPDATE ICOYCNDT SET                                 
		 	 PO_NO = ${PO_NO}                       
		 	, PO_SEQ = ${PO_SEQ}                      
		 	where EXEC_NO = ${EXEC_NO}                       
		 	AND EXEC_SEQ = ${EXEC_SEQ}                   
		]]>
	</method>
	
	<method name="setPODT">
		<![CDATA[
			 UPDATE ICOYPODT                                               
			 SET   RD_DATE = TO_CHAR(SYSDATE, 'YYYYMMDD')      
			 WHERE HOUSE_CODE = ${HOUSE_CODE}                          
			   AND PO_NO = ${PO_NO}                                              
			   AND RD_DATE < TO_CHAR(SYSDATE, 'YYYYMMDD')      
		]]>
	</method>
	
	
	
</service>


